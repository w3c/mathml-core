<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>MathML Core</title>
    <script src="https://www.w3.org/Tools/respec/respec-w3c-common"
            class="remove"></script>
    <script src="tables/sorttable.js"></script>
    <script src="wpt-tests.js"></script>
    <script src="implementation-report.js"></script>
    <style>
      .folded { display: none; }
    </style>
    <script class="remove">
      function setResults(browser, json) {
          for (let i in json.results)
              wptResults[json.results[i].test][browser] =
              (json.results[i].status === "PASS") ? "PASS" : "FAIL";
          addBrowserResult("implementation-report", wptResults, browser);
      }
      function loadWebPlaformTestsResults() {
          addTestCount("implementation-report", wptResults);
          loadJSON("blink", setResults);
          loadJSON("gecko", setResults);
          loadJSON("webkit", setResults);
      }
      var respecConfig = {
          specStatus: "ED",
          editors: [{
              name: "David Carlisle",
              url: "https://davidcarlisle.github.io/dcarlisle/david/",
              company: "NAG"
          }, {
              name: "Frédéric Wang",
              url: "http://frederic-wang.fr",
              company: "Igalia"
          }],
          wg: "MathML Refresh Community Group",
          wgURI: "https://www.w3.org/community/mathml4/",
          edDraftURI: "https://mathml-refresh.github.io/mathml-core/",
          shortName: "mathml-core",
          testSuiteURI: "https://w3c-test.org/mathml/",
          issueBase: "https://github.com/mathml-refresh/mathml/issues/",
          implementationReportURI: "https://mathml-refresh.github.io/mathml-core/implementation-report.html",
          otherLinks: [{
              key: "Participate",
              data: [{
                  value: 'MathML Refresh CG',
                  href: 'https://www.w3.org/community/mathml4/'
              }, {
                  value: 'GitHub mathml-refresh/mathml',
                  href: 'https://github.com/mathml-refresh/mathml/'
              }, {
                  value: 'GitHub mathml-refresh/mathml-core',
                  href: 'https://github.com/mathml-refresh/mathml-core/'
              }, {
                  value: 'File a bug',
                  href: 'https://github.com/mathml-refresh/mathml/issues'
              }, {
                  value: 'Commit History',
                  href: 'https://github.com/mathml-refresh/mathml-core/commits/gh-pages'
              }, {
                  value: 'Pull requests',
                  href: 'https://github.com/mathml-refresh/mathml-core/pulls/'
              }]
          }],
          localBiblio: {
              "MATHML4": {
                  title: "Mathematical Markup Language (MathML) Version 4.0",
                  authors: [
                      "David Carlisle et al."
                  ],
                  status: "WD",
                  href: "https://mathml-refresh.github.io/mathml/"
              },
              "TEXBOOK": {
                  title: "The TeXBook",
                  date: "1984",
                  authors: [
                      "Knuth, Donald E."
                  ],
                  publisher: "Addison-Wesley Professional",
                  id: "ISBN9780201134483"
              },
              "OPEN-TYPE-MATH-ILLUMINATED": {
                  title: "OpenType Math Illuminated",
                  date: "2009",
                  authors: [
                      "Ulrik Vieth"
                  ],
                  href: "http://www.tug.org/TUGboat/tb30-1/tb94vieth.pdf",
              },
              "OPEN-TYPE-MATH-IN-HARFBUZZ": {
                  title: "OpenType MATH in HarfBuzz",
                  authors: [
                      "Frédéric Wang"
                  ],
                  href: "http://frederic-wang.fr/opentype-math-in-harfbuzz.html"
              }
          },
          postProcess: [sorttable.init, loadWebPlaformTestsResults]
      };
    </script>
  </head>
  <body>
    <div id="implementation-report"></div>
    <section id="abstract">
      <p>
        This specification defines a core subset of Mathematical Markup
        Language, or MathML, that is suitable for browser implementation.
        MathML is a markup language for describing mathematical notation
        and capturing both its structure and content. The goal of MathML is to
        enable mathematics to be served, received, and processed on the World
        Wide Web, just as HTML has enabled this functionality for text.
      </p>
    </section>
    <section id="sotd">
      <p>
        This is a public copy of the editors’ draft. It is provided for
        discussion only and may change at any moment. Its publication here does
        not imply endorsement of its contents by W3C. Don’t cite this document
        other than as work in progress.
      </p>
    </section>
    <section class="informative">
      <h2>Introduction</h2>
      <p>
        The [[MATHML3]] specification has several shortcomings that make it
        hard to implement consistently across web rendering engines or to
        extend with user-defined constructions e.g.
      </p>
      <ul>
        <li>It is a huge and standalone specification.</li>
        <li>It does not contain any detailed rendering rules.</li>
        <li>It is not driven by browser-implementation.</li>
        <li>It lacks automated testing.</li>
      </ul>
      <p>
        This MathML Core specification intends to address these issues by
        being as accurate as possible on the visual rendering of mathematical
        formulas using additional rules from the TeXBook’s Appendix G
        [[?TEXBOOK]] and from the Open Font Format [[OPEN-FONT-FORMAT]],
        [[OPEN-TYPE-MATH-ILLUMINATED]]. It also relies on modern browser
        implementations and web technologies [[HTML]] clarifying interactions
        with them when needed or introducing new low-level primitives to
        improve the web platform layering. Parts of MathML 3 that do not
        fit well in this framework or are rarely used in practice have been
        omitted. Instead, they are described in a separate and larger
        [[MATHML4]] specification.
      </p>
      <p>
        By increasing the level of implementation details, focusing on a
        workable subset, following a browser-driven design and relying on
        automated web platform tests, this specification is expected to
        greatly improve MathML interoperability. Moreover, effort on MathML
        layering will enable users to implement the rest of the MathML 4
        specification, or more generally to extend MathML Core, using
        polyfills or converters.
      </p>
    </section>
    <section class="normative">
      <h2>MathML Fundamentals</h2>
      <section>
        <h3>Integration in the Web Platform</h3>
        <section>
          <h4>HTML and SVG</h4>
          <div data-tests="relations/html5-tree/required-extensions-2.html,relations/html5-tree/integration-point-1.html,relations/html5-tree/integration-point-2.html,relations/html5-tree/integration-point-3.html"></div>
          <p>
            When
            <a data-cite="HTML#parsing">parsing HTML documents</a>
            user agents must treat any of the following
            <dfn>MathML Core elements</dfn> as belonging to the
            <a data-cite="INFRA#mathml-namespace">MathML namespace</a>:
          </p>
          <ol>
            <li><a>&lt;annotation&gt;</a></li>
            <li><a>&lt;annotation-xml&gt;</a></li>
            <li><a>&lt;maction&gt;</a></li>
            <li><a>&lt;math&gt;</a></li>
            <li><a>&lt;menclose&gt;</a></li>
            <li><a>&lt;merror&gt;</a></li>
            <li><a>&lt;mfrac&gt;</a></li>
            <li><a>&lt;mi&gt;</a></li>
            <li><a>&lt;mmultiscripts&gt;</a></li>
            <li><a>&lt;mn&gt;</a></li>
            <li><a>&lt;mo&gt;</a></li>
            <li><a>&lt;mover&gt;</a></li>
            <li><a>&lt;mpadded&gt;</a></li>
            <li><a>&lt;mphantom&gt;</a></li>
            <li><a>&lt;mprescripts&gt;</a></li>
            <li><a>&lt;mroot&gt;</a></li>
            <li><a>&lt;mrow&gt;</a></li>
            <li><a>&lt;ms&gt;</a></li>
            <li><a>&lt;mspace&gt;</a></li>
            <li><a>&lt;msqrt&gt;</a></li>
            <li><a>&lt;mstyle&gt;</a></li>
            <li><a>&lt;msub&gt;</a></li>
            <li><a>&lt;msubsup&gt;</a></li>
            <li><a>&lt;msup&gt;</a></li>
            <li><a>&lt;mtable&gt;</a></li>
            <li><a>&lt;mtd&gt;</a></li>
            <li><a>&lt;mtext&gt;</a></li>
            <li><a>&lt;mtr&gt;</a></li>
            <li><a>&lt;munder&gt;</a></li>
            <li><a>&lt;munderover&gt;</a></li>
            <li><a>&lt;none&gt;</a></li>
            <li><a>&lt;semantics&gt;</a></li>
          </ol>
          <p>
            Users agents must allow mixing HTML, SVG and MathML elements
            as allowed by sections
            <a data-cite="HTML#html-integration-point">HTML integration point</a>,
            <a data-cite="HTML#mathml-text-integration-point">MathML integration point</a>,
            <a data-cite="HTML#tree-construction-dispatcher">tree construction
              dispatcher</a>,
            <a data-cite="HTML#mathml">MathML</a> and
            <a data-cite="HTML#svg-0">SVG</a>
            from [[HTML]].
          </p>
          <p>
            When evaluating the SVG
            <a data-cite="SVG#RequiredExtensionsAttribute"><code>requiredExtensions</code></a>
            attribute, user agents must claim support for the language extension
            identified by the
            <a data-cite="INFRA#mathml-namespace">MathML namespace</a>.
          </p>
          <div class="note">
            <ul>
              <li>
                The <code>&lt;math&gt;</code> element can be used at
                position permitted for
                <a data-cite="HTML#flow-content-2">flow content</a>
                (e.g. a
                <a data-cite="SVG#ForeignObjectElement"><code>&lt;foreignObject&gt;</code></a> element)
                or <a data-cite="HTML#phrasing-content-2">phrasing content</a>.
              </li>
              <li>
                Any
                <a data-cite="HTML#phrasing-content-2">phrasing content</a>
                can be used inside
                <a><code>&lt;mi&gt;</code></a>,
                <a><code>&lt;mo&gt;</code></a>,
                <a><code>&lt;mn&gt;</code></a>,
                <a><code>&lt;ms&gt;</code></a> and
                <a><code>&lt;mtext&gt;</code></a>
                elements.
              </li>
              <li>
                The <code>&lt;svg&gt;</code> element can be used inside
                <a><code>&lt;annotation-xml&gt;</code></a> elements.
              </li>
              <li>
                Any <a data-cite="HTML#flow-content-2">flow content</a>
                can be used inside
                <a><code>&lt;annotation-xml&gt;</code></a> elements with
                encoding
                <code>application/xhtml+xml</code> or <code>text/html</code>.
              </li>
            </ul>
          </div>
        </section>
        <section>
          <h4>CSS styling</h4>
          <div data-tests="presentation-markup/direction/direction-overall.html,presentation-markup/direction/direction-token.html,presentation-markup/fractions/frac-color-001.html,presentation-markup/fractions/frac-color-002.html,presentation-markup/fractions/frac-visibility-001.html,relations/css-styling/color-1.html,relations/css-styling/display-1.html,relations/css-styling/displaystyle-1.html,relations/css-styling/dynamic-dir-1.html,relations/css-styling/lengths-1.html,relations/css-styling/lengths-2.html,relations/css-styling/mathsize-attribute.html,relations/css-styling/mathvariant-auto.html,relations/css-styling/mathvariant-bold-fraktur.html,relations/css-styling/mathvariant-bold-italic.html,relations/css-styling/mathvariant-bold-sans-serif.html,relations/css-styling/mathvariant-bold-script.html,relations/css-styling/mathvariant-bold.html,relations/css-styling/mathvariant-double-struck.html,relations/css-styling/mathvariant-fraktur.html,relations/css-styling/mathvariant-initial.html,relations/css-styling/mathvariant-italic.html,relations/css-styling/mathvariant-looped.html,relations/css-styling/mathvariant-monospace.html,relations/css-styling/mathvariant-sans-serif-bold-italic.html,relations/css-styling/mathvariant-sans-serif-italic.html,relations/css-styling/mathvariant-sans-serif.html,relations/css-styling/mathvariant-script.html,relations/css-styling/mathvariant-stretched.html,relations/css-styling/mathvariant-tailed.html,relations/css-styling/visibility-1.html,relations/html5-tree/class-1.html,relations/html5-tree/color-attributes-1.html,relations/html5-tree/display-1.html,relations/html5-tree/unique-identifier-3.html"></div>
          <p>User agents must support various CSS features mentioned in this
            specification, including new ones described in
            <a href="#css-extensions-for-math-layout"></a>.</p>
          <p>
            All documents containing <a>MathML Core elements</a> must include
            CSS rules described in <a href="#user-agent-stylesheet"></a>
            as part of user-agent level style sheet defaults.
            Rules relying on universal selectors such as
            <code>mfrac > *</code> or <code>msub > :not(:first-child)</code> may
            be replaced with equivalent expanded rules listing all possible
            <a>MathML Core elements</a>.
          </p>
        </section>
        <section>
          <h4>DOM and Javascript</h4>
          <div data-tests="presentation-markup/fractions/frac-created-dynamically-2.html,presentation-markup/fractions/frac-created-dynamically-3.html,presentation-markup/fractions/frac-created-dynamically.html,presentation-markup/operators/mo-form-dynamic.html,presentation-markup/operators/mo-movablelimits-dynamic.html,relations/css-styling/dynamic-dir-1.html,relations/html5-tree/class-2.html,relations/html5-tree/dynamic-1.html,relations/html5-tree/href-click-1.html,relations/html5-tree/href-click-2.html,relations/html5-tree/href-click-3.html,relations/html5-tree/unique-identifier-2.html"></div>
          <p>
            User agents supporting
            <a data-cite="HTML#webappapis">Web application APIs</a>
            must ensure that they keep the visual rendering of MathML
            in synchronization with the [[DOM]] tree.
          </p>
          <div class="issue" data-number="83">Properly define DOM/IDL relationships.</div>
          <div class="issue" data-number="118">Ensure that new IDL attributes reflects <a href="#global-attributes"></a>.</div>
          <p>
            All the nodes representing <a>MathML Core elements</a> in the DOM
            must implement, and expose to scripts, the following
            <dfn><code>MathMLElement</code></dfn> interface.
          </p>
          <pre class="idl" data-include="webidl/MathMLElement.idl"></pre>
          <p>The
            <dfn data-cite="HTML#globaleventhandlers"><code>GlobalEventHandlers</code></dfn>,
            <dfn data-cite="HTML#documentandelementeventhandlers"><code>DocumentAndElementEventHandlers</code></dfn> and
            <dfn data-cite="HTML#htmlorsvgelement"><code>HTMLOrSVGElement</code></dfn> interfaces are defined in
            [[HTML]].</p>
          <p>The
            <dfn data-cite="CSSOM#elementcssinlinestyle"><code>ElementCSSInlineStyle</code></dfn>
            interface is defined in [[CSSOM]].
          </p>
        </section>
        <section>
          <h4>Text layout</h4>
          <div data-tests="relations/text-and-math/use-typo-metrics-1.html"></div>
          <p>
            Because math fonts generally contain very tall glyphs such as big
            integrals, using typographic metrics is important to avoid
            excessive line spacing of text. As a consequence,
            user agents must take into account the USE_TYPO_METRICS flag from
            the OS/2 table [[OPEN-FONT-FORMAT]] when performing text layout.
          </p>
        </section>
      </section>
      <section>
        <h3>Types for MathML Attribute Values</h3>
        <div data-tests="relations/css-styling/lengths-1.html,relations/css-styling/lengths-2.html"></div>
        <dl>
          <dt><dfn>unsigned-integer</dfn></dt>
          <dd>An
            <a data-cite="CSS-VALUES-3#integer-value"><code>&lt;integer-value&gt;</code></a> value as defined in
            [[CSS-VALUES-3]], whose first character is neither
            U+002D HYPHEN-MINUS character (-) nor
            U+002B PLUS SIGN (+).
          </dd>
        </dl>
        <dl>
          <dt><dfn>unsigned-number</dfn></dt>
          <dd>A
            <a data-cite="CSS-VALUES-3#number-value"><code>&lt;number-value&gt;</code></a> value as defined in
            [[CSS-VALUES-3]], whose first character is neither
            U+002D HYPHEN-MINUS character (-) nor
            U+002B PLUS SIGN (+).
          </dd>
        </dl>
        <dl>
          <dt><dfn>length-percentage</dfn></dt>
          <dd>A
            <a data-cite="CSS-VALUES-3#typedef-length-percentage"><code>&lt;length-percentage&gt;</code></a>
            value as defined in
            [[CSS-VALUES-3]]
          </dd>
        </dl>
        <dl>
          <dt><dfn>unsigned-length-percentage</dfn></dt>
          <dd>A
            <a><code>length-percentage</code></a>
            whose first character is neither
            U+002D HYPHEN-MINUS character (-) nor
            U+002B PLUS SIGN (+).
          </dd>
        </dl>
        <dl>
          <dt><dfn>color</dfn></dt>
          <dd>A
            <a data-cite="CSS-COLOR-3#colorunits"><code>&lt;color&gt;</code></a>
            value as defined in [[CSS-COLOR-3]]
          </dd>
        </dl>
        <dl>
          <dt><dfn>boolean</dfn></dt>
          <dd>A string that is a case-insensitive match to <code>true</code> or
            <code>false</code>.
          </dd>
        </dl>
      </section>
      <section>
        <h3>Global Attributes</h3>
          <div class="issue" data-number="118">Add more global attributes from HTML.</div>
        <p>
          The following attributes are common to and may be specified on all MathML
          elements:
        </p>
        <ul>
          <li><a>id</a></li>
          <li><a>class</a></li>
          <li><a><code>style</code></a></li>
          <li><a><code>href</code></a></li>
          <li><a><code>dir</code></a></li>
          <li><a><code>mathbackground</code></a></li>
          <li><a><code>mathcolor</code></a></li>
          <li><a><code>mathsize</code></a></li>
          <li><a><code>mathvariant</code></a></li>
          <li><a><code>displaystyle</code></a></li>
          <li><a><code>scriptlevel</code></a></li>
        </ul>
        <section>
          <h4>Attributes common to HTML and MathML elements</h4>
          <div data-tests="relations/css-styling/dynamic-dir-1.html,relations/html5-tree/class-1.html,relations/html5-tree/href-click-2.html,relations/html5-tree/unique-identifier-2.html,relations/html5-tree/class-2.html,relations/html5-tree/href-click-1.html,relations/html5-tree/href-click-3.html,relations/html5-tree/unique-identifier-1.html,relations/html5-tree/unique-identifier-3.html,presentation-markup/direction/direction.html,presentation-markup/direction/direction-token.html,presentation-markup/direction/direction-overall.html"></div>
          <p>
            The
            <dfn><code>id</code></dfn>,
            <dfn><code>class</code></dfn>,
            <dfn><code>style</code></dfn>,
            attributes have the same syntax and semantic as defined for
            <a data-cite="HTML#the-id-attribute">id</a>,
            <a data-cite="HTML#classes">class</a> and
            <a data-cite="HTML#the-style-attribute">style</a> attributes on
            HTML elements.
          </p>
          <p>
            The
            <dfn><code>href</code></dfn>
            attribute has the syntax and semantic as defined for
            the <a data-cite="HTML#attr-hyperlink-href">href</a> attribute on
            <code>&lt;a&gt;</code> element.
            To fully implement this attribute, the following CSS properties for
            links must be specified in the
            <a href="#user-agent-stylesheet">user agent stylesheet</a>:
          </p>
          <pre class="css" data-include="user-agent-stylesheet/links.css"></pre>
          <p>
            The
            <dfn><code>dir</code></dfn>
            attribute, if present,
            must be a case-insensitive match
            to <code>ltr</code> or <code>ltr</code>.
            It is mapped to the
            <a data-cite="CSS-WRITING-MODES-3#direction"><code>direction</code></a>
            CSS property.
            This attribute is used to set the directionality of math formulas, which is
            often <code>rtl</code> in Arabic speaking world.
          </p>
        </section>
        <section>
          <h4>Legacy MathML Style Attributes</h4>
          <div data-tests="relations/css-styling/lengths-1.html,relations/css-styling/mathsize-attribute.html,relations/css-styling/lengths-2.html,relations/html5-tree/color-attributes-1.html"></div>
          <p>
            The
            <dfn><code>mathcolor</code></dfn>
            and
            <dfn><code>mathbackground</code></dfn>
            attributes, if present, must
            have a value that is a <a>color</a>.
            The <code>mathcolor</code> property describes the foreground fill color of
            an MathML text, bars etc and the background color of an element.
            They are mapped to the
            <a data-cite="CSS-COLOR-3#foreground"><code>color</code></a> and
            <a data-cite="CSS-BACKGROUNDS-3#the-background-color"><code>background-color</code></a> CSS properties.
          </p>
          <p>
            The
            <dfn><code>mathsize</code></dfn>
            attribute, if present, must
            have a value that is a valid <a>length-percentage</a>.
            The <code>mathsize</code> property indicates indicates the desired height
            of glyphs in math formulas but also scale other parts (spacing, shifts,
            line thickness of bars etc) accordingly.
            It is mapped to the CSS property
            <a data-cite="CSS-FONTS-3#font-size-prop"><code>font-size</code></a>
            and the <code>mathsize</code> values are interpreted according to the
            definition in [[CSS-FONTS-3]].
          </p>
          <div class="note">
		    The above attributes are implemented for compatibility with full MathML. Authors whose only target is MathML Core are encouraged to use CSS for styling.
          </div>
        </section>
        <section>
          <h4>The <code>mathvariant</code> attribute</h4>
          <div data-tests="relations/css-styling/mathvariant-auto.html,relations/css-styling/mathvariant-bold-fraktur.html,relations/css-styling/mathvariant-bold-italic.html,relations/css-styling/mathvariant-bold-sans-serif.html,relations/css-styling/mathvariant-bold-script.html,relations/css-styling/mathvariant-bold.html,relations/css-styling/mathvariant-double-struck.html,relations/css-styling/mathvariant-fraktur.html,relations/css-styling/mathvariant-initial.html,relations/css-styling/mathvariant-italic.html,relations/css-styling/mathvariant-looped.html,relations/css-styling/mathvariant-monospace.html,relations/css-styling/mathvariant-sans-serif-bold-italic.html,relations/css-styling/mathvariant-sans-serif-italic.html,relations/css-styling/mathvariant-sans-serif.html,relations/css-styling/mathvariant-script.html,relations/css-styling/mathvariant-stretched.html,relations/css-styling/mathvariant-tailed.html"></div>
          <p>
            The
            <dfn><code>mathvariant</code></dfn>
            attribute,
            if present, must be a case-insensitive match to one of:
            <code>normal</code>,
            <code>bold</code>,
            <code>italic</code>,
            <code>bold-italic</code>,
            <code>double-struck</code>,
            <code>bold-fraktur</code>,
            <code>script</code>,
            <code>bold-script</code>,
            <code>fraktur</code>,
            <code>sans-serif</code>,
            <code>bold-sans-serif</code>,
            <code>sans-serif-italic</code>,
            <code>sans-serif-bold-italic</code>,
            <code>monospace</code>,
            <code>initial</code>,
            <code>tailed</code>,
            <code>looped</code>, or
            <code>stretched</code>.
          </p>
          <p>
            The <code>mathvariant</code> attribute defines logical classes of token
            elements. Each class provides a collection of typographically-related
            symbolic tokens with specific meaning within a given mathematical
            expression.
            For <code>mathvariant</code> values other than <code>normal</code>,
            this is done by using glyphs of
            Unicode's Mathematical Alphanumeric Symbols.
          </p>
          <p>
            Hence, the <code>mathvariant</code> attribute
            is mapped to new values of the CSS property
            <a><code>text-transform</code></a>.
            More precisely, <code>normal</code> is mapped to <code>none</code>
            while all the other values the corresponding CSS value with the extra
            <code>math-</code> prefix.
          </p>
          <div class="note">
		    <code>mathvariant</code> values other than <code>normal</code>
            are implemented for compatibility with full MathML and legacy editors that can't access characters in Plane 1 of Unicode. Authors are encouraged to use the corresponding Unicode characters.
            The <code>normal</code> value is still important to cancel automatic
            italic of the <a><code>&lt;mi&gt;</code></a> element.
          </div>
          <div class="issue" data-number="61">
            Consider a new script style to distinguish Chancery and Spencerian?
          </div>
          <div class="note">
            Unicode does not distinguish between Chancery and Spencerian style
            for the Unicode MATHEMATICAL SCRIPT characters. However, some
            mathematical fonts rely on <code>salt</code> or
            <code>ssXY</code> properties from [[OPEN-FONT-FORMAT]]
            to provide both styles. Page authors may use the
            <a data-cite="CSS-FONTS-4#font-variant-alternates-prop"><code>font-variant-alternates</code></a> property with corresponding OpenType font features
            to access these glyphs.
          </div>
        </section>
        <section>
          <h4>The <code>displaystyle</code> and <code>scriptlevel</code> attributes</h4>
          <div data-tests="relations/css-styling/displaystyle-1.html"></div>
          <p>
            The
            <dfn><code>displaystyle</code></dfn>
            attribute, if present, must have a value that is a <a>boolean</a>.
            It is mapped to the CSS property <a><code>math-style</code></a>.
            More precisely,  <code>true</code> is mapped to <code>display</code> and
            <code>false</code> to  <code>inline</code>.
            This attribute indicate whether formulas should try to minimize
            the logical height (value is <code>false</code>) or not
            (value is <code>true</code>) e.g. by changing the size of content or
            the layout of scripts.
          </p>
          <p>
            The
            <dfn><code>scriptlevel</code></dfn>
            attribute, if present, must have value
            <code>+&lt;U&gt;</code>, <code>-&lt;U&gt;</code> or <code>&lt;U&gt;</code>
            where <code>&lt;U&gt;</code> is an
            <a>unsigned-integer</a>.
            It is mapped to the <a><code>math-script-level</code></a>.
            More precisely,
            <code>+&lt;U&gt;</code>, <code>-&lt;U&gt;</code> and
            <code>&lt;U&gt;</code>
            are respectively mapped to
            <code>add(&lt;U&gt;)</code>
            <code>add(&lt;-U&gt;)</code>
            and <code>&lt;U&gt;</code>.
          </p>
          <p>
            <code>displaystyle</code> and <code>scriptlevel</code> values
            are automatically adjusted within MathML elements.
            To fully implement these attributes, additional CSS properties must be
            specified in the user agent stylesheet
            as described in <a href="#user-agent-stylesheet"></a>.
          </p>
          <div class="note">
            T<sub>E</sub>X's <code>\displaystyle</code>, <code>\textstyle</code>,
            <code>\scriptstyle</code>, and <code>\scriptscriptstyle</code> correspond
            to <code>displaystyle</code> and <code>scriptlevel</code> as
            <code>true</code> and <code>0</code>,
            <code>false</code> and <code>0</code>,
            <code>false</code> and <code>1</code>,
            and <code>false</code> and 2, respectively.
          </div>
          <div class="issue">
            Do we actually need these rules?
            What about <code>scriptlevel</code>?
            <pre class="css" data-include="user-agent-stylesheet/displaystyle.css"></pre>
          </div>
        </section>
      </section>
      <section>
        <h3>The Top-Level <code>&lt;math&gt;</code> Element</h3>
        <div data-tests="relations/html5-tree/display-1.html,presentation-markup/mrow/inferred-mrow-baseline.html,presentation-markup/mrow/inferred-mrow-stretchy.html,presentation-markup/direction/direction.html,presentation-markup/direction/direction-overall.html"></div>
        <p>MathML specifies a single top-level or root
          <dfn><code>&lt;math&gt;</code></dfn> element, which encapsulates each
          instance of MathML markup within a document. All other MathML content
          must be contained in a <code>&lt;math&gt;</code> element.
        </p>
        <p>
          The <code>&lt;math&gt;</code>
          element accepts the attributes described
          in <a href="#global-attributes"></a> as well as the
          following attribute:
        </p>
        <ul>
          <li><a>display</a></li>
        </ul>
        <p>
          The
          <dfn><code>display</code></dfn>
          attribute, if present,
          must have value <code>block</code> or <code>inline</code>.
          To fully implement this attribute, additional CSS properties must be
          specified in the user agent stylesheet
          as described in <a href="#user-agent-stylesheet"></a>.
        </p>
        <div class="issue" data-number="56">Improve layout description. Since
          the <code>math</code> element is already <code>inline</code> or
          <code>block</code> display, it should probably generate an anonymous
          mrow-like box container?
        </div>
        <p>
          The layout algorithm of the <code>&lt;math&gt;</code> element
          is the same as the <a><code>&lt;mrow&gt;</code></a> element. User agents must
          ensure correct baseline alignment, centering, sizing etc of the
          <code>&lt;math&gt;</code> element.
        </p>
        <div class="note">
          T<sub>E</sub>X's display mode <code>$...$</code>
          and inline mode <code>$...$</code> correspond to
          <code>display="block"</code> and <code>display="inline"</code>
          respectively.
        </div>
      </section>
    </section>
    <section class="normative">
      <h2>Presentation Markup</h2>
      <section>
        <h3>Introduction</h3>
        <section>
          <h4>Box Model</h4>
          <div class="issue" data-number="56">Specify special <code>display</code> values for
            other elements?</div>
          <p>
            The <code>&lt;math&gt;</code> root may have
            <code>inline</code> or <code>block</code> display, as suggested in
            <a href="#user-agent-stylesheet"></a>.
            Tabular MathML elements have <code>table</code>,
            <code>table-row</code>
            and <code>table-cell</code> display as discussed in
            <a href="#tabular-math"></a>.
            All the other elements have <code>block</code> display.
          </p>
          <p>
            In order to specify math layout in different
            <a data-cite="CSS-WRITING-MODES-3#writing-mode">writing modes</a>,
            this specification uses concepts from [[CSS-WRITING-MODES-3]]:
          </p>
          <ul>
            <li>
              <a data-cite="CSS-WRITING-MODES-3#abstract-dimensions">abstract dimensions</a>:
              <dfn>block dimension</dfn>,
              <dfn>inline dimension</dfn>,
              <dfn>block axis</dfn>,
              <dfn>inline axis</dfn>,
              <dfn>block size</dfn>,
              <dfn>inline size</dfn>.
            </li>
            <li>
              <a data-cite="CSS-WRITING-MODES-3#logical-directions">flow-relative directions</a>:
              <dfn>inline-start</dfn>,
              <dfn>inline-end</dfn>,
              <dfn>block-start</dfn>,
              <dfn>block-end</dfn>.
            </li>
            <li>
              <a data-cite="CSS-WRITING-MODES-3#line-relative-direction">line-relative directions</a>:
              <dfn>line-left</dfn>,
              <dfn>line-right</dfn>,
              <dfn>line-over</dfn>,
              <dfn>line-under</dfn>.
            </li>
          </ul>
          </p>
          <div class="note">
            Unless specified otherwise,
            the figures in this specification use a
            <a data-cite="CSS-WRITING-MODES-3#writing-mode">writing mode</a>
            of <code>horizontal-lr</code> and <code>ltr</code>.
            See <a href="#box-model-horizontal-tb-rtl"></a>,
            <a href="#box-model-vertical-lr"></a> and
            <a href="#box-model-vertical-rl"></a> for examples of other
            writing modes that are sometimes used for math layout.
          </div>
          <p>
            MathML boxes have several parameters in order to layout in
            a way that is compatible with CSS but also to take into account
            very accurate positions and spacing within math formulas.
            Each math box has the following parameters:
          </p>
          <ol>
            <li>Inline metrics.
              <a data-cite="CSS-SIZING-3#min-content-inline-size">min-content inline size</a>,
              <a data-cite="CSS-SIZING-3#max-content-inline-size">max-content inline size</a> and
              <a>inline size</a>
              from CSS. See <a href="#box-model-generic"></a>.
              <figure id="box-model-generic">
                <img src="figures/horizontal-tb-ltr.svg"/>
                <figcaption>Generic Box Model for MathML elements</figcaption>
              </figure>
            </li>
            <li>
              <p>
                Block metrics.
                The <a>block size</a>,
                <a data-cite="CSS-ALIGN-3#first-baseline-set">first baseline set</a>
                and
                <a data-cite="CSS-ALIGN-3#last-baseline-set">last baseline set</a>.
                The following baselines are defined for MathML boxes:
              </p>
              <ol>
                <li>
                  The <dfn>alphabetic baseline</dfn> also just called
                  the <dfn>baseline</dfn>. The distance between the
                  alphabetic baseline and the line-over
                  (respectively line-under) edge of the box is called
                  <dfn>line-ascent</dfn> (respectively <dfn>line-descent</dfn>).
                </li>
                <li>
                  The <dfn>mathematical baseline</dfn> also called
                  <dfn>math axis</dfn>. It is shifted away from the alphabetical
                  baseline by <a>AxisHeight</a> towards the line-over.
                </li>
                <li>
                  The <dfn>ink-over baseline</dfn>, indicating the line-over
                  theorical limit of math content (text, bars...) excluding any
                  extra space.
                  It is shifted away from the alphabetic baseline
                  by <dfn>ink line-ascent</dfn> towards the line-over.
                  If not specified, it is equal to the line-over axis.
                </li>
                <li>
                  The <dfn>ink-under baseline</dfn>, indicating the line-under
                  theorical limit of math content (text, bars...) without extra
                  space. It is shifted away from the alphabetic baseline
                  by <dfn>ink line-descent</dfn> towards the line-under.
                  If not specified, it is equal to the line-under axis.
                </li>
              </ol>
              <div class="issue" data-number="112">Define MathML line breaking?</div>
              Unless specified otherwise, the last baseline set is equal to the
              first baseline set for MathML boxes.
            </li>
            <li>
              An optional <dfn>italic correction</dfn>
              which provides a measure of how much the text of a box is
              slanted along the <a>inline axis</a>.
              See <a href="#figure-italic-correction"></a>.
              <figure id="figure-italic-correction">
                <img src="figures/italcorr.svg"/>
                <figcaption>Examples of italic correction for italic f and large integral</figcaption>
              </figure>
              If it is requested during calculation of min-content or
              max-content inline sizes or during layout
              then 0 is used as a fallback value.
            </li>
            <li>
              An optional <dfn>top accent attachment</dfn>
              which provides a reference offset on the
              <a>inline axis</a> of a box that should be used when
              positioning that box as an accent.
              See <a href="#figure-top-accent-attachment"></a>.
              <figure id="figure-top-accent-attachment">
                <img src="figures/topaccent.svg"/>
                <figcaption>Example of top accent attachment for a circumflex accent</figcaption>
              </figure>
              If it is requested during calculation of min-content
              (respectively max-content) inline size then half the
              min-content (respectively max-content) inline size is used as a
              fallback value.
              If it is requested during layout then half the
              inline size of the box is used as a fallback value.
            </li>
          </ol>
          <p>
            Given a MathML box, the <dfn>inline offset</dfn> of a child box
            is the distance between the
            <a>inline-start</a> edge of
            the parent box and the
            <a>inline-start</a> edge
            of the child.
            The <dfn>block offset</dfn> of a child box is the offset between
            <a>block-start</a> edge of
            the parent box and the
            <a>block-start</a> edge
            of the child.
          </p>
          <p>
            The <dfn>line-left offset</dfn>,
             <dfn>line-right offset</dfn>,
             <dfn>line-over offset</dfn> and
             <dfn>line-under offset</dfn> are defined similarly
             as offsets between the corresponding parent and child edges.
          </p>
          <figure id="box-model-horizontal-tb-rtl">
            <img src="figures/horizontal-tb-rtl.svg"/>
            <figcaption>Box model for writing mode <code>horizontal-tb</code> and <code>rtl</code> that may be used in e.g. Arabic math.</figcaption>
          </figure>
          <figure id="box-model-vertical-lr">
            <img src="figures/vertical-lr.svg"/>
            <figcaption>Box model for writing mode <code>vertical-lr</code> and <code>ltr</code> that may be used in e.g. Mongolian math.</figcaption>
          </figure>
          <figure id="box-model-vertical-rl">
            <img src="figures/vertical-rl.svg"/>
            <figcaption>Box model for writing mode <code>vertical-rl</code> and <code>ltr</code> that may be used in e.g. Japanese math.</figcaption>
          </figure>
          <div class="note">
            The position of children and graphical items inside a MathML
            box are expressed using the <code>inline offset</code>
            and <code>block offset</code>.
            For convenience, the layout algorithms may describe offsets using
            flow-relative directions, line-relative directions or
            the <a>baseline</a>.
            It is always possible to pass from one description to the other
            because position of children are always performed after the
            metrics of the box and of its children are calculated.
          </div>
          <div class="example">
            <p>Here are examples of offsets obtained from line-relative
              metrics:</p>
            <ul>
              <li>
                The <a>inline offset</a> of a child box is
                the <a>line-left offset</a> if the CSS property
                <a data-cite="CSS-WRITING-MODES-3#direction">direction</a>
                is <code>ltr</code> and
                is the inline size of the box −
                (<a>line-left offset</a> + inline size of
                the child) otherwise.
              </li>
              <li>
                The <a>block offset</a> of the <a>baseline</a> of a box
                is the <a>line-ascent</a>
                if the CSS property
                <a data-cite="CSS-WRITING-MODES-3#propdef-writing-mode">writing-mode</a>
                is <code>horizontal-lr</code>,
                <code>vertical-rl</code> or <code>sideways-rl</code>
                and is the <a>line-descent</a> otherwise.
              </li>
            </ul>
          </div>
        </section>
        <section>
          <h4>Layout Algorithms</h4>
          <p>
            The layout algorithms described in this chapter for MathML boxes
            have the following structure:
          </p>
          <ol>
            <li>
              Calculation of min-content / max-content inline size
              of the content.
            </li>
            <li>
              Box layout:
              <ol>
                <li>
                  Layout of children.
                </li>
                <li>
                  Calculation of inline size, (ink) line-ascent and
                  (ink) line-descent of the content.
                </li>
                <li>
                  Calculation of offsets of children within the content box as
                  well as sizes and offsets of extra graphical elements
                  (bars, radical symbol, etc).
                </li>
              </ol>
            </li>
            <li>
              Painting of extra graphical elements.
            </li>
          </ol>
          <p>
            During box layout, the following extra steps must be performed:
          </p>
          <ul>
            <li>
              After calculating the (ink) line-ascent
              and (ink) line-descent, the (ink) block size of the content
              is set to their sum.
            </li>
            <li>
              <div class="issue" data-number="45">Interpret
                width/height/inline-size/block-size?</div>
              <div class="issue" data-number="112">Define MathML line breaking?</div>
              The box metrics, offsets, baselines, <a>italic correction</a> and
              <a>top accent attachment</a> of the
              <a data-cite="CSS-BOX-3#content-box">content box</a>
              are set to the one calculated for the content.
            </li>
            <li>
              <p>
                The box metrics and offsets of the
                <a data-cite="CSS-BOX-3#padding-box">padding box</a>
                is obtained from the
                <a data-cite="CSS-BOX-3#content-box">content box</a>
                by taking into account the corresponding
                <a data-cite="CSS-BACKGROUNDS-3#padding-physical"><code>padding</code></a>
                properties as described in CSS.
              </p>
              <p>
                The baselines
                of the padding box are the same as the one of the content box.
              </p>
              <p>
                If the content box has a <a>top accent attachment</a>
                or <a>italic correction</a> then the padding box has the same
                properties, increased by the inline-start padding.
              </p>
            </li>
            <li>
              <p>
                The box metrics and offsets of the
                <a data-cite="CSS-BOX-3#border-box">border box</a>
                is obtained from the
                <a data-cite="CSS-BOX-3#padding-box">padding box</a>
                by taking into account the corresponding
                <a data-cite="CSS-BOX-3#the-border-width"><code>border-width</code></a>
                property as described in CSS.
              </p>
              <p>
                In general, the baselines of the border box are the same as
                the one of the padding box. However, if the line-over border is
                positive then the <a>ink-over baseline</a> is set to the
                line-over edge of the border box and if
                the line-under border is
                positive then the <a>ink-under baseline</a> is set to the
                line-under edge of the border box.
              </p>
              <p>
                If the padding box has a <a>top accent attachment</a>
                then the border box has the same top accent attachment value
                increased by the border-width of its inline-start edge.
              </p>
              <p>
                If the padding box has an <a>italic correction</a>
                and the border-width of the inline-end edge of the border box
                is zero then the border box has the same italic correction value
                increased by the border-width of its inline-start edge.
              </p>
            </li>
            <li>
              <p>
                The box metrics and offsets of the
                <a data-cite="CSS-BOX-3#margin-box">margin box</a>
                is obtained from the
                <a data-cite="CSS-BOX-3#border-box">border box</a>
                by taking into account the corresponding
                <a data-cite="CSS-BOX-3#margin-physical"><code>margin</code></a>
                properties as described in CSS.
              </p>
              <p>
                The baselines
                of the margin box are the same as the one of the border box.
              </p>
              <p>
                If the border box has a <a>top accent attachment</a>
                or <a>italic correction</a> then the margin box has the same
                properties, increased by the inline-start margin.
              </p>
            </li>
          </ul>
          <p>
            During box layout, optional
            <dfn>inline stretch size constraint</dfn> and
            <dfn>block stretch size constraint</dfn> parameters may be used on
            <a>embellished operators</a>. The former indicates
            a target size that a <a>core operator</a> stretched along
            the <a>inline axis</a> should cover.
            The latter indicates an ink line-ascent and ink line-descent
            that a <a>core operator</a> stretched along the <a>block axis</a>
            should cover.
            Unless specified otherwise, these parameters are ignored during
            the layout of the box and children are laid out without
            any stretch size constraint.
          </p>
        </section>
      </section>
      <section>
        <h3>Token Elements</h3>
        <div data-tests="presentation-markup/direction/direction-token.html"></div>
        <p>
          Token elements in presentation markup are broadly intended to
          represent the smallest units of mathematical notation which carry
          meaning. Tokens are roughly analogous to words in text. However,
          because of the precise, symbolic nature of mathematical notation, the
          various categories and properties of token elements figure
          prominently in MathML markup. By contrast, in textual data,
          individual words rarely need to be marked up or styled specially.
        </p>
        <div class="note">
          In practice, most MathML token elements just contain simple text
          for variables, numbers, operators etc and don't need sophisticated
          layout. However, it can contain contain text with line breaks or
          arbitrary HTML5 phrasing elements.
        </div>
        <section>
          <h4>Text <code>&lt;mtext&gt;</code></h4>
          <div data-tests="relations/css-styling/visibility-1.html,relations/css-styling/color-1.html"></div>
          <p>
            The
            <dfn><code>&lt;mtext&gt;</code></dfn>
            element is used to represent arbitrary text
            that should be rendered as itself. In general, the
            <code>&lt;mtext&gt;</code> element is intended to denote
            commentary text.
          </p>
          <p>
            The <code>&lt;mtext&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a>.
          </p>
          <section>
            <h4>Layout of <code>&lt;mtext&gt;</code></h4>
            <div class="issue" data-number="18">Handle orthogonal flow when CSS writing-mode changes?</div>
            <p>
              The <code>mtext</code> element is  as a
              <a data-cite="CSS-DISPLAY-3#block-box">block box</a>
              and the min-content/max-content inline sizes,
              inline size, block size, first/last baseline sets are determined
              accordingly.
            </p>
            <p>
              If the <code>&lt;mtext&gt;</code> element contains only text
              content without
              <a data-cite="CSS-TEXT-3#forced-line-break">forced line break</a>
              or
              <a data-cite="CSS-TEXT-3#soft-wrap-opportunity">soft wrap opportunity</a>
              then in addition:
            </p>
            <ul>
              <li>
                The <a>ink-over baseline</a> (respectively and
                <a>ink-under baseline</a>) is set to align with
                the line-over edge
                (respectively and <a>ink-under baseline</a>) of the
                ink bounding box of the text.
              </li>
              <li>
                If the text content is made of a single glyph and this glyph
                has an entry an entry in the
                <a>MathItalicsCorrectionInfo</a> table then the specified
                value is used as the italic correction.
              </li>
              <li>
                If the text content is made of a single glyph and this glyph
                has an entry in the <a>MathTopAccentAttachment</a> table
                then the specified value is used as the top accent attachment of
                the <code>&lt;mtext&gt;</code> element.
              <li>
                OpenType features are enabled as described in
                <a href="#opentype-features"></a>.
              </li>
            </ul>
          </section>
          <section>
            <h5>OpenType features</h5>
            <p>
              Good mathematical rendering requires use of non-Unicode glyphs.
              Mathematical fonts may only provide these glyphs when the
              <code>math</code> script tag is enabled [[OPEN-FONT-FORMAT]],
              so user agents must
              ensure that it is the case when rendering text inside the
              <code>&lt;mtext&gt;</code> element.
            </p>
            <p>
              If on the <code>&lt;mtext&gt;</code> element
              the CSS property
              <a data-cite="CSS-WRITING-MODES-3#direction"><code>direction</code></a>
              is <code>rtl</code>,
              then user agents must enable the <code>rtlm</code>
              OpenType feature on text nodes [[OPEN-FONT-FORMAT]]
              unless it contradicts what the
              page author has specified with the
              <code>font-feature-settings</code> CSS property.
            </p>
            <div class="issue" data-number="19">Add detailed rules for the ssty OpenType feature</div>
            <p>
              Some characters like primes already have script size by default
              and
              hence would be too small when used in a script position.
              To render such “prescripted” characters with the appropriate size,
              If a <code>&lt;mtext&gt;</code> has a positive
              <a><code>math-script-level</code></a> value then user agents must
              enable
              the <code>ssty</code> (Script Style) OpenType feature
              on its text nodes [[OPEN-FONT-FORMAT]]
              unless it contradicts what the page author has
              specified with the
              <a data-cite="CSS-FONTS-3#font-rend-desc"><code>font-feature-settings</code></a>
              CSS property.
          </p>
          </section>
        </section>
        <section>
          <h4>Identifier <code>&lt;mi&gt;</code></h4>
          <p>
            The
            <dfn><code>&lt;mi&gt;</code></dfn>
            element represents a symbolic name or
            arbitrary text
            that should be rendered as an identifier. Identifiers can include
            variables, function names, and symbolic constants.
          </p>
          <p>
            The <code>&lt;mi&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a>. Its layout algorithm is
            the same as the <a>&lt;mtext&gt;</a> element.
            The
            <a href="#user-agent-stylesheet">user agent stylesheet</a>
            must contain the following property in order to implement automatic
            italic:
          </p>
          <pre class="css" data-include="user-agent-stylesheet/mi.css"></pre>
        </section>
        <section>
          <h4>Number <code>&lt;mn&gt;</code></h4>
          <p>
            The
            <dfn><code>&lt;mn&gt;</code></dfn>
            element represents a "numeric literal" or
            other data that should be rendered as a numeric literal. Generally
            speaking, a numeric literal is a sequence of digits, perhaps including a
            decimal point, representing an unsigned integer or real number.
          </p>
          <p>
            The <code>&lt;mn&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a>. Its layout algorithm is
            the same as the
            <a><code>&lt;mtext&gt;</code></a> element.
          </p>
        </section>
        <section>
          <h4>Operator, Fence, Separator or Accent <code>&lt;mo&gt;</code></h4>
          <div data-tests="presentation-markup/mrow/inferred-mrow-stretchy.html,presentation-markup/operators/mo-form-fallback.html,presentation-markup/operators/mo-form-minus-plus.html,presentation-markup/operators/mo-form-dynamic.html,presentation-markup/operators/mo-movablelimits-dynamic.html,presentation-markup/operators/mo-axis-height-1.html,presentation-markup/operators/mo-form.html,presentation-markup/operators/mo-movablelimits.html,presentation-markup/operators/mo-movablelimits-default.html,presentation-markup/operators/mo-paint-lspace-rspace.html"></div>
          <p>
            The
            <dfn><code>&lt;mo&gt;</code></dfn>
            element represents an
            operator or anything that should be rendered as an operator.
            In general, the notational conventions for mathematical operators
            are quite complicated, and therefore MathML provides a relatively
            sophisticated mechanism for specifying the rendering behavior of an
            <code>&lt;mo&gt;</code> element.</p>
          <p>
            As a consequence, in MathML the
            list of things that should "render as an operator" includes a
            number of notations that are not mathematical operators in the
            ordinary sense. Besides ordinary operators with infix, prefix, or
            postfix forms, these include fence characters such as braces,
            parentheses, and "absolute value" bars; separators such as comma
            and semicolon; and mathematical accents such as a bar or tilde over
            a symbol. This chapter uses the term "operator" to refer to
            operators in this broad sense.
          </p>
          <p>
            The <code>&lt;mo&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a> as well as the following
            attributes:
          </p>
          <ul>
            <li><a><code>form</code></a></li>
            <li><a><code>fence</code></a></li>
            <li><a><code>separator</code></a></li>
            <li><a><code>lspace</code></a></li>
            <li><a><code>rspace</code></a></li>
            <li><a><code>stretchy</code></a></li>
            <li><a><code>symmetric</code></a></li>
            <li><a><code>maxsize</code></a></li>
            <li><a><code>minsize</code></a></li>
            <li><a><code>largeop</code></a></li>
            <li><a><code>movablelimits</code></a></li>
            <li><a><code>accent</code></a></li>
          </ul>
          <section>
            <h5>Embellished operators</h5>
            <p>
              A <a>MathML Core element</a> is an
              <dfn data-lt="embellished">embellished operator</dfn>
              if is is:
            </p>
            <ol>
              <li>An <a><code>&lt;mo&gt;</code></a> element;</li>
              <li>
                Or one of the elements <a><code>&lt;msub&gt;</code></a>,
                <a><code>&lt;msup&gt;</code></a>,
                <a><code>&lt;msubsup&gt;</code></a>,
                <a><code>&lt;munder&gt;</code></a>,
                <a><code>&lt;mover&gt;</code></a>,
                <a><code>&lt;munderover&gt;</code></a>,
                <a><code>&lt;mmultiscripts&gt;</code></a>,
                <a><code>&lt;mfrac&gt;</code></a>,
                <a><code>&lt;semantics&gt;</code></a> or
                <a><code>&lt;maction&gt;</code></a>
                whose first child exists and is an
                <a>embellished operator</a>;
              </li>
              <li>
                Or one of the elements
                <a><code>&lt;mrow&gt;</code></a>,
                <a><code>&lt;mstyle&gt;</code></a>,
                <a><code>&lt;mphantom&gt;</code></a>,
                <a><code>&lt;mpadded&gt;</code></a>
                whose children consist (in any order) of one
                <a>embellished operator</a> and zero or more
                <a>space-like</a> elements.
              </li>
            </ol>
            <p>
              The <dfn>core operator</dfn> of an <a>embellished operator</a>
              is the <code>&lt;mo&gt;</code> element defined recursively as
              follows:
            </p>
            <ol>
              <li>The core operator of an <a><code>&lt;mo&gt;</code></a>
                element; is the element itself.</li>
              <li>
                The core operator of an embellished
                <a><code>&lt;msub&gt;</code></a>,
                <a><code>&lt;msup&gt;</code></a>,
                <a><code>&lt;msubsup&gt;</code></a>,
                <a><code>&lt;munder&gt;</code></a>,
                <a><code>&lt;mover&gt;</code></a>,
                <a><code>&lt;munderover&gt;</code></a>,
                <a><code>&lt;mmultiscripts&gt;</code></a>,
                <a><code>&lt;mfrac&gt;</code></a>,
                <a><code>&lt;semantics&gt;</code></a> or
                <a><code>&lt;maction&gt;</code></a>
                element is the core operator of its first child.
              </li>
              <li>
                The core operator of an embellished
                <a><code>&lt;mrow&gt;</code></a>,
                <a><code>&lt;mstyle&gt;</code></a>,
                <a><code>&lt;mphantom&gt;</code></a>,
                <a><code>&lt;mpadded&gt;</code></a>
                is the core operator of its unique <a>embellished operator</a>
                child.
              </li>
            </ol>
            <p>
              The <dfn>stretch axis</dfn> of an <a>embellished operator</a>
                is <em>inline</em> if its
              <a>core operator</a> contains only text content
              made of a unique character <code>c</code> and that
              character has stretch axis <em>inline</em> per
              <a href="#stretchy-operator-axis"></a>.
              Otherwise, stretch axis of the <a>embellished operator</a>
              is <em>block</em>.
            </p>
          </section>
          <section>
            <h4>Dictionary-based attributes</h4>
            <p>
              The <dfn><code>form</code></dfn>
              property of an <a>embellished operator</a>
              element must be a case-insensitive match to <code>infix</code>, <code>prefix</code> or
              <code>postfix</code>.
              The <code>form</code> attribute can only be defined on its <a>core operator</a> (an
              <a><code>&lt;mo&gt;</code></a> element).
            </p>
            <p>
              The <code>form</code> of the <a>embellished operator</a> is determined as follows:
            </p>
            <ol>
			  <li>If the <code>form</code> attribute is present and valid
                on the <a>core operator</a>, then its value is used;
			  </li>
              <li>If the embellished operator is the first child of an
                <a>&lt;math&gt;</a>
                <a>&lt;menclose&gt;</a>
                <a>&lt;merror&gt;</a>
                <a>&lt;mpadded&gt;</a>
                <a>&lt;mphantom&gt;</a>
                <a>&lt;mrow&gt;</a>
                <a>&lt;msqrt&gt;</a> or
                <a>&lt;mstyle&gt;</a> element with more than one child
                (ignoring all <a>space-like</a> children) then it has
                form <code>prefix</code>;
              </li>
              <li>Or, if the embellished operator is the last child of an
                <a><code>&lt;math&gt;</code></a>,
                <a><code>&lt;menclose&gt;</code></a>,
                <a><code>&lt;merror&gt;</code></a>,
                <a><code>&lt;mpadded&gt;</code></a>,
                <a><code>&lt;mphantom&gt;</code></a>,
                <a><code>&lt;mrow&gt;</code></a>,
                <a><code>&lt;msqrt&gt;</code></a> or
                <a><code>&lt;mstyle&gt;</code></a> element
                with more than one child
                (ignoring all <a>space-like</a> children) then it has
                form <code>postfix</code>;
              <li>Or, if the embellished operator is a child of an
                <a><code>&lt;msub&gt;</code></a>,
                <a><code>&lt;msup&gt;</code></a>,
                <a><code>&lt;msubsup&gt;</code></a>,
                <a><code>&lt;munder&gt;</code></a>,
                <a><code>&lt;mover&gt;</code></a>,
                <a><code>&lt;munderover&gt;</code></a> or
                <a><code>&lt;mmultiscripts&gt;</code></a>
                element other than the first child, then it has form
                <code>postfix</code>;
              </li>
              <li>
                Otherwise, the embellished operator has form
                <code>infix</code>.
              </li>
            </ol>
            <p>
              The
              <dfn><code>fence</code></dfn>,
              <dfn><code>separator</code></dfn>,
              <dfn><code>stretchy</code></dfn>,
              <dfn><code>symmetric</code></dfn>,
              <dfn><code>largeop</code></dfn>,
              <dfn><code>movablelimits</code></dfn>,
              <dfn><code>accent</code></dfn>
              properties of an <a>embellished operator</a> are is either
              <code>true</code> or <code>false</code>. In the former case, it
              is said that the <a>embellished operator</a> <em>has</em> the
              property.
			  The corresponding attributes can only be defined on their <a>core operator</a> (an
              <a><code>&lt;mo&gt;</code></a> element) and must be <a>boolean</a>.
            </p>
            <p>
              The
              <dfn><code>lspace</code></dfn>,
              <dfn><code>rspace</code></dfn>,
              <dfn><code>minsize</code></dfn>
              properties of an <a>embellished operator</a> are
              <a>length-percentage</a>.
              The <dfn><code>maxsize</code></dfn> property
              of an <a>embellished operator</a> is either an
              <a>length-percentage</a> or <code>infinity</code>.
              The
              <code>lspace</code>,
              <code>rspace</code>,
              <code>minsize</code> and
              <code>maxsize</code> attributes can only be defined on their <a>core operator</a> (an
              <a><code>&lt;mo&gt;</code></a> element) and must be <a>length-percentage</a>.
            </p>
            <p>
              The
              <code>fence</code>,
              <code>separator</code>,
              <code>stretchy</code>,
              <code>symmetric</code>,
              <code>largeop</code>,
              <code>movablelimits</code>,
              <code>accent</code>,
              <code>lspace</code>,
              <code>rspace</code>,
              <code>maxsize</code>,
              <code>minsize</code> properties of
              an <a>embellished operator</a> are determined as follows:
            </p>
            <ol>
              <li>If the corresponding attribute is present and valid
                on the <a>core operator</a>, then this property is used;</li>
              <li>
                Otherwise, if the <a>core operator</a> contains only text
                content T, the corresponding property from the
                <a href="#operator-dictionary">Operator Dictionary</a>
                is retrieved by looking for <code>Content=T,Form=F</code>
                where <code>F</code> is the <a><code>form</code></a> of the
                <a>embellished operator</a>;
              </li>
              <li>
                If no entry is found and the <a><code>form</code></a>
                of <a>embellished operator</a> was not explicitly specified
                as an attribute on its <a>core operator</a>, then
                user agents must try other dictionary entries for different
                values of <code>F</code> in the following order:
                <code>infix</code>, <code>prefix</code>, <code>postfix</code>;
              </li>
              <li>
                Otherwise, use the value  <code>false</code> for
                <code>fence</code>,
                <code>separator</code>,
                <code>stretchy</code>,
                <code>symmetric</code>,
                <code>largeop</code>,
                <code>movablelimits</code> and
                <code>accent</code> properties ;
                <code>0.2777777777777778em</code> for
                <code>lspace</code> and
                <code>rspace</code> properties ;
                <code>100%</code> for the <code>minsize</code> property and
                <code>infinity</code> for the <code>maxsize</code> property.
              </li>
            </ol>
            <p>
              Percentage values for <code>lspace</code>,
              <code>rspace</code>
              properties of an <a>embellished operator</a>
              are interpreted relative to the value read from the dictionary
              or to the fallback value above.
            </p>
            <p>
              Percentages value for <code>minsize</code>
              and
              <code>maxsize</code>
              properties of an <a>embellished operator</a>
              are interpreted relative to
              the target stretch size before application of
              size constraints, as described in
              <a href="#algorithm-for-stretching-operators-along-the-block-axis"></a>.
            </p>
          </section>
          <section>
            <h4>Layout of operators</h4>
            <p>
              The text of the operator must only be painted if the
              <a data-cite="CSS2#visibility"><code>visibility</code></a> of
              the <code>&lt;mo&gt;</code> element is <code>visible</code>.
              In that case, it must be painted with the
              <a data-cite="CSS-COLOR-3#foreground"><code>color</code></a>
              of the <code>&lt;mo&gt;</code> element.
            </p>
            <p>Operators are laid out as follows:</p>
            <ol>
              <li>
                If the content of the <code>&lt;mo&gt;</code> element is not
                made
                of a single character <code>c</code> then fallback to the
                layout algorithm of <a href="#layout-of-mtext"></a>.
              </li>
              <li>
                If the operator has the <a>stretchy</a> property:
                <ul>
                  <li>
                    If the <a>stretch axis</a> of the operator is inline
                    then
                    <ol>
                      <li>
                        Try and get a
                        <code>MathVariants.horizGlyphConstructionOffsets</code>
                        table from the glyph corresponding to
                        <code>c</code> in the current font, or otherwise
                        from the entry
                        <a href="#unicode-based-glyph-assemblies"></a>
                        with base character <code>c</code>.
                        If that's not possible then
                        fallback to the
                        layout algorithm of <a href="#layout-of-mtext"></a>.
                      </li>
                      <li>
                        The min-content/max-content inline sizes of the content
                        are set to the one obtained by the layout algorithm of
                        <a href="#layout-of-mtext"></a>.
                      </li>
                      <li>
                        If there is not any
                        <a>inline stretch size constraint</a>
                        <code>T<sub>inline</sub></code>
                        then
                        fallback to the
                        layout algorithm of <a href="#layout-of-mtext"></a>.
                      </li>
                      <li>
                        The inline size and (ink) block metrics of the content
                        are given by the
                        <a>box metrics of a stretchy glyph</a>
                        stretched to <a>inline dimension</a>
                        <code>T<sub>inline</sub></code>.
                      </li>
                      <li>
                        The painting of the operator is performed by the
                        algorithm
                        to <a>shape a stretchy glyph</a>
                        stretched to <a>inline dimension</a>
                        <code>T</code> and
                        at position determined by the previous box metrics.
                      </li>
                    </ol>
                  </li>
                  <li>
                    Otherwise, the <a>stretch axis</a> of the operator is
                    block. The following steps are performed:
                    <ol>
                      <li>
                        Try and get a
                        <code>MathVariants.vertGlyphConstructionOffsets</code>
                        table from the glyph corresponding to
                        <code>c</code> in the current font, or otherwise
                        from the entry of
                        <a href="#unicode-based-glyph-assemblies"></a>
                        with base character <code>c</code>.
                        If that's not possible then
                        fallback to the
                        layout algorithm of <a href="#layout-of-mtext"></a>.
                      </li>
                      <li>
                        The min-content/max-content inline sizes of the content
                        are set to the
                        <a>preferred inline size of a glyph stretched
                          along the block axis</a>.
                      </li>
                      <li>
                        If there is not any
                        <a>block stretch size constraint</a>
                        <code>(T<sub>ascent</sub>, T<sub>descent</sub>)</code>
                        then
                        fallback to the
                        layout algorithm of <a href="#layout-of-mtext"></a>.
                      </li>
                      <li>
                        The inline size and ink block metrics of the content
                        are obtained from the
                        <a>box metrics of a stretchy glyph</a>
                        stretched to <a>block dimension</a>
                        <code>T<sub>ascent</sub></code> +
                        <code>T<sub>descent</sub></code>.
                        The inline size is the stretchy glyph width returned.
                        If Δ = <code>T<sub>ascent</sub></code> +
                        <code>T<sub>descent</sub></code> −
                        (stretchy glyph ascent + stretchy glyph descent)
                        then the ink ascent of the content is
                        <code>T<sub>ascent</sub></code> + Δ/2
                        and the ink descent of the content is
                        <code>T<sub>descent</sub></code> + Δ/2.
                        The ascent and descent of the content
                        are the same as the ink
                        ascent and ink descent of the content.
                      </li>
                      <li>
                        The painting of the operator is performed by the
                        algorithm
                        to <a>shape a stretchy glyph</a>
                        stretched to <a>block dimension</a> <code>T</code> and
                        at position determined by the previous box metrics
                        shifted by Δ/2 towards the line-over.
                      </li>
                    </ol>
                    <figure id="figure-base-variants-and-assembly">
                      <img src="figures/bracesize.svg"/>
                      <figcaption>Base size, size variants and glyph assembly
                        for
                        the left brace</figcaption>
                    </figure>
                  </li>
                </ul>
              </li>
              <li>
                If <a><code>math-style</code></a> on
                the <code>&lt;mo&gt;</code> element is <code>display</code>,
                then:
                <ol>
                  <li>
                    <div class="issue">Clarify/improve this?
                      How important is this MATH parameter? "integrals"
                      is not defined</div>
                    <p>
                      Use the
                      <code>MathVariants</code>
                      table to try and find a glyph of height at least
                      <a>DisplayOperatorMinHeight</a>
                      If none is found, fallback to the
                      largest non-base glyph. If none is found, fallback to
                      the layout algorithm of <a href="#layout-of-mtext"></a>.
                    </p>
                    <p>
                      Because this parameter does not always give
                      the best size, user agents may also use the following
                      heuristic: ensure that the large variant height is at
                      least
                      2 times as large as the base height for integrals and √2
                      times as large as the base height for other operators.
                    </p>
                  </li>
                  <li>
                    The min-content/max-content inline sizes,
                    inline size and block metrics of the content
                    are given by the
                    glyph found.
                  </li>
                  <li>
                    Paint the glyph.
                  </li>
                </ol>
                <figure id="figure-sum-base-and-displastyle-sizes">
                  <img src="figures/sumsize.svg"/>
                  <figcaption>Base and displaystyle sizes of the summation symbol</figcaption>
                </figure>
              </li>
              <li>
                Other fallback to the
                layout algorithm of <a href="#layout-of-mtext"></a>.
              </li>
            </ol>
          </section>
        </section>
        <section>
          <h4>Space <code>&lt;mspace&gt;</code></h4>
          <div data-tests="relations/css-styling/lengths-1.html,relations/css-styling/lengths-2.html,presentation-markup/spaces/space-2.html,presentation-markup/spaces/mspace-children.html,presentation-markup/spaces/space-1.html"></div>
          <p>
            The
            <dfn><code>&lt;mspace&gt;</code></dfn>
            empty element represents a blank space of any
            desired size, as set by its attributes.
          </p>
          <p>
            The <code>&lt;mspace&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a> as well as the following
            attributes:
          </p>
          <ul>
            <li><a href="#attribute-mspace-width" class="internalDFN" data-link-type="dfn"><code>width</code></a></li>
            <li><a href="#attribute-mspace-height" class="internalDFN" data-link-type="dfn"><code>height</code></a></li>
            <li><a href="#attribute-mspace-depth" class="internalDFN" data-link-type="dfn"><code>depth</code></a></li>
          </ul>
          <div class="issue" data-number="40">Allow negative width, lspace to
            produce negative spacing?</div>
          <p>The
            <dfn id="attribute-mspace-width"><code>mspace@width</code></dfn>,
            <dfn id="attribute-mspace-height"><code>mspace@height</code></dfn>,
            <dfn id="attribute-mspace-depth"><code>mspace@depth</code></dfn>, if present, must
            have a value that is a valid <a>length-percentage</a>.
            An unspecified attribute, a percentage  value, or an invalid value
            is interpreted as <code>0</code>.
            If one of the requested values calculated is negative then it is
            treated as <code>0</code>.
          </p>
          <p>
            The <code>&lt;mspace&gt;</code> element is laid out as shown on
            <a href="#figure-box-mspace"></a>.
            The min-content and max-content inline sizes of the content are
            equal to the requested inline size.
            The inline size, line-ascent and line-descent of the content
            are respectively
            the requested inline size, line-ascent and line-descent.
            The ink line-ascent (respectively ink line-descent) of the content
            is the same
            as the line-ascent (respectively line-descent) of the content.
          </p>
          <figure id="figure-box-mspace">
            <img src="figures/mspacebox.svg"/>
            <figcaption>Box model for the <code>&lt;mspace&gt;</code> element</figcaption>
          </figure>
          <div class="note">
            The terminology height/depth comes from [[MATHML3]], itself inspired
            from [[TEXBOOK]].
          </div>
          <section>
            <h3>Definition of space-like elements</h3>
            <p>
              A number of MathML presentation elements are "space-like" in the
              sense that they typically render as whitespace, and do not affect
              the mathematical meaning of the expressions in which they appear.
              As a consequence, these elements often function in somewhat
              exceptional ways in other MathML expressions.
            </p>
            <p>
              A <a>MathML Core element</a> is a
              <dfn data-lt="space-like">space-like element</dfn>
              if is is:
            </p>
            <ul>
              <li>An
                <a><code>&lt;mtext&gt;</code></a> or
                <a><code>&lt;mspace&gt;</code></a>.
              </li>
              <li>Or an
                <a><code>&lt;mrow&gt;</code></a>,
                <a><code>&lt;mstyle&gt;</code></a>,
                <a><code>&lt;mphantom&gt;</code></a>,
                <a><code>&lt;mpadded&gt;</code></a> element
                all of whose children are <a>space-like</a>;
              </li>
              <li>
                An <a><code>&lt;maction&gt;</code></a>
                or <a><code>&lt;semantics&gt;</code></a> element
                whose first child exists and is <a>space-like</a>.
              </li>
            </ul>
            <div class="note">
              Note that an <a><code>&lt;mphantom&gt;</code></a> is not
              automatically defined to be space-like, unless its content is
              space-like. This is because operator spacing is affected by
              whether adjacent elements are space-like.
              Since the <code>&lt;mphantom&gt;</code> element is
              primarily intended as an aid in aligning expressions, operators
              adjacent to an <code>&lt;mphantom&gt;</code> should behave
              as if they were adjacent to the contents of the
              <code>&lt;mphantom&gt;</code>, rather than to an equivalently
              sized area of whitespace.
            </div>
          </section>
        </section>
        <section>
          <h4>String Literal <code>&lt;ms&gt;</code></h4>
          <p>
            <dfn><code>&lt;ms&gt;</code></dfn>
            element is used to represent
            "string literals" in expressions meant to be interpreted by computer
            algebra systems or other systems containing "programming languages".
          </p>
          <p>
            The <code>&lt;mn&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a> as well as the following
            attributes:
          </p>
          <ul>
            <li><a><code>lquote</code></a></li>
            <li><a><code>rquote</code></a></li>
          </ul>
          <p>The
            <dfn><code>lquote</code></dfn>,
            <dfn><code>rquote</code></dfn> attributes respectively specify the strings to use as opening and
            closing quotes. An unspecified attribute is
            interpreted as the character U+0022 QUOTATION MARK.
          </p>
          <p>
            The layout algorithm is the same as the
            <a><code>&lt;mtext&gt;</code></a> element.
            The <a href="#user-agent-stylesheet">user agent stylesheet</a>
            must contain the following rules in order to enclose the content with
            quotes:
          </p>
          <pre class="css" data-include="user-agent-stylesheet/ms.css"></pre>
        </section>
      </section>
      <section>
        <h3>General Layout Schemata</h3>
        <p>Besides tokens there are several families of MathML presentation
          elements. One family of elements deals with various "scripting"
          notations, such as subscript and superscript. Another family is
          concerned with matrices and tables. The remainder of the elements,
          discussed in this section, describe other basic notations such as
          fractions and radicals, or deal with general functions such as
          setting style properties and error handling.
        </p>
        <section id="horizontally-group-sub-expressions-mrow">
          <h4>Group Sub-Expressions <code>&lt;mrow&gt;</code></h4>
          <div data-tests="presentation-markup/mrow/inferred-mrow-baseline.html,presentation-markup/mrow/inferred-mrow-stretchy.html,presentation-markup/direction/direction-overall.html,presentation-markup/fractions/frac-mrow-001.html"></div>
          <p>
            The
            <dfn><code>&lt;mrow&gt;</code></dfn>
            element is used to group together any number of sub-expressions, usually
            consisting of one or more <code>&lt;mo&gt;</code> elements acting as
            "operators" on one or more other expressions that are their "operands".
          </p>
          <p>
            The <code>&lt;mrow&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a>. An <code>&lt;mrow&gt;</code>
            element with children
            child<sub>1</sub>, child<sub>2</sub>, … child<sub>N</sub>
            is laid out as show on <a href="#figure-box-mrow"></a>. The child boxes
            are put in a row one after the other with all their baselines
            aligned.
          </p>
          <figure id="figure-box-mrow">
            <img src="figures/mrowbox.svg"/>
            <figcaption>Box model for the <code>&lt;mrow&gt;</code> element</figcaption>
          </figure>
          <p>
          <div class="note">
            Because the box model ensure alignment of baselines,
            fraction bars or symmetric stretchy operators
            will also be aligned along the math axis in the typical case when
            <a>AxisHeight</a> is the same for all children.
          </div>
          <section>
            <h5>Algorithm for stretching operators along the block axis</h5>
            <figure id="symmetric-and-non-symmetric-vertical-stretching">
              <img src="figures/vstretch.svg"/>
              <figcaption>Symmetric and non-symmetric stretching of
                operators along the <a>block axis</a></figcaption>
            </figure>
            <p>
              The <dfn>Algorithm for stretching operators along the block axis</dfn>
              consists in the following steps:
            </p>
            <ol>
              <li>
                If there is a <a>block stretch size constraint</a>
                or and <a>inline stretch size constraint</a>
                then the element being laid out is an
                <a>embellished operator</a>. Layout the one child that is
                an <a>embellished operator</a>
                with the same stretch size constraint and
                all the other children without any stretch size constraint
                and stop.
              </li>
              <li>
                Layout all the children of the
                <code>&lt;mrow&gt;</code> but the
                <a>embellished operators</a> that have
                the <a>stretchy</a> property and block <a>stretch axis</a>.
                If this step results in all the children being laid out, then
                stop.
              </li>
              <li>
                Calculate the unconstrained target sizes
                <code>U<sub>ascent</sub></code>
                and <code>U<sub>descent</sub></code> as respectively the maximum
                ink ascent and maximum ink descent of the margin boxes of
                children that
                have been laid out in the previous step.
              </li>
              <li>
                Calculate the symmetric target sizes:
                <ul>
                  <li>
                    <code>S<sub>ascent</sub></code> =
                    max(
                    <code>U<sub>ascent</sub></code> − <a>AxisHeight</a>,
                    <code>U<sub>descent</sub></code> + <a>AxisHeight</a>
                    ) + <a>AxisHeight</a>
                  </li>
                  <li>
                    <code>S<sub>ascent</sub></code> =
                    max(
                    <code>U<sub>ascent</sub></code> − <a>AxisHeight</a>,
                    <code>U<sub>descent</sub></code> + <a>AxisHeight</a>
                    ) + <a>AxisHeight</a>
                  </li>
                </ul>
              </li>
              <li>
                For each <a>embellished operators</a>
                child of <code>&lt;mrow&gt;</code>
                with the <a>stretchy</a> property and block <a>stretch axis</a>:
                <ol>
                  <li>
                    If the child has the <a>symmetric</a> property
                    then set the target sizes
                    <code>T<sub>ascent</sub></code> and
                    <code>T<sub>descent</sub></code> to
                    <code>S<sub>ascent</sub></code> and
                    <code>S<sub>descent</sub></code> respectively.
                    Otherwise set them to
                    <code>U<sub>ascent</sub></code> and
                    <code>U<sub>descent</sub></code> respectively.
                  </li>
                  <li>
                    Let <code>minsize</code> and <code>maxsize</code>
                    be the <a>minsize</a> and <a>maxsize</a> properties on the
                    child. Percentage values are intepreted relative
                    to <code>T</code> =
                    <code>T<sub>ascent</sub></code> +
                    <code>T<sub>descent</sub></code>.
                    If 0 ≤ <code>minsize</code> ≤ <code>maxsize</code> then:
                    <ul>
                      <li>
                        If <code>T</code> = 0 then set
                        <code>T<sub>ascent</sub></code> and
                        <code>T<sub>descent</sub></code>
                        to <code>minsize</code>/2.
                      </li>
                      <li>
                        Otherwise, if
                        0 &lt; <code>T</code> &lt; <code>minsize</code>
                        then
                        multiply
                        <code>T<sub>ascent</sub></code>,
                        <code>T<sub>descent</sub></code>
                        by <code>minsize</code> / <code>T</code>.
                      </li>
                      <li>
                        Otherwise, if <code>maxsize</code> &lt; <code>T</code>
                        then multiply
                        <code>T<sub>ascent</sub></code>,
                        <code>T<sub>descent</sub></code>
                        by <code>maxsize</code> / <code>T</code>.
                      </li>
                    </ul>
                  </li>
                  <li>
                    Layout the child with
                    <a>block stretch size constraint</a>
                    <code>(T<sub>ascent</sub>, T<sub>descent</sub>)</code>.
                  </li>
                </ol>
              </li>
            </ol>
          </section>
          <section>
            <h5>Layout of <code>&lt;mrow&gt;</code></h5>
            <div class="issue" data-number="112">Define MathML line breaking?</div>
            <p>
              A child is <dfn>slanted</dfn> if it is not an
              <a>embellished operator</a>
              and has nonzero <a>italic correction</a>.
            </p>
            <div class="note">
              Large operators may have nonzero italic correction but that one
              is used when attaching scripts.
              More generally, all <a>embellished operator</a>
              are treated as non-slanted since the spacing is designed to
              around them as specifed by <a><code>lspace</code></a> and
              <a><code>rspace</code></a>.
            </div>
            <p>
              The min-content (respectively max-content) inline size are
              calculated using the following algorithm:
            </p>
            <ol>
              <li>
                Set <code>add-space</code> to true if
                the <code>&lt;mrow&gt;</code> is not an
                <a>embellished operator</a>; and to false otherwise.
              </li>
              <li>Set <code>inline-offset</code> to 0.</li>
              <li>Set <code>previous-italic-correction</code> to 0.</li>
              <li>
                For each child:
                <ol>
                  <li>
                    If the child is not <a>slanted</a>, then increment
                    <code>inline-offset</code> by
                    <code>previous-italic-correction</code>.
                  </li>
                  <li>
                    If the child is an <a>embellished operators</a>
                    and <code>add-space</code> is true then
                    increment <code>inline-offset</code> by
                    its <a><code>lspace</code></a> property.
                  </li>
                  <li>
                    Increment <code>inline-offset</code> by
                    the min-content (respectively max-content) inline size of
                    the child's margin box.
                  </li>
                  <li>
                    If the child is <a>slanted</a> then
                    set <code>previous-italic-correction</code> to
                    its <a>italic correction</a>. Otherwise set it to 0.
                  </li>
                  <li>
                    If the child is an <a>embellished operators</a>
                    and <code>add-space</code> is true then
                    increment <code>inline-offset</code> by
                    its <a><code>rspace</code></a> property.
                  </li>
                </ol>
              </li>
              <li>
                Increment <code>inline-offset</code> by
                <code>previous-italic-correction</code>.
              </li>
              <li>
                Return <code>inline-offset</code>.
              </li>
            </ol>
            <p>
              The children are laid out using the
              <a>algorithm for stretching operators along the block axis</a>.
            </p>
            <p>
              The inline size of the content is calculated like
              the min-content and max-content inline sizes of the content,
              using the inline size of the children's margin boxes instead.
            </p>
            <p>
              The (ink) line-ascent of the content
              is the maximum of the (ink) line-ascents
              of all the children's margin boxes. Similarly,
              the (ink) line-descent of the content
              is the maximum of the (ink) line-descents
              of all the children's margin boxes.
            </p>
            <p>
              Finally, the children are positioned using the following
              algorithm:
            </p>
            <ol>
              <li>
                Set <code>add-space</code> to true if
                the <code>&lt;mrow&gt;</code> is not an
                <a>embellished operator</a>; and to false otherwise.
              </li>
              <li>Set <code>inline-offset</code> to 0.</li>
              <li>Set <code>previous-italic-correction</code> to 0.</li>
              <li>For each child:
                <ol>
                  <li>
                    If the child is not <a>slanted</a>, then increment
                    <code>inline-offset</code> by
                    <code>previous-italic-correction</code>.
                  </li>
                  <li>
                    If the child is an <a>embellished operators</a>
                    and <code>add-space</code> is true then
                    increment <code>inline-offset</code> by
                    its <a><code>lspace</code></a> property.
                  </li>
                  <li>
                    Set the inline offset of the child
                    to <code>inline-offset</code> and its block offset such
                    that the baseline of the child is aligned with the baseline.
                  </li>
                  <li>
                    Increment <code>inline-offset</code> by
                    the inline size of the child's margin box.
                  </li>
                  <li>
                    If the child is <a>slanted</a> then
                    set <code>previous-italic-correction</code> to
                    its <a>italic correction</a>. Otherwise set it to 0.
                  </li>
                  <li>
                    If the child is an <a>embellished operators</a>
                    and <code>add-space</code> is true then
                    increment <code>inline-offset</code> by
                    its <a><code>rspace</code></a> property.
                  </li>
                </ol>
              </li>
            </ol>
          </section>
        </section>
        <section>
          <h4>Fractions <code>&lt;mfrac&gt;</code></h4>
          <div data-tests="presentation-markup/fractions/frac-created-dynamically-3.html,presentation-markup/fractions/frac-parameters-gap-006.html,presentation-markup/fractions/frac-bar-001.html,presentation-markup/fractions/frac-linethickness-001.html,presentation-markup/fractions/frac-parameters-gap-001.html,presentation-markup/fractions/frac-visibility-001.html,presentation-markup/fractions/frac-parameters-gap-005.html,presentation-markup/fractions/frac-parameters-1.html,presentation-markup/fractions/frac-parameters-gap-004.html,presentation-markup/fractions/frac-parameters-gap-002.html,presentation-markup/fractions/frac-1.html,presentation-markup/fractions/frac-parameters-2.html,presentation-markup/fractions/frac-color-002.html,presentation-markup/fractions/frac-linethickness-002.html,presentation-markup/fractions/frac-numalign-denomalign-001.html,presentation-markup/fractions/frac-created-dynamically.html,presentation-markup/fractions/frac-linethickness-004.html,presentation-markup/fractions/frac-color-001.html,presentation-markup/fractions/frac-created-dynamically-2.html,presentation-markup/fractions/frac-mrow-001.html,presentation-markup/fractions/frac-linethickness-003.html,presentation-markup/fractions/frac-parameters-gap-003.html"></div>
          <p>
            The
            <dfn><code>&lt;mfrac&gt;</code></dfn>
            element is used for fractions. It can also be used to mark up
            fraction-like objects such as binomial coefficients and Legendre symbols.
          </p>
          <p>
            The <code>&lt;mfrac&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a> as well as the
            following attribute:
          </p>
          <ul>
            <li><a>linethickness</a></li>
          </ul>
          <p>
            The
            <dfn><code>linethickness</code></dfn>
            attribute indicates the thickness to use for the fraction bar.
            If present, it must
            have a value that is a valid <a>length-percentage</a>.
            If the attribute is absent or has an invalid value,
            <a>FractionRuleThickness</a> is used as the default
            value. A percentage is interpreted relative to that default value.
          </p>
          <p>
            The <code>&lt;mfrac&gt;</code> element sets
            <code>displaystyle</code> to <code>false</code>,
            or if it was already <code>false</code> increments
            <code>scriptlevel</code> by 1, within its children.
            To avoid visual confusion between the fraction bar and another
            adjacent items (e.g. minus sign or another fraction's bar),
            a default 1-pixel space is added around the element.
            The <a href="#user-agent-stylesheet">user agent stylesheet</a>
            must contain the following rules:
          </p>
          <pre class="css" data-include="user-agent-stylesheet/mfrac.css"></pre>
          <div class="issue" data-number="15">Decide how to handle invalid
            markup.</div>
          <p>
            If the <code>&lt;mfrac&gt;</code> element
            has less or more than two children, its layout algorithm
            is the same as the <a><code>&lt;mrow&gt;</code></a> element.
            Otherwise, the first child is called
            <em>numerator</em>, the second child is called
            <em>denominator</em> and the layout algorithm is explained below.
          </p>
          <section>
            <h5>Fraction with nonzero line thickness</h5>
            <div data-tests="relations/css-styling/visibility-1.html,relations/css-styling/color-1.html"></div>
            <p>
              If the actual line thickness is nonzero, the
              <code>&lt;mfrac&gt;</code>
              element is laid out as shown on <a href="#figure-box-mfrac"></a>.
              The fraction bar must only be painted if the
              <a data-cite="CSS2#visibility"><code>visibility</code></a> of
              the <code>&lt;mfrac&gt;</code> element is <code>visible</code>.
              In that case, the fraction bar must be painted with the
              <a data-cite="CSS-COLOR-3#foreground"><code>color</code></a>
              of the <code>&lt;mfrac&gt;</code> element.
            </p>
            <figure id="figure-box-mfrac">
              <img src="figures/mfracbox.svg"/>
              <figcaption>Box model for the <code>&lt;mfrac&gt;</code> element</figcaption>
            </figure>
            <p>The min-content (respectively max-content) inline size
              of content is the maximum between the min-content
              (respectively max-content) inline size of the numerator's
              margin box and the min-content
              (respectively max-content) of the denominator's
              margin box.
            </p>
            <p>
              If there is an <a>inline stretch size constraint</a>
              or a <a>block stretch size constraint</a> then
              the numerator is also laid out with the same stretch size
              constraint
              otherwise it is laid out without any stretch
              size constraint. The denominator is always laid out without
              any stretch size constraint.
            </p>
            <p>
              The inline size of the content
              is the maximum between the inline size of the
              numerator's margin box and the inline size of the
              denominator's margin box.
            </p>
            <p><code>NumeratorShift</code> is the maximum between:</p>
            <ul>
              <li>
                <a>FractionNumeratorShiftUp</a> (respectively
                <a>FractionNumeratorDisplayStyleShiftUp</a>) if
                the <a>math-style</a> is <code>inline</code>
                (respectively <code>display</code>).
              </li>
              <li>
                The ink line-descent of the numerator's margin box +
                <a>FractionNumeratorGapMin</a>
                (respectively <a>FractionNumDisplayStyleGapMin</a>)
                if the <a>math-style</a> is <code>inline</code>
                (respectively <code>display</code>).
              </li>
            </ul>
            <p><code>DenominatorShift</code> is the maximum between:</p>
            <ul>
              <li>
                <a>FractionDenominatorShiftDown</a> (respectively
                <a>FractionDenominatorDisplayStyleShiftDown</a>) if
                the <a>math-style</a> is <code>inline</code>
                (respectively <code>display</code>).
              </li>
              <li>
                The ink line-ascent of the denominator's margin box +
                <a>FractionDenominatorGapMin</a>
                (respectively <a>FractionDenomDisplayStyleGapMin</a>)
                if the <a>math-style</a> is <code>inline</code>
                (respectively <code>display</code>).
              </li>
            </ul>
            <p>
              The (ink) line-ascent of the content is the maximum between:
            </p>
            <ul>
              <li>
                <a>AxisHeight</a> +
                 <code>Numerator Shift</code> +
                 the (ink) line-ascent of the numerator's margin box.
              </li>
              <li>
                <a>AxisHeight</a> − <code>Denominator Shift</code>
                + the (ink) line-ascent of the denominator's margin box.
              </li>
              <li>
                <a>AxisHeight</a> plus half the line thickness.
              </li>
            </ul>
            <p>
              The (ink) line-descent of the content is the maximum between:
            </p>
            <ul>
              <li>
                −<a>AxisHeight</a> − <code>Numerator Shift</code>
                + the (ink) line-descent of the numerator's margin box.
              </li>
              <li>
                −<a>AxisHeight</a> + <code>Denominator Shift</code>
                + the (ink) line-descent of the denominator's margin box.
              </li>
              <li>
                −<a>AxisHeight</a> plus half the line thickness.
              </li>
              <li>0</li>
            </ul>
            <p>
              The inline offset of the numerator (respectively denominator)
              is the half the inline size of the content −
              half the inline size of
              the numerator's margin box
              (respectively denominator's margin box).
            </p>
            <p>
              The baseline of the numerator (respectively denominator)
              is shifted away from the baseline by a distance of
              <a>AxisHeight</a> + <code>NumeratorShift</code> (respectively
              − <a>AxisHeight</a> + <code>DenominatorShift</code> )
              towards the line-over (respectively line-under).
            </p>
            <p>
              The inline size of the fraction bar is the inline size of the
              content and its
              inline offset is 0.
              The center of the fraction bar is shifted away from the baseline
              by a distance of <a>AxisHeight</a> towards the line-over.
              Its block size is the line thickness.
            </p>
          </section>
          <section>
            <h5>Fraction with zero line thickness</h5>
            <p>
              If the actual line thickness is zero,
              the <code>&lt;mfrac&gt;</code> element is instead laid out as
              shown on <a href="#figure-box-mfrac-without-bar"></a>.
            </p>
            <figure id="figure-box-mfrac-without-bar">
              <img src="figures/mfracnobarbox.svg"/>
              <figcaption>Box model for the <code>&lt;mfrac&gt;</code> element without bar</figcaption>
            </figure>
            <p>
              The min-content inline size, max-content inline size
              and inline size of the content are calculated the same
              as in <a href="#fraction-with-nonzero-line-thickness"></a>.
            </p>
            <p>
              If there is an <a>inline stretch size constraint</a> or
              a <a>block stretch size constraint</a> then
              the numerator is also laid out with the same stretch size
              constraint
              and otherwise it is laid out without any stretch
              size constraint. The denominator is always laid out without
              any stretch size constraint.
            </p>
            <p>
              If the <a>math-style</a> is <code>inline</code> then
              <code>TopShift</code> and
              <code>BottomShift</code> are respectively
              set to <a>StackTopShiftUp</a> and <a>StackBottomShiftDown</a>.
              Otherwise <a>math-style</a> is <code>display</code>) and
              they are respectively set to <a>StackTopDisplayStyleShiftUp</a>
              and <a>StackBottomDisplayStyleShiftDown</a>).
            </p>
            <p>
              The <code>Gap</code> is defined to be
              (<code>BottomShift</code> −
              the ink line-descent of the denominator's margin box) +
              (<code>TopShift</code> −
              the ink line-descent of the numerator's margin box).
              If <a>math-style</a> is <code>inline</code>
              then <code>GapMin</code>
              is <a>StackGapMin</a>
              otherwise <a>math-style</a> is <code>display</code>
              and it is <a>StackDisplayStyleGapMin</a>.
              If <code>Gap</code> is not at least <code>GapMin</code> then
              <code>TopShift</code> and <code>BottomShift</code>
              are increased by
              half <code>GapMin</code> − <code>Gap</code>.
            </p>
            <p>
              The (ink) line-ascent of the content is the maximum between:
            </p>
            <ul>
              <li>
                <a>AxisHeight</a> +
                 <code>TopShift</code> +
                 the (ink) line-ascent of the numerator's margin box.
              </li>
              <li>
                <a>AxisHeight</a> − <code>BottomShift</code>
                + the (ink) line-ascent of the denominator's margin box.
              </li>
            </ul>
            <p>
              The (ink) line-descent of the content is the maximum between:
            </p>
            <ul>
              <li>
                −<a>AxisHeight</a> − <code>TopShift</code>
                + the (ink) line-descent of the numerator's margin box.
              </li>
              <li>
                −<a>AxisHeight</a> + <code>BottomShift</code>
                + the (ink) line-descent of the denominator's margin box.
              </li>
              <li>0</li>
            </ul>
            <p>
              The inline offsets of the numerator and denominator are
              calculated the same as in
              <a href="#fraction-with-nonzero-line-thickness"></a>.
            </p>
            <p>
              The baseline of the numerator (respectively denominator) is
              shifted away from the baseline by a distance of
              <a>AxisHeight</a> + <code>TopShift</code> (respectively −
              <a>AxisHeight</a> + <code>BottomShift</code>) towards the
              line-over (respectively line-under).
            </p>
          </section>
        </section>
        <section>
          <h4>Radicals <code>&lt;msqrt&gt;</code>, <code>&lt;mroot&gt;</code></h4>
          <div data-tests="presentation-markup/mrow/inferred-mrow-baseline.html,presentation-markup/mrow/inferred-mrow-stretchy.html,presentation-markup/direction/direction-overall.html,presentation-markup/radicals/root-parameters-1.html"></div>
          <p>
            The
            <dfn><code>&lt;msqrt&gt;</code></dfn>
            and
            <dfn><code>&lt;mroot&gt;</code></dfn>
            elements construct radicals. The <code>&lt;msqrt&gt;</code> element is
            used for square roots, while the <code>&lt;mroot&gt;</code> element is
            used to draw radicals with indices, e.g. a cube root.
          </p>
          <p>
          </p>
          <p>
            The <code>&lt;msqrt&gt;</code> and <code>&lt;mroot&gt;</code>
            elements accept the attributes described
            in <a href="#global-attributes"></a>.
          </p>
          <p>
            The <code>&lt;mroot&gt;</code> element sets
            increments scriptlevel by 2, and sets displaystyle to "false" in all
            but its first child.
            The <a href="#user-agent-stylesheet">user agent stylesheet</a>
            must contain the following rule in order to implement that behavior:
          </p>
          <pre class="css" data-include="user-agent-stylesheet/mroot.css"></pre>
          <div class="issue" data-number="15">Decide how to handle invalid
            mroot.</div>
          <p>
            If the <code>&lt;mroot&gt;</code> has less or more than two children,
            its layout algorithm
            is the same as the <a><code>&lt;mrow&gt;</code></a> element.
            Otherwise, the first child is called
            <em>base</em> and
            the second child is called
            <em>index</em>
            and its layout algorithm is explained below.
          </p>
          <p>
            The children of the <code>&lt;msqrt&gt;</code> element are laid out
            using the algorithm of the <a><code>&lt;mrow&gt;</code></a> element
            to produce a box that is also called the <em>base</em>.
            In particular, the
            <a>algorithm for stretching operators along the block axis</a> is used.
          </p>
          <section>
            <h5>Radical symbol</h5>
            <div data-tests="relations/css-styling/visibility-1.html,relations/css-styling/color-1.html"></div>
            <p>
              The radical symbol must only be painted if the
              <a data-cite="CSS2#visibility"><code>visibility</code></a> of
              the <code>&lt;msqrt&gt;</code> or <code>&lt;mroot&gt;</code>
              element is <code>visible</code>.
              In that case, the radical symbol must be painted with the
              <a data-cite="CSS-COLOR-3#foreground"><code>color</code></a>
              of that element.
            </p>
            <p>
              The <dfn>radical glyph</dfn> is the glyph obtained for the
              character U+221A SQUARE ROOT,
              applying the <code>rtlm</code> OpenType feature
              if the CSS property
              <a data-cite="CSS-WRITING-MODES-3#direction"><code>direction</code></a>
              is <code>rtl</code> [[OPEN-FONT-FORMAT]].
            </p>
            <p>
              The <dfn>radical gap</dfn> is given by
              <a>RadicalVerticalGap</a>
              if the <a>math-style</a> is <code>inline</code> and
              <a>RadicalDisplayStyleVerticalGap</a>
              if the <a>math-style</a> is <code>display</code>.
            </p>
            <p>
              The radical target size for the stretchy radical glyph is
              the sum of <a>RadicalRuleThickness</a>,
              <a>radical gap</a> and the ink height of the base.
            </p>
            <p>
              The <dfn>box metrics of the radical glyph</dfn> is the
              <a>box metrics of a stretchy glyph</a> stretched to
              <a>block dimension</a> the target size for the radical glyph.
            </p>
            <p>
              The <dfn>shaping of the surd</dfn>
              is performed by the algorithm to
              <a>shape a stretchy glyph</a> to <a>block dimension</a> the
              target size for the radical glyph.
            </p>
          </section>
          <section>
            <h5>Square root</h5>
            <p>
              The <code>&lt;msqrt&gt;</code> element is laid out as shown on
              <a href="#figure-box-msqrt"></a>.
            </p>
            <figure id="figure-box-msqrt">
              <img src="figures/msqrtbox.svg"/>
              <figcaption>Box model for the <code>&lt;msqrt&gt;</code> element</figcaption>
            </figure>
            <p>
              The min-content (respectively max-content) inline size of the
              content is
              the sum of the
              <a>preferred inline size of a glyph stretched along the
                block axis</a>
              for the <a>radical glyph</a>
              and of the min-content (respectively max-content) inline size
              of the base's margin box.
            </p>
            <p>
              The inline size of the content is the sum of the advance width
              of the <a>box metrics of the radical glyph</a> and
              of the inline size of the base's margin's box.
            </p>
            <p>
              The ink line-ascent of the content
              is the sum of <a>RadicalRuleThickness</a>,
              the <a>radical gap</a> and the ink line-ascent of the base's
              margin box.
              The line-ascent of the content is the maximum between:
            </p>
            <ul>
              <li>The line-ascent of the base's margin box.</li>
              <li>The sum of the ink line-ascent of the content
                and <a>RadicalExtraAscender</a></li>
            </ul>
            <p>
              The (ink) line-descent of the content is the maximum between:
            </p>
            <ul>
              <li>The (ink) line-descent of the base's margin box.</li>
              <li>The sum of the line-ascent and line-descent for the
                <a>box metrics of the radical glyph</a>, minus the ink
                line-ascent of the content.
              </li>
            </ul>
            <p>
              The inline size of the overbar is the inline size of the
              base's margin's box.
              The inline offsets of the base and overbar are also the same
              and equal to the width of the
              <a>box metrics of the radical glyph</a>.
            </p>
            <p>
              The baseline of the base is aligned with the baseline.
              The block size of the overbar is
              <a>RadicalRuleThickness</a>. It line-over edge is shifted away
              from the baseline by a distance towards the line-over
              equal to the ink line-ascent of the content.
            </p>
            <p>
              Finally, the <a>shaping of the surd</a> is performed:
            </p>
            <ul>
              <li>
                At inline offset 0.
              </li>
              <li>
                At block offset shifted away from the
                line-over edge of the overbar towards the line-under
                by a distance given by the ascent
                of the <a>box metrics of the radical glyph</a>.
              </li>
            </ul>
          </section>
          <section>
            <h5>Root with index</h5>
            <p>
              The <code>&lt;mroot&gt;</code> element is laid out as shown on
              <a href="#figure-box-mroot"></a>.
              The root index is first ignored and the base and
              radical glyph
              are laid out as
              shown on figure <a href="#figure-box-msqrt"></a>
              so that the content is represented by a box B.
            </p>
            <figure id="figure-box-mroot">
              <img src="figures/mrootbox.svg"/>
              <figcaption>Box model for the <code>&lt;mroot&gt;</code> element</figcaption>
            </figure>
            <div class="issue">Handle large negative RadicalKernAfterDegree?</div>
            <p>
              The min-content (respectively max-content) inline size of the
              content is the sum
              of <a>RadicalKernBeforeDegree</a>,
              the index min-content (respectively max-content) inline size
              of the index's margin box,
              <a>RadicalKernAfterDegree</a>
              and of the min-content (respectively max-content) of B.
            </p>
            <p>
              The inline size of the content is the sum of
              <a>RadicalKernBeforeDegree</a>,
              the inline size of the index's margin box,
              <a>RadicalKernAfterDegree</a>
              and of the inline size of B.
            </p>
            <p>
              The (ink) line-ascent of the content is the maximum between:
            </p>
            <ul>
              <li>−the ink line-descent of B +
                <a>RadicalDegreeBottomRaisePercent</a> ×
                the ink block size of B + the (ink) line-ascent of the
                index's margin box</li>
              <li>The (ink) line-ascent of B</li>
            </ul>
            <p>The (ink) line-descent of the content is the maximum between:</p>
            <ul>
              <li>the ink line-descent of B −
                <a>RadicalDegreeBottomRaisePercent</a> ×
                the ink block size of B + the (ink) line-ascent of the
                index's margin box</li>
              <li>The (ink) line-descent of B</li>
            </ul>
            <p>
              The inline offset of the index is
              <a>RadicalKernBeforeDegree</a>. The inline-offset of the
              base is the same + the
              inline size of the index's margin box.
            </p>
            <p>
              The baseline of B is aligned with the baseline.
              The baseline of the index is shifted away
              from the line-under edge by a distance of
              <a>RadicalDegreeBottomRaisePercent</a> ×
              the ink block size of B + the ink line-descent of the
              index's margin box.
            </p>
            <div class="note">
              In general, the kerning before the root index is positive while
              the kerning after it is negative, which means that the root
              element will have some inline-start space and that the root index
              will overlap the surd.
            </div>
          </section>
        </section>
        <section>
          <h4>Style Change <code>&lt;mstyle&gt;</code></h4>
          <div data-tests="presentation-markup/mrow/inferred-mrow-baseline.html,presentation-markup/mrow/inferred-mrow-stretchy.html,presentation-markup/direction/direction-overall.html"></div>
          <p>
            Historically, the
            <dfn><code>&lt;mstyle&gt;</code></dfn>
            element was introduced to make
            style changes that affect the rendering of its contents.
          </p>
          <p>
            The <code>&lt;mstyle&gt;</code> element accepts the attributes described in
            <a href="#global-attributes"></a>. Its layout algorithm is the
            same as the <a><code>&lt;mrow&gt;</code></a> element.
          </p>
          <div class="note">
            <code>&lt;mstyle&gt;</code> is implemented for compatibility with full MathML. Authors whose only target is MathML Core are encouraged to use CSS for styling.
          </div>
        </section>
        <section>
          <h4>Error Message <code>&lt;merror&gt;</code></h4>
          <div data-tests="presentation-markup/mrow/inferred-mrow-baseline.html,presentation-markup/mrow/inferred-mrow-stretchy.html"></div>
          <p>
            The
            <dfn><code>&lt;merror&gt;</code></dfn>
            element displays its contents as an
            ”error message”. The intent of this element is to provide a standard way
            for programs that generate MathML from other input to report syntax errors
            in their input.
          </p>
          <p>
            The <code>&lt;merror&gt;</code> element accepts the attributes described in
            <a href="#global-attributes"></a>. Its layout algorithm is the
            same as the <a><code>&lt;mrow&gt;</code></a> element.
            The <a href="#user-agent-stylesheet">user agent stylesheet</a>
            must contain the following rule in order to visually highlight the error
            message:
          </p>
          <pre class="css" data-include="user-agent-stylesheet/merror.css"></pre>
        </section>
        <section>
          <h4>Adjust Space Around Content <code>&lt;mpadded&gt;</code></h4>
          <div data-tests="presentation-markup/mrow/inferred-mrow-baseline.html,presentation-markup/mrow/inferred-mrow-stretchy.html"></div>
          <p>
            The
            <dfn><code>&lt;mpadded&gt;</code></dfn>
            element renders the same as its child content, but with the
            size of the child’s bounding box and the relative positioning point of its
            content modified according to <code>&lt;mpadded&gt;</code>’s attributes.
          </p>
          <p>
            The <code>&lt;mpadded&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a> as well as the following
            attributes:
          </p>
          <ul>
            <li><a class="internalDFN" data-link-type="dfn" href="#attribute-mpadded-width"><code>width</code></a></li>
            <li><a class="internalDFN" data-link-type="dfn" href="#attribute-mpadded-height"><code>height</code></a></li>
            <li><a class="internalDFN" data-link-type="dfn" href="#attribute-mpadded-depth"><code>depth</code></a></li>
            <li><a class="internalDFN" data-link-type="dfn" href="#attribute-mpadded-lspace"><code>lspace</code></a></li>
            <li><a class="internalDFN" data-link-type="dfn" href="#attribute-mpadded-voffset"><code>voffset</code></a></li>
          </ul>
          <p>
            The
            <dfn id="attribute-mpadded-width"><code>mpadded@width</code></dfn> and
            <dfn id="attribute-mpadded-lspace"><code>mpadded@lspace</code></dfn> attributes, if present, must match the syntax
            <code>( "+" | "-" )? (<a><code>unsigned-length-percentage</code></a> | (<a><code>unsigned-number</code></a> "%"? "width"))</code>.
          </p>
          <p>
            The
            <dfn id="attribute-mpadded-height"><code>mpadded@height</code></dfn>,
            <dfn id="attribute-mpadded-depth"><code>mpadded@depth</code></dfn> and
            <dfn id="attribute-mpadded-voffset"><code>mpadded@voffset</code></dfn>
            attributes, if present, must match the syntax
            <code>( "+" | "-" )? (<a><code>unsigned-length-percentage</code></a> | (<a><code>unsigned-number</code></a> "%"? ("height" | "depth"))</code>.
          </p>
          <section>
            <h5>Inner box and requested parameters</h5>
            <p>
              Children of the <code>&lt;mpadded&gt;</code> element are laid out
              using the algorithm of the <a><code>&lt;mrow&gt;</code></a> element
              to produce the
              <em>mpadded inner box</em> for the content with parameters called
              inner inline size, inner line-ascent and inner line-descent.
              The requested <code>&lt;mpadded&gt;</code>
              parameters are determined as follows:
            </p>
            <ul>
              <li>If the <code>width</code> (respectively <code>height</code>,
                <code>depth</code>, <code>lspace</code>, <code>voffset</code>)
                attributes are absent or invalid the requested width
                (respectively height, depth, lspace, voffset)
                is the inner inline size
                (respectively inner line-ascent, inner line-descent,
                <code>0</code>,
                <code>0</code>).
              </li>
              <li>If the <code>width</code> (respectively <code>height</code>,
                <code>depth</code>, <code>lspace</code>, <code>voffset</code>)
                attribute is an
                <a><code>unsigned-length-percentage</code></a>
                then the requested width
                (respectively height, depth, lspace, voffset)
                is the resolved value
                with percentage interpreted relative to
                the inner inline size (respectively
                inner line-ascent, inner line-descent, <code>0</code>,
                <code>0</code>).
              </li>
              <li>If the <code>width</code> (respectively <code>lspace</code>) attribute
                matches <code>"<a><code>unsigned-number</code></a>width"</code>
                then the requested width (respectively lspace) is the number multipled by
                the inner inline size. If instead it matches
                <code>"<a><code>unsigned-number</code></a>%width"</code>
                then it is the same value but divided by 100.
              </li>
              <li>If the <code>height</code> (respectively <code>depth</code>,
                <code>voffset</code>) attribute
                matches <code>"<a><code>unsigned-number</code></a>height"</code>
                then the requested height (respectively depth, voffset) is the number
                multipled by the inner line-ascent. If instead it matches
                <code>"<a><code>unsigned-number</code></a>%heigth"</code>
                then it is the same value but divided by 100.
              </li>
              <li>If the <code>height</code> (respectively <code>depth</code>,
                <code>voffset</code>) attribute
                matches <code>"<a><code>unsigned-number</code></a>depth"</code>
                then the requested height (respectively depth, voffset) is the number
                multipled by the inner line-descent. If instead it matches
                <code>"<a><code>unsigned-number</code></a>%depth"</code>
                then it is the same value but divided by 100.
              </li>
              <li>If the <code>width</code> (respectively <code>height</code>,
                <code>depth</code>, <code>lspace</code>, <code>voffset</code>)
                starts with a U+002B PLUS SIGN or U+002D HYPHEN-MINUS character,
                then choose ε = ±1 to match the sign of that character
                and let V be the requested width
                (respectively height, depth, lspace, voffset)
                obtained for the same attribute value with that character removed.
                Then the requested width (respectively height, depth, lspace, voffset)
                is the inner inline size (respectively inner line-ascent,
                inner line-descent, <code>0</code>,
                <code>0</code>) + εV.
              </li>
            </ul>
            <div class="issue" data-number="40">Allow negative width, lspace to
              produce negative spacing?</div>
            <p>
              If one of the requested width, depth, height or lspace values calculated
              above is negative then it is treated as <code>0</code>.
            </p>
          </section>
          <section>
            <h5>Layout of <code>&lt;mpadded&gt;</code></h5>
            <p>
              The <code>&lt;mpadded&gt;</code> element is laid out as shown on
              <a href="#figure-box-mpadded"></a>.
            </p>
            <figure id="figure-box-mpadded">
              <img src="figures/mpaddedbox.svg"/>
              <figcaption>Box model for the <code>&lt;mpadded&gt;</code> element</figcaption>
            </figure>
            <p>
              The min-content (respectively max-content) inline size
              of the content
              is the requested width calculated in
              <a href="#inner-box-and-requested-parameters"></a>
              but using the min-content (respectively max-content)
              inline size of the
              mpadded inner box instead of the "inner inline size".
            </p>
            <div class="note">
              The calculatation of min-content and max-content inline sizes
              are well-defined because the requested width
              does not depend on any block metric.
            </div>
            <p>
              The children are laid out using the
              <a>algorithm for stretching operators along the block axis</a>.
            </p>
            <p>
              The (ink) line-ascent of the content is the requested height.
              The (ink) line-descent of the content is the requested depth.
            </p>
            <p>
              The mpadded inner box is placed so that its baseline is
              shifted away from the baseline by the requested voffset
              towards the line-over.
            </p>
          </section>
        </section>
        <section>
          <h4>Making Sub-Expressions Invisible <code>&lt;mphantom&gt;</code></h4>
          <div data-tests="presentation-markup/mrow/inferred-mrow-baseline.html,presentation-markup/mrow/inferred-mrow-stretchy.html"></div>
          <p>
            Historically, the
            <dfn><code>&lt;mphantom&gt;</code></dfn>
            element was introduced to render
            its content invisibly, but with the same size and other dimensions,
            including baseline position, that its contents would have if they were
            rendered normally.
          </p>
          <p>
            The <code>&lt;mphantom&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a>. Its layout algorithm is
            the same as the <a><code>&lt;mrow&gt;</code></a> element.
            The <a href="#user-agent-stylesheet">user agent stylesheet</a>
            must contain the following rule in order to hide the content:
          </p>
          <pre class="css" data-include="user-agent-stylesheet/mphantom.css"></pre>
          <div class="note">
            <code>&lt;mphantom&gt;</code> is implemented for compatibility with full MathML. Authors whose only target is MathML Core are encouraged to use CSS for styling.
          </div>
        </section>
        <section>
          <h4>Enclose Expression Inside Notation <code>&lt;menclose&gt;</code></h4>
          <div data-tests="relations/css-styling/visibility-1.html,relations/css-styling/color-1.html,presentation-markup/mrow/inferred-mrow-baseline.html,presentation-markup/mrow/inferred-mrow-stretchy.html"></div>
          <div class="issue" data-number="105">Can this element be simplified?</div>
          <p>
            The
            <dfn><code>&lt;menclose&gt;</code></dfn>
            element renders its content inside the enclosing notation.
            It accepts the attributes described in
            <a href="#global-attributes"></a> as well as the
            following attribute:
          </p>
          <ul>
            <li><a>notation</a></li>
          </ul>
          <p>
            The
            <dfn><code>notation</code></dfn>
            attribute, if present, must have a value that is an
            <a data-cite="HTML#unordered-set-of-unique-space-separated-tokens">unordered set
              of unique space-separated tokens</a> that are ASCII case-insensitive. The
            allowed values are
            <code>left</code>,
            <code>right</code>,
            <code>top</code>,
            <code>bottom</code>,
            <code>box</code>,
            <code>roundedbox</code>,
            <code>actuarial</code>,
            <code>madruwb</code>,
            <code>horizontalstrike</code>,
            <code>verticalstrike</code>
            <code>updiagonalstrike</code>,
            <code>downdiagonalstrike</code>,
            <code>longdiv</code>,
            <code>circle</code>.
          </p>
          <p>
            The notations must only be painted if the
            <a data-cite="CSS2#visibility"><code>visibility</code></a> of
            the <code>&lt;menclose&gt;</code> element is <code>visible</code>.
            In that case, the notations must be painted with the
            <a data-cite="CSS-COLOR-3#foreground"><code>color</code></a>
            of the <code>&lt;menclose&gt;</code> element.
          </p>
          <p>
            Children of the <code>&lt;menclose&gt;</code> element are laid out
            using the algorithm of the <a><code>&lt;mrow&gt;</code></a> element
            to produce a box B corresponding to the content.
            In particular, they use the
            <a>algorithm for stretching operators along the block axis</a>.
            ξ<sub>8</sub> is used below to denote the
            default rule thickness and is set to <a>OverbarRuleThickness</a>.
          </p>
          <div class="note">
            ξ<sub>8</sub> is the notation used in [[?TEXBOOK]] for the
            default rule thickness.
          </div>
          <section>
            <h5>Multiple notations</h5>
            <p>
              If the <code>notation</code> attribute contains the
              <code>box</code> value,
              then it is treated as it was replaced with the set of values
              <code>left right top bottom</code>, removing duplicates values
              with the other of the notations, if any.
              Similarly, <code>actuarial</code> and
              <code>madruwb</code> notations are respectively treated as
              equivalent to <code>right top</code> and
              and <code>right bottom</code>.
            </p>
            <div class="issue" data-number="113">Specify in which order the notations are painted?</div>
            <p>
              The layout of other individual notation is explained in the
              following sections. In general when the <code>notation</code>
              attribute contains multiple
              values, each algorithm is applied individually to obtain
              boxes B<sub>1</sub>, B<sub>2</sub>, ... B<sub>n</sub>
              corresponding to their content. The layout
              of the <code>&lt;menclose&gt;</code> element is then performed
              as follows:
            </p>
            <ul>
              <li>
                For each layout B<sub>i</sub>, s<sub>left,i</sub> is the
                line-left offset of
                the B and s<sub>right,i</sub> is
                (inline size of B<sub>i</sub> − line-right offset of B).
                s<sub>left</sub> (respectively s<sub>right</sub>) is the maximum
                of the s<sub>left,i</sub> over
                (respectively s<sub>left,i</sub>) over all the i. Then
                the inline size is s<sub>left</sub> +
                the inline size of B + s<sub>right</sub>.
              </li>
              <li>
                Actually for each layout B<sub>i</sub>, the values
                s<sub>left,i</sub> and
                s<sub>right,i</sub> generally only depends on the inline size
                of B and parameter ξ<sub>8</sub> so it is possible to
                perform the same calculation replacing "inline size of B"
                with "content-min inline size of B" or
                "content-max inline size of B". The only exception is for
                the <code>longdiv</code> notation: In that case,
                s<sub>left,i</sub> is replaced with the
                <a>preferred inline size of a glyph stretched along the block axis</a>
                for U+0029 RIGHT PARENTHESIS.
                Again, it is possible to take the maximum values to calculate
                the min-content and max-content inline sizes of the content.
              </li>
              <li>
                The (ink) line-ascent of the content
                is the maximum of all the (ink)
                line-ascent of the B<sub>i</sub>.
                The (ink) line-descent of the content
                is the maximum of all the (ink)
                line-descent of the B<sub>i</sub>.
              </li>
              <li>
                Finally each box at line-left and line-over offsets
                x, y in the layout of B<sub>i</sub> is moved to
                line-left and line-over offsets
                offsets x + s<sub>left</sub> − s<sub>left,i</sub>
                and y + line-ascent of the content −
                the line-ascent of B<sub>i</sub>.
              </li>
            </ul>
            <div class="note">
              The above description explains how to take the union of all
              the notations. In the layout of B<sub>i</sub>,
              B is placed at line-left position s<sub>left,i</sub> and
              its baseline is at line-over position the line-ascent of
              B<sub>i</sub>. So the final shifts are compatible for
              the box B: It will be at line-left position s<sub>left</sub> and
              its baseline aligned with the baseline.
            </div>
          </section>
          <section>
            <h5>Border-like notations</h5>
            <ul>
              <li>
                <p>For the <code>left</code> notation, a bar is drawn
                  on the line-left side along the <a>block axis</a>
                  as shown on <a href="#figure-box-menclose-left"></a>.
                </p>
                <figure id="figure-box-menclose-left">
                  <img src="figures/leftbox.svg"/>
                  <figcaption>Box model for the <code>left</code>
                    notation of the <code>&lt;menclose&gt;</code> element</figcaption>
                </figure>
                <p>
                  The min-content (respectively max-content) inline size
                  of the content is
                  the min-content (respectively max-content) inline size
                  of B + 5ξ<sub>8</sub>.
                </p>
                <p>
                  The inline size is the inline size of B +
                  5ξ<sub>8</sub>, the ink line-ascent of the content
                  is the one of B +
                  <a>OverbarVerticalGap</a> + <a>OverbarRuleThickness</a>
                  and the ink line-descent of the content is the one of B +
                  <a>UnderbarVerticalGap</a> + <a>UnderbarRuleThickness</a>.
                  The line-ascent (respectively line-descent) of the content
                  is the maximum
                  of between the ink line-ascent (respectively ink line-descent)
                  of the content
                  and the line-ascent (respectively line-descent) of B.
                </p>
                <p>
                  B is placed so that its baseline matches the baseline and
                  its line-left offset is 5ξ<sub>8</sub>.
                  The inline size of the bar is ξ<sub>8</sub>,
                  its block size is the block size of the content,
                  its line-left offset
                  is ξ<sub>8</sub> and its line-over offset is 0.
                </p>
              </li>
              <li>
                <p>
                  The <code>right</code> notation is handled the same as the
                  <code>left</code> notation,
                  but with the bar placed on the line-right side. The block
                  metrics, min-content inline size, max-content inline size
                  and inline size of the content are the same.
                </p>
                <p>
                  The inline size of the bar is ξ<sub>8</sub>,
                  its line-left offset is the inline size −
                  2ξ<sub>8</sub> and the line-left offset of B is 0.
                </p>
              </li>
              <li>
                <p>For the <code>top</code> notation, a bar is drawn
                  on the line-over side along the <a>inline axis</a>
                  as shown on <a href="#figure-box-menclose-top"></a>.
                </p>
                <p>
                  <figure id="figure-box-menclose-top">
                    <img src="figures/topbox.svg"/>
                    <figcaption>Box model for the <code>top</code>
                      notation of the <code>&lt;menclose&gt;</code> element</figcaption>
                  </figure>
                <p>
                  The min-content (respectively max-content) inline size
                  of the content is
                  the min-content (respectively max-content) inline size
                  of B + 8ξ<sub>8</sub>.
                </p>
                <p>
                  The inline size of the content is the inline size of B +
                  8ξ<sub>8</sub>, the ink line-ascent of the content
                  is the one of B +
                  <a>OverbarVerticalGap</a> +  <a>OverbarRuleThickness</a>.
                  The inline line-ascent of the content
                  is the maximum between the line-ascent
                  of B and the ink line-ascent of the content +
                  <a>OverbarExtraAscender</a>.
                  The (ink) line-descent of the content
                  is the (ink) line-descent of B.
                </p>
                <p>
                  B is placed so that its baseline matches the baseline and
                  its line-left offset is 4ξ<sub>8</sub>.
                  The inline size of the bar is the inline size of the content,
                  its block size is <a>OverbarRuleThickness</a>,
                  its line-left offset
                  is 0 and its line-over offset is the ascent −
                  the ink line-ascent of B − <a>OverbarVerticalGap</a> −
                  <a>OverbarRuleThickness</a>.
                </p>
              </li>
              <li>
                <p>
                  The <code>bottom</code> notation is drawn the same as the
                  <code>top</code> notation,
                  but with the bar placed on the line-under side of B and using
                  parameters
                  <a>UnderbarRuleThickness</a>,
                  <a>UnderbarVerticalGap</a>
                  and <a>UnderbarExtraDescender</a>.
                  The inline metrics are the same.
                </p>
                <p>
                  The ink line-descent of the content is the one of B +
                  <a>UnderbarVerticalGap</a> +  <a>UnderbarRuleThickness</a>.
                  The inline line-descent of the content
                  is the maximum between the line-descent
                  of B and the ink line-descent of the content +
                  <a>UnderbarExtraDescender</a>.
                  The (ink) line-ascent of the content
                  is the (ink) line-ascent of B.
                </p>
                <p>
                  B is placed so that its baseline matches the baseline.
                  The block size of the bar is <a>UnderbarRuleThickness</a>
                  and its line-over offset is the line-ascent of the content +
                  the ink line-descent of B + <a>UnderbarVerticalGap</a>.
                </p>
              </li>
            </ul>
          </section>
          <section>
            <h5>Strike notations</h5>
            <ul>
              <li>
                <p>
                  For the <code>horizontalstrike</code> notation,
                  the metrics are the same as B.
                  A bar of inline size the inline size of the content and
                  of block size ξ<sub>8</sub> is drawn
                  at line-over position minus half ξ<sub>8</sub>.
                  See <a href="#figure-box-horizontal-strike"></a>.
                </p>
                <figure id="figure-box-horizontal-strike">
                  <img src="figures/horizstrikebox.svg"/>
                  <figcaption>Box model for the <code>horizontalstrike</code>
                    notation of the <code>&lt;menclose&gt;</code> element</figcaption>
                </figure>
              </li>
              <li>
                <p>
                  For the <code>verticalstrike</code> notation,
                  the metrics are the same as B.
                  A bar of inline size ξ<sub>8</sub> and
                  of block size the block size of the content is drawn
                  at line-left position
                  half the inline size of the content minus half ξ<sub>8</sub>.
                </p>
              </li>
              <li>
                <p>
                  For the <code>updiagonalstrike</code> notation,
                  a bar is drawn
                  going from the line-left line-under corner to the
                  line-right line-over corner as shown on
                  <a href="#figure-box-menclose-up-diagonal-strike"></a>.
                </p>
                <p>
                  The min-content inline size,
                  max-content inline size and inline size
                  of the content are the one of B + ξ<sub>8</sub>.
                </p>
                <p>
                  The ink line-ascent and line-ascent of the content are the
                  line-ascent of B + half
                  ξ<sub>8</sub>.
                  The ink line-descent and line-descent of the content
                  are the line-descent of
                  B + half
                  ξ<sub>8</sub>.
                </p>
                <p>
                  B is placed so that its baseline is the baseline and
                  its line-left offset is half ξ<sub>8</sub>.
                </p>
                <p>
                  Using terminology from [[SVG]],
                  the bar is drawn with a line
                  of thickness ξ<sub>8</sub> going from the
                  line-under line-left corner of B
                  to the line-over line-right corner of B with
                  <code>stroke-linecap</code> set to <code>butt</code>.
                </p>
                <figure id="figure-box-menclose-up-diagonal-strike">
                  <img src="figures/updiagstrikebox.svg"/>
                  <figcaption>Box model for the <code>updiagonalstrike</code>
                    notation of the <code>&lt;menclose&gt;</code> element</figcaption>
                </figure>
              </li>
              <li>
                <p>
                  For the <code>downdiagonalstrike</code> notation,
                  a bar is drawn
                  going from the line-left line-over corner to the
                  line-right line-under corner. The metrics are the same as
                  for the <code>updiagonalstrike</code> notation.
                </p>
              </li>
            </ul>
          </section>
          <section>
            <h5>Enclosing notations</h5>
            <ul>
              <li>
                <p>
                  The <code>roundedbox</code> notation is drawn as
                  shown on <a href="#figure-box-menclose-roundedbox"></a>.
                </p>
                <figure id="figure-box-menclose-roundedbox">
                  <img src="figures/roundedbox.svg"/>
                  <figcaption>Box model for the <code>roundedbox</code>
                    notation of the <code>&lt;menclose&gt;</code> element</figcaption>
                </figure>
                <p>
                  The min-content inline size,
                  max-content inline size and inline size
                  of the content are the
                  ones of B plus 10ξ<sub>8</sub>.
                </p>
                <p>
                  The ink line-ascent (respectively line-descent)
                  of the content is the ink
                  line-ascent (respectively line-descent) of B + 4ξ<sub>8</sub>.
                  The line-ascent (respectively line-descent) of the content is
                  the maximum between the line-ascent (respectively
                  line-descent) of B
                  and the ink line-ascent (respectively line-descent)
                  of the content plus ξ<sub>8</sub>.
                </p>
                <p>
                  B is placed so that its baseline is the baseline and
                  its line-left offset is 5ξ<sub>8</sub>.
                  If B' is the ink box B expanded on each side by
                  ½7ξ<sub>8</sub> then using terminology from [[SVG]],
                  a rounded rectangle is drawn on B'
                  with parameters <code>rx</code>, <code>ry</code> and
                  <code>stroke-width</code> set to 3ξ<sub>8</sub>.
                </p>
              </li>
              <li>
                <p>
                  The <code>longdiv</code> notation is drawn similarly to the
                  <code>&lt;msqrt&gt;</code> element
                  (<a href="#figure-box-msqrt"></a>)
                  except that the CSS
                  <a data-cite="CSS-WRITING-MODES-3#direction"><code>direction</code></a>
                  is ignored and U+221A SQUARE ROOT is replaced with
                  U+0029 RIGHT PARENTHESIS. The rule thickness is ξ<sub>8</sub>,
                  the gap between content and overbar is 3ξ<sub>8</sub> and the
                  extra ascender is ξ<sub>8</sub>.
                </p>
              </li>
              <li>
                <p>
                  The <code>circle</code> notation is drawn as shown
                  on <a href="#figure-box-menclose-circle"></a>.
                  Given the ink box of width w and height h, an ellipse is drawn using
                  the axes of symmetry of this ink box, the radii
                  w x ½√2, h x ½√2 and thickness ξ<sub>8</sub>.
                  Space of ξ<sub>8</sub> is added each side of the ellipse's ink
                  box.
                </p>
                <p>
                  The min-content inline size, max-content inline size
                  and inline size of the content are the ones of B times √2 plus
                  3ξ<sub>8</sub>.
                </p>
                <p>
                  The ink line-ascent (respectively line-descent) of the content
                  is the ink
                  line-ascent (respectively line-descent) of B times
                  √2 plus ½ξ<sub>8</sub>. The line-ascent
                  (respectively line-descent) of the content
                  is the maximum between the
                  line-ascent (respectively line-descent) of B and the
                  ink line-ascent (respectively line-descent) of the content
                  plus ξ<sub>8</sub>.
                </p>
                <p>
                  Finally, B is placed so that its baseline is aligned with
                  the baseline and its line-left offset is
                  ½(√2 − 1) times the inline size of B plus 3ξ<sub>8</sub>/2.
                </p>
                <figure id="figure-box-menclose-circle">
                  <img src="figures/circlebox.svg"/>
                  <figcaption>Box model for the <code>circle</code>
                    notation of the <code>&lt;menclose&gt;</code> element</figcaption>
                </figure>
              </li>
            </ul>
          </section>
        </section>
      </section>
      <section>
        <h3>Script and Limit Schemata</h3>
        <p>
          The elements described in this section position one or more scripts
          around a base. Attaching various kinds of scripts and embellishments
          to symbols is a very common notational device in mathematics. For
          purely visual layout, a single general-purpose element could suffice
          for positioning scripts and embellishments in any of the traditional
          script locations around a given base. However, in order to capture
          the abstract structure of common notation better, MathML provides
          several more specialized scripting elements.
        </p>
        <p>
          In addition to sub/superscript elements, MathML has overscript and
          underscript elements that place scripts above and below the base.
          These elements can be used to place limits on large operators, or fo
          placing accents and lines above or below the base.
        </p>
        <section>
          <h4>Cramped Elements</h4>
          <p>
            A <a>MathML Core element</a> is <dfn>cramped</dfn> if it satisfies
            one of the following condition:
          </p>
          <ol>
            <li>Its parent is <a>cramped</a>.</li>
            <li>Its parent is a <a><code>&lt;msqrt&gt;</code></a> or
              <a><code>&lt;mroot&gt;</code></a> element.
            </li>
            <li>It is the denominator of a <a><code>&lt;mfrac&gt;</code></a>
              element.</li>
            <li>
              It is the subscript of a
              <a><code>&lt;msub&gt;</code></a> or
              <a><code>&lt;msubsup&gt;</code></a> element.
            </li>
            <li>
              It is the underscript of a
              <a><code>&lt;munder&gt;</code></a> or
              <a><code>&lt;munderover&gt;</code></a> element.
            </li>
            <li>It is the overscript of the
              <code>&lt;mover&gt;</code> and <code>&lt;munderover&gt;</code>
              elements and
              is an <a>embellished operator</a> with
              the <a><code>accent</code></a> property.
            </li>
          </ol>
        </section>
        <section>
          <h4>Subscripts and Superscripts <code>&lt;msub&gt;</code>,
            <code>&lt;msup&gt;</code>, <code>&lt;msubsup&gt;</code></h4>
          <div data-tests="presentation-markup/scripts/subsup-2.html,presentation-markup/scripts/subsup-5.html,presentation-markup/scripts/subsup-1.html,presentation-markup/scripts/subsup-parameters-2.html,presentation-markup/scripts/subsup-parameters-1.html,presentation-markup/scripts/subsup-3.html,presentation-markup/scripts/subsup-4.html"></div>
          <p>
            The <dfn><code>&lt;msub&gt;</code></dfn>,
            <dfn><code>&lt;msup&gt;</code></dfn> and
            <dfn><code>&lt;msubsup&gt;</code></dfn> elements are used to attach
            subscript and superscript to a MathML expression.
            They accept the attributes described in
            <a href="#global-attributes"></a>.
          </p>
          <section>
            <h5>Children of <code>&lt;msub&gt;</code>,
            <code>&lt;msup&gt;</code>, <code>&lt;msubsup&gt;</code></h5>
            <div class="issue" data-number="15">Decide how to handle invalid
              markup.</div>
            <p>
              If the <code>&lt;msub&gt;</code> element
              has less or more than two children, its layout algorithm
              is the same as the <a><code>&lt;mrow&gt;</code></a> element.
              Otherwise, the first child is called the
              <em>base</em>, the second child is called the
              <em>subscript</em> and the layout algorithm is explained
              in <a href="#base-with-subscript"></a>.
            </p>
            <p>
              If the <code>&lt;msub&gt;</code> element
              has less or more than two children, its layout algorithm
              is the same as the <a><code>&lt;mrow&gt;</code></a> element.
              Otherwise, the first child is called the
              <em>base</em>, the second child is called the
              <em>superscript</em> and the layout algorithm is explained
              in <a href="#base-with-superscript"></a>.
            </p>
            <p>
              If the <code>&lt;msubsup&gt;</code> element
              has less or more than three children, its layout algorithm
              is the same as the <a><code>&lt;mrow&gt;</code></a> element.
              Otherwise, the first child is called the
              <em>base</em>, the second child is called the <em>subscript</em>,
              its third child is called
              the <em>superscript</em> and the layout algorithm is explained
              in <a href="#base-with-subscript-and-superscript"></a>.
            </p>
          </section>
          <section>
            <h5>Base with subscript</h5>
            <p>
              The <code>&lt;msub&gt;</code> element is laid out as shown on
              <a href="#figure-box-msub"></a>.
              <code>LargeOpItalicCorrection</code>
              is the <a>italic correction</a> of the base
              if it is an <a>embellished operator</a> with
              the <a><code>largeop</code></a> property and 0 otherwise.
            </p>
            <figure id="figure-box-msub">
              <img src="figures/msubbox.svg"/>
              <figcaption>Box model for the <code>&lt;msub&gt;</code> element</figcaption>
            </figure>
            <p>
              The content-min (respectively content-max) inline size
              of the content is the content-min (respectively max-content)
              inline size of the base's margin box −
              <code>LargeOpItalicCorrection</code> +
              the content-min (respectively max-content) inline size of
              the subscript's margin box + <a>SpaceAfterScript</a>.
            </p>
            <p>
              If there is an
              <a>inline stretch size constraint</a>
              or a <a>block stretch size constraint</a>
              then the base is also laid out with the same stretch size
              contraint and otherwise it is laid out without any stretch
              size constraint. The scripts are always laid out without
              any stretch size constraint.
            </p>
            <p>
              The inline size of the content
              is the inline size of the base's margin box −
              <code>LargeOpItalicCorrection</code> +
              the inline size of
              the subscript's margin box + <a>SpaceAfterScript</a>.
            </p>
            <p>
              <code>SubShift</code> is the maximum between:
            </p>
            <ul>
              <li><a>SubscriptShiftDown</a></li>
              <li><a>SubscriptTopMax</a> + the ink line-ascent of the
                subscript's margin box</li>
              <li><a>SubscriptBaselineDropMin</a> + the ink line-descent of the
                base's margin box</li>
            </ul>
            <p>
              The (ink) line-ascent of the content is the maximum between:
            </p>
            <ul>
              <li>The (ink) line-ascent of the base's margin box.</li>
              <li>The (ink) line-ascent of the subcript's margin box −
                <code>SubShift</code>.</li>
            </ul>
            <p>
              The (ink) line-descent of the content is the maximum between:
            </p>
            <ul>
              <li>The (ink) line-descent of the base's margin box.</li>
              <li>The (ink) line-descent of the subcript's margin box +
                <code>SubShift</code>.</li>
            </ul>
            <p>
              The inline offset of the base is 0 and the inline offset of the
              subscript is the inline size of the base's margin box −
              <code>LargeOpItalicCorrection</code>.
            </p>
            <p>
              The base is placed so that its baseline
              matches the baseline. The subscript is placed so that its baseline
              is shifted away from the baseline by <code>SubShift</code>
              towards the line-under.
            </p>
          </section>
          <section>
            <h5>Base with superscript</h5>
            <p>
              The <code>&lt;msup&gt;</code> element is laid out as shown on
              <a href="#figure-box-msup"></a>.
              <code>ItalicCorrection</code>
              is the <a>italic correction</a> of the base
              if it is not an <a>embellished operator</a> with
              the <a><code>largeop</code></a> property and 0 otherwise.
            </p>
            <figure id="figure-box-msup">
              <img src="figures/msupbox.svg"/>
              <figcaption>Box model for the <code>&lt;msup&gt;</code> element</figcaption>
            </figure>
            <p>
              The content-min (respectively content-max) inline size
              of the content
              is the content-min (respectively max-content)
              inline size of the base's margin box +
              <code>ItalicCorrection</code> +
              the content-min (respectively max-content) inline size of
              the superscript's margin box + <a>SpaceAfterScript</a>.
            </p>
            <p>
              If there is an
              <a>inline stretch size constraint</a>
              or a <a>block stretch size constraint</a>
              then the base is also laid out with the same stretch size
              contraint and otherwise it is laid out without any stretch
              size constraint. The scripts are always laid out without
              any stretch size constraint.
            </p>
            <p>
              The inline size of the content
              is inline size of the base's margin box +
              <code>ItalicCorrection</code> +
              the inline size of
              the superscript's margin box + <a>SpaceAfterScript</a>.
            </p>
            <p>
              <code>SuperShift</code> is the maximum between:
            </p>
            <ul>
              <li>The value <a>SuperscriptShiftUpCramped</a> if the
                <code>&lt;msup&gt;</code> element is
                <a>cramped</a> or
                the value <a>SuperscriptShiftUp</a> otherwise.</li>
              <li>
                <a>SuperscriptBottomMin</a> + the ink line-descent of the
                superscript's margin box</li>
              <li>The ink line-ascent of the base's margin box
                − <a>SuperscriptBaselineDropMax</a></li>
            </ul>
            <p>
              The (ink) line-ascent of the content is the maximum between:
            </p>
            <ul>
              <li>The (ink) line-ascent of the base's margin box.</li>
              <li>The (ink) line-ascent of the supercript's margin box +
                <code>SuperShift</code>.</li>
            </ul>
            <p>
              The (ink) line-descent of the content is the maximum between:
            </p>
            <ul>
              <li>The (ink) line-descent of the base's margin box.</li>
              <li>The (ink) line-descent of the supercript's margin box −
                <code>SuperShift</code>.</li>
            </ul>
            <p>
              The inline offset of the base is 0 and the inline offset of
              superscript is the inline size of the base's margin box +
              <code>ItalicCorrection</code>.
            </p>
            <p>
              The base is placed so that its baseline
              matches the baseline. The superscript is placed so that its
              baseline
              is shifted away from the baseline by <code>SuperShift</code>
              towards the line-over.
            </p>
          </section>
          <section>
            <h5>Base with subscript and superscript</h5>
            <p>
              The <code>&lt;msubsup&gt;</code> element is laid out as shown on
              <a href="#figure-box-msup"></a>.
              <code>LargeOpItalicCorrection</code> and <code>SubShift</code>
              are set as in <a href="#base-with-subscript"></a>.
              <code>ItalicCorrection</code> and <code>SuperShift</code>
              are set as in <a href="#base-with-superscript"></a>.
            </p>
            <figure id="figure-box-msubsup">
              <img src="figures/msubsupbox.svg"/>
              <figcaption>Box model for the <code>&lt;msubsup&gt;</code> element</figcaption>
            </figure>
            <p>
              The min-content inline size (respectively max-content inline size,
              inline size) of the content is the maximum between the of the
              inline sizes (respectively max-content inline size,
              inline sizes) of the content calculated in
              <a href="#base-with-subscript"></a> and
              <a href="#base-with-superscript"></a>.
            </p>
            <p>
              If there is an
              <a>inline stretch size constraint</a>
              or a <a>block stretch size constraint</a>
              then the base is also laid out with the same stretch size
              contraint and otherwise it is laid out without any stretch
              size constraint. The scripts are always laid out without
              any stretch size constraint.
            </p>
            <p>
              If there is an
              <a>inline stretch size constraint</a>
              or a <a>block stretch size constraint</a>
              then the base is also laid out with the same stretch size
              contraint and otherwise it is laid out without any stretch
              size constraint. The scripts are always laid out without
              any stretch size constraint.
            </p>
            <p>
              <code>SubSuperGap</code> is the gap between the two scripts
              along the <a>block axis</a> and is defined by
              (<code>SubShift</code> − the ink line-ascent of the subscript's
              margin box) +
              (<code>SuperShift</code> − the ink line-descent of the
              superscript's margin box).
              If <code>SubSuperGap</code> is not at least
              <a>SubSuperscriptGapMin</a> then the following steps are
              performed to ensure that the condition holds:
            </p>
            <ol>
              <li>
                Let Δ be <a>SuperscriptBottomMaxWithSubscript</a>
                − (<code>SuperShift</code> − the ink line-descent of the
                superscript's margin box).
                If Δ &gt; 0 then set Δ to the minimum between Δ set
                <a>SubSuperscriptGapMin</a> − <code>SubSuperGap</code> and
                increase <code>SuperShift</code> (and so
                <code>SubSuperGap</code> too) by Δ.
              </li>
              <li>
                Let Δ be <a>SubSuperscriptGapMin</a> − <code>SubSuperGap</code>.
                If Δ &gt; 0 then
                increase <code>SubscriptShift</code> (and so
                <code>SubSuperGap</code> too) by Δ.
              </li>
            </ol>
            <p>
              The ink line-ascent (respectively line-ascent, ink line-descent,
              line-descent) of the content
              is set to the maximum
              of the
              ink line-ascents (respectively line-ascents, ink line-descents,
              line-descents) of the content
              calculated in
              in <a href="#base-with-subscript"></a> and
              <a href="#base-with-superscript"></a>
              but using the adjusted values <code>SubShift</code> and
              <code>SuperShift</code> above.
            </p>
            <p>
              The inline and block offsets of the base and scripts are
              performed the
              same as described in
              <a href="#base-with-subscript"></a> and
              <a href="#base-with-superscript"></a>.
            </p>
            <div class="note" id="msubsup-with-empty-scripts">
              <p>
                Even when the subscript (respectively superscript) is an empty
                box, <code>&lt;subsup&gt;</code>
                does not generally render the same as
                <a href="#base-with-superscript"></a>
                (respectively <a href="#base-with-subscript"></a>)
                because of the additional constraint on
                <code>SubSuperGap</code>.
                Moreover, positioning the empty subscript
                (respectively superscript)
                may also change the total size.
              </p>
              <p>
                In order to keep the algorithm simple, no attempt is made to
                handle empty scripts in a special way.
              </p>
             </div>
          </section>
        </section>
        <section>
          <h4>Underscripts and Overscripts <code>&lt;munder&gt;</code>,
            <code>&lt;mover&gt;</code>, <code>&lt;munderover&gt;</code></h4>
          <div data-tests="presentation-markup/scripts/underover-1.html,presentation-markup/scripts/underover-parameters-1.html,presentation-markup/scripts/underover-parameters-2.html,presentation-markup/scripts/underover-parameters-3.html,presentation-markup/scripts/underover-parameters-4.html"></div>
          <p>
            The <dfn><code>&lt;munder&gt;</code></dfn>,
            <dfn><code>&lt;mover&gt;</code></dfn> and
            <dfn><code>&lt;munderover&gt;</code></dfn> elements are used to
            attach
            accents or limits placed under or over a MathML expression.
          </p>
          <p>
            The <code>&lt;munderover&gt;</code> element accepts the attribute
            described in <a href="#global-attributes"></a> as well as the
            following attributes:
          </p>
          <ul>
            <li><a href="#attribute-munderover-accent" class="internalDFN" data-link-type="dfn"><code>accent</code></a></li>
            <li><a href="#attribute-munderover-accentunder" class="internalDFN" data-link-type="dfn"><code>accentunder</code></a></li>
          </ul>
          <p>
            Similarly, the <code>&lt;mover&gt;</code> element
            (respectively <code>&lt;munder&gt;</code> element) accepts the
            attribute described in <a href="#global-attributes"></a>
            as well as the <a href="#attribute-munderover-accent"
                              class="internalDFN"
                              data-link-type="dfn"><code>accent</code></a>
            attribute (respectively the
            <a href="#attribute-munderover-accentunder"
               class="internalDFN"
               data-link-type="dfn"><code>accentunder</code></a> attribute).
          </p>
          <p>
            <dfn id="attribute-munderover-accent"><code>munderover@accent</code></dfn>,
            <dfn id="attribute-munderover-accentunder"><code>munderover@accentunder</code></dfn>,
            attributes, if present, must have values that are <a>booleans</a>.
            User agents must implement them as described in
            <a href="#displaystyle-and-scriptlevel-in-scripts"></a>.
          </p>
          <section>
            <h5>Children of <code>&lt;munder&gt;</code>,
            <code>&lt;mover&gt;</code>, <code>&lt;munderover&gt;</code></h5>
            <div class="issue" data-number="15">Decide how to handle invalid
              markup.</div>
            <p>
              If the <code>&lt;munder&gt;</code> element
              has less or more than two children, its layout algorithm
              is the same as the <a><code>&lt;mrow&gt;</code></a> element.
              Otherwise, the first child is called the
              <em>base</em> and the second child is called the
              <em>underscript</em>.
            </p>
            <p>
              If the <code>&lt;mover&gt;</code> element
              has less or more than two children, its layout algorithm
              is the same as the <a><code>&lt;mrow&gt;</code></a> element.
              Otherwise, the first child is called the
              <em>base</em> and the second child is called the
              <em>overscript</em>.
            </p>
            <p>
              If the <code>&lt;munderover&gt;</code> element
              has less or more than three children, its layout algorithm
              is the same as the <a><code>&lt;mrow&gt;</code></a> element.
              Otherwise, the first child is called the
              <em>base</em>, the second child is called the <em>underscript</em>
              and its third child is called
              the <em>overscript</em>.
            </p>
            <p>
              If the base is an
              <a>embellished operator</a> with the
              <a><code>movablelimits</code></a> property
              then the underscript and overscript are actually
              drawn as subscript and superscript positions.
              Then <code>&lt;mover&gt;</code>, <code>&lt;mover&gt;</code> and
              <code>&lt;munderover&gt;</code> layout algorithms are respectively
              the same as the ones described for
              <code>&lt;msub&gt;</code>, <code>&lt;msup&gt;</code> and
              <code>&lt;msubsup&gt;</code> in
              <a href="#base-with-subscript"></a>,
              <a href="#base-with-superscript"></a> and
              <a href="#base-with-subscript-and-superscript"></a>.
            </p>
            <p>
              Otherwise, the
              <code>&lt;mover&gt;</code>, <code>&lt;mover&gt;</code> and
              <code>&lt;munderover&gt;</code> layout algorithms are respectively
              described in
              <a href="#base-with-underscript"></a>,
              <a href="#base-with-overscript"></a> and
              <a href="#base-with-underscript-and-overscript"></a>
            </p>
          </section>
          <section>
            <h4>Algorithm for stretching operators along the inline</h4>
            <p>
              The <dfn>algorithm for stretching operators along the inline
                axis</dfn>
              is as follows.
            </p>
            <ol>
              <li>
                If there is an
                <a>inline stretch size constraint</a> or
                <a>block stretch size constraint</a>
                then the element being laid out is an
                <a>embellished operator</a>. Layout the base
                with the same stretch size constraint.
              </li>
              <li>
                Split the list remaining children into a first list
                <code>L<sub>ToStretch</sub></code> containing
                <a>embellished operators</a> with
                a <a>stretchy</a> property and inline <a>stretch axis</a>
                and a second list <code>L<sub>NotToStretch</sub></code>.
              </li>
              <li>
                Perform layout without any stretch size constraint on
                all the elements of <code>L<sub>NotToStretch</sub></code>.
                If <code>L<sub>ToStretch</sub></code> is empty then stop.
                If <code>L<sub>NotToStretch</sub></code> is empty, perform
                layout without any stretch size constraint on
                all the elements of <code>L<sub>ToStretch</sub></code>.
              </li>
              <li>
                Calculate the target size <code>T</code> to
                the maximum inline size of the
                margin boxes of children that have been laid out in the
                previous step.
              </li>
              <li>
                Layout or relayout all the elements of
                <code>L<sub>ToStretch</sub></code>
                with <a>inline stretch size constraint</a> <code>T</code>.
              </li>
            </ol>
          </section>
          <section>
            <h4>Base with underscript</h4>
            <p>
              The <code>&lt;munder&gt;</code> element is laid out as shown on
              <a href="#figure-box-munder"></a>.
              <code>LargeOpItalicCorrection</code>
              is the <a>italic correction</a> of the base
              if it is an <a>embellished operator</a> with
              the <a><code>largeop</code></a> property and 0 otherwise.
            </p>
            <figure id="figure-box-munder">
              <img src="figures/munderbox.svg"/>
              <figcaption>Box model for the <code>&lt;munder&gt;</code> element</figcaption>
            </figure>
            <p>
              The min-content (respectively max-content) inline sizes
              of the content are
              calculated like the inline size of the content below
              but replacing the
              inline sizes of the base's margin box and underscript's margin box
              with
              the min-content (respectively max-content) inline sizes
              of the base's margin box and underscript's margin box.
            </p>
            <p>
              The children are laid out
              using the <a>algorithm for stretching operators along the inline axis</a>.
            </p>
            <p>
              The inline size of the content is
              calculated by determining the absolute difference between:
            </p>
            <ul>
              <li>The maximum of:
                <ul>
                  <li>Half the inline size of the base's margin box.</li>
                  <li>Half the inline size of the underscript's margin box −
                    half <code>LargeOpItalicCorrection</code>.</li>
                </ul>
              </li>
              <li>The minimum of:
                <ul>
                  <li>−Half the inline size of the base's margin box.</li>
                  <li>−Half the inline size of the underscript's margin box −
                    half <code>LargeOpItalicCorrection</code>.</li>
                </ul>
              </li>
            </ul>
            <p>
              If m is the minimum calculated in the second item above then the
              inline offset
              of the base is −m − half the inline size of the base's margin box.
              The inline offset of the underscript is
              −m − half the inline size of the underscript's margin box −
              half <code>LargeOpItalicCorrection</code>.
            </p>
            <p>
              Parameters
              <code>UnderShift</code> and <code>UnderExtraDescender</code>
              are determined by considering three cases in the following order:
            </p>
            <ol>
              <li>
                <p>
                  The base is an
                  <a>embellished operator</a> with the
                  <a><code>largeop</code></a> property.
                  <code>UnderShift</code> is the maximum of
                </p>
                <ul>
                  <li><a>LowerLimitBaselineDropMin</a></li>
                  <li><a>LowerLimitGapMin</a> + the ascent of the
                    underscript.</li>
                </ul>
                <p>
                  <code>UnderExtraDescender</code> is 0.
                </p>
              </li>
              <li>
                <p>
                  The base is an
                  <a>embellished operator</a> with the
                  <a><code>stretchy</code></a> property
                  and <a>stretch axis</a> inline.
                  <code>UnderShift</code> is the maximum of:
                </p>
                <ul>
                  <li><a>StretchStackBottomShiftDown</a></li>
                  <li><a>StretchStackGapAboveMin</a> + the ascent of the
                    underscript.</li>
                </ul>
                <code>UnderExtraDescender</code> is 0.
              </li>
              <li>
                Otherwise,
                <code>UnderShift</code> is equal to <a>UnderbarVerticalGap</a>
                if the underscript is not an accent and to zero otherwise.
                <code>UnderExtraAscender</code> is
                <a>UnderbarExtraDescender</a>.
              </li>
            </ol>
            <p>
              The (ink) line-ascent of the content is the maximum between:
            </p>
            <ul>
              <li>The (ink) line-ascent of the base's margin box.</li>
              <li>The (ink) line-ascent of the underscript's margin box −
                <code>UnderShift</code>.</li>
            </ul>
            <p>
              The (ink) line-descent of the content is the maximum between:
            </p>
            <ul>
              <li>The (ink) line-descent of the base's margin box.</li>
              <li>The (ink) line-descent of the underscript's margin box +
                <code>UnderShift</code> + <code>UnderExtraAscender</code>
                (this last term is ignored in the ink case).</li>
            </ul>
            <p>
              The baseline of the base is aligned with the baseline.
              The baseline of the underscript is shifted away from the baseline
              and towards the line-under by a distance equal to
              the ink line-descent of the base's margin box
              + <code>UnderShift</code>.
            </p>
          </section>
          <section>
            <h4>Base with overscript</h4>
            <p>
              The <code>&lt;mover&gt;</code> element is laid out as shown on
              <a href="#figure-box-mover"></a>.
              <code>LargeOpItalicCorrection</code>
              is the <a>italic correction</a> of the base
              if it is an <a>embellished operator</a> with
              the <a><code>largeop</code></a> property and 0 otherwise.
            </p>
            <figure id="figure-box-mover">
              <img src="figures/moverbox.svg"/>
              <figcaption>Box model for the <code>&lt;mover&gt;</code> element</figcaption>
            </figure>
            <p>
              The min-content (respectively max-content) inline sizes
              of the content are
              calculated like the inline size of the content
              below but replacing the
              inline sizes of the base's margin box and underscript's margin
              box with
              the min-content (respectively max-content) inline sizes
              of the base's margin box and underscript's margin box.
            </p>
            <p>
              The children are laid out
              using the <a>algorithm for stretching operators along the inline axis</a>.
            </p>
            <p>
              The <code>TopAccentAttachment</code> is the
              <a>top accent attachment</a> of the overscript or
              half the inline size of the overscript's margin box
              if it is undefined.
            </p>
            <p>
              The inline size of the content is
              calculated by
              applying the <a>algorithm for stretching operators along the inline axis</a> for
              layout and determining the absolute difference between:
            </p>
            <ul>
              <li>The maximum of:
                <ul>
                  <li>Half the inline size of the base's margin box.</li>
                  <li>The inline size of the overscript's margin box
                    − <code>TopAccentAttachment</code> +
                    half <code>LargeOpItalicCorrection</code>.</li>
                </ul>
              </li>
              <li>The minimum of:
                <ul>
                  <li>−Half the inline size of the base's margin box.</li>
                  <li>−<code>TopAccentAttachment</code> +
                    half <code>LargeOpItalicCorrection</code>.</li>
                </ul>
              </li>
            </ul>
            <p>
              If m is the minimum calculated in the second item above then the
              inline offset
              of the base is −m − half the inline size of the base's margin.
              The inline offset of the overscript is
              −m − half the inline size of the overscript's margin box +
              half <code>LargeOpItalicCorrection</code>.
            </p>
            <p>
              Parameters
              <code>OverShift</code> and <code>OverExtraDescender</code>
              are determined by considering three cases in the following order:
            </p>
            <ol>
              <li>
                <p>
                  The base is an
                  <a>embellished operator</a> with the
                  <a><code>largeop</code></a> property.
                  <code>OverShift</code> is the maximum of
                </p>
                <ul>
                  <li><a>UpperLimitBaselineRiseMin</a></li>
                  <li><a>UpperLimitGapMin</a> + the descent of the
                    overscript.</li>
                </ul>
                <p>
                  <code>OverExtraAscender</code> is 0.
                </p>
              <li>
                <p>
                  The base is an
                  <a>embellished operator</a> with the
                  <a><code>stretchy</code></a> property and
                  <a>stretch axis</a> inline.
                  <code>OverShift</code> is the maximum of:
                </p>
                <ul>
                  <li><a>StretchStackTopShiftUp</a></li>
                  <li><a>StretchStackGapBelowMin</a> + the descent of the
                    overscript.</li>
                </ul>
                <code>OverExtraDescender</code> is 0.
              </li>
              <li>
                <p>
                  Otherwise, <code>OverShift</code> is equal to</p>
                <ol>
                  <li><a>OverbarVerticalGap</a> if the overscript is not an
                    accent.</li>
                  <li>Or <a>AccentBaseHeight</a> minus the line-ascent
                    of the base's margin box
                    if this difference is nonnegative.</li>
                  <li>Or 0 otherwise.</li>
                </ol>
                <p>
                  <code>OverExtraAscender</code> is <a>OverbarExtraAscender</a>.
                </p>
              </li>
            </ol>
            <div class="note">
              For accent overscripts and bases with line-ascents that are at
              most
              <a>AccentBaseHeight</a>, the rule from
              [[OPEN-FONT-FORMAT]] [[?TEXBOOK]] is actually to align the
              baselines of the overscripts and of the bases. This assumes that
              accent glyphs are designed in such a way that their ink bottoms
              are
              more or less <a>AccentBaseHeight</a> above their baselines. Hence,
              the previous rule will guarantee that all the overscript bottoms
              are aligned while still avoiding collision with the bases.
              However, MathML can have arbitrary accent overscripts
              a more general and simpler rule is provided above: Ensure
              that the bottom of overscript is at least
              <a>AccentBaseHeight</a> above the baseline of the base.
            </div>
            <p>
              The (ink) line-ascent of the content is the maximum between:
            </p>
            <ul>
              <li>The (ink) line-ascent of the base's margin box.</li>
              <li>The (ink) line-ascent of the overscript's margin box +
                <code>OverShift</code> + <code>OverExtraAscender</code>
                (this last term is ignored in the ink case).</li>
            </ul>
            <p>
              The (ink) line-descent of the content is the maximum between:
            </p>
            <ul>
              <li>The (ink) line-descent of the base's margin box.</li>
              <li>The (ink) line-descent of the overscript's margin box −
                <code>OverShift</code>.</li>
            </ul>
            <p>
              The baseline of the base is aligned with the baseline.
              The baseline of the overscript is shifted away from the baseline
              and towards the line-over by a distance equal to
              the ink line-over of the base + <code>OverShift</code>.
            </p>
          </section>
          <section>
            <h4>Base with underscript and overscript</h4>
            <p>
              The general layout of <code>&lt;munderover&gt;</code> is shown on
              <a href="#figure-box-munderover"></a>. The
              <code>LargeOpItalicCorrection</code>,
              <code>UnderShift</code>,
              <code>UnderExtraDescender</code>,
              <code>OverShift</code>,
              <code>OverExtraDescender</code> parameters
              are calculated the same as in
              <a href="#base-with-underscript"></a> and
              <a href="#base-with-overscript"></a>.
            </p>
            <figure id="figure-box-munderover">
            <img src="figures/munderoverbox.svg"/>
            <figcaption>Box model for the <code>&lt;munderover&gt;</code> element</figcaption>
            </figure>
            <p>
              The min-content inline size, max-content inline size
              and inline size of the content
              are calculated as an absolute difference
              between a maximum inline offset and minimum inline offset.
              These extrema are calculated by taking the extremum value
              of the corresponding extrema calculated in
              <a href="#base-with-underscript"></a> and
              <a href="#base-with-overscript"></a>.
              The inline offsets of the base, underscript and
              overscript are calculated as in these sections but using
              the new minimum m (minimum of the corresponding minima).
            </p>
            <p>
              Like in these sections, the children are laid out
              using the <a>algorithm for stretching operators along the inline axis</a>.
            </p>
            <p>
              The (ink) line-ascent and (ink) line-descent of the content
              are also calculated by taking the extremum value
              of the extrema calculated in
              <a href="#base-with-underscript"></a> and
              <a href="#base-with-overscript"></a>.
            </p>
            <p>
              Finally, the baselines of the base, undescript and overscript
              are calculated as in sections
              <a href="#base-with-underscript"></a> and
              <a href="#base-with-overscript"></a>.
            </p>
            <div class="note">
              <p>
                When the underscript (respectively overscript) is an empty
                box, the base and overscript (respectively underscript) are laid
                out similarly to
                <a href="#base-with-overscript"></a>
                (respectively <a href="#base-with-underscript"></a>)
                but the position of the empty underscript (respectively
                overscript) may add extra space.
                In order to keep the algorithm simple, no attempt is made to
                handle empty scripts in a special way.
              </p>
            </div>
          </section>
        </section>
        <section>
          <h4>Prescripts and Tensor Indices <code>&lt;mmultiscripts&gt;</code></h4>
          <p>
            Presubscripts and tensor notations are represented
            the <dfn><code>&lt;mmultiscripts&gt;</code></dfn>
            with hints given by the
            <dfn><code>&lt;mprescripts&gt;</code></dfn>
            (to distinguish postscripts and prescripts)
            and
            <dfn><code>&lt;none&gt;</code></dfn> elements
            (to indicate empty scripts).
            These element accept the attributes described in
            <a href="#global-attributes"></a>.
          </p>
          <p>
            The empty
            <code>&lt;mprescripts&gt;</code> and <code>&lt;none&gt;</code>
            elements are laid out as an <a><code>&lt;mrow&gt;</code></a>
            element.
          </p>
          <div class="issue" data-number="15">Decide how to handle invalid
            markup.</div>
          <p>
            A valid <code>&lt;mmultiscripts&gt;</code> element contains the
            following children:
          </p>
          <ul>
            <li>
              A first child, called the <em>base</em> that is not a
              an <a><code>&lt;mprescripts&gt;</code></a> element.
            </li>
            <li>
              Followed by an even number of children called
              <em>postscripts</em>, none of them being a
              <a><code>&lt;mprescripts&gt;</code></a> element.
              These scripts form a (possibly empty) list of
              <em>subscript/superscript pairs</em>.
            </li>
            <li>Optionally followed by
              an <a><code>&lt;mprescripts&gt;</code></a> element and
              an even number of children called
              <em>prescripts</em>, none of them being a
              <a><code>&lt;mprescripts&gt;</code></a> element.
              These scripts form a (possibly empty) list of
              <em>subscript/superscript pairs</em>.
            </li>
          </ul>
          <p>
            If an <code>&lt;mmultiscripts&gt;</code> element is not valid then
            it is laid out the same as the
            <a><code>&lt;mrow&gt;</code></a> element.
            Otherwise the layout algorithm is explained below.
          </p>
          <div class="note">
            The <code>&lt;none&gt;</code> element is preserved for backward
            compatibility reasons but is actually not taken into account
            in the layout algorithm.
          </div>
          <section>
            <h5>Base with prescripts and postscripts</h5>
            <p>
              The <code>&lt;mmultiscripts&gt;</code> element is laid out as
              shown on <a href="#figure-box-mmultiscripts"></a>.
              For each postscript pair, the <code>ItalicCorrection</code>
              <code>LargeOpItalicCorrection</code> are defined as
              in <a href="#base-with-subscript"></a>
              and <a href="#base-with-superscript"></a>.
            </p>
            <figure id="figure-box-mmultiscripts">
              <img src="figures/mmultiscriptsbox.svg"/>
              <figcaption>Box model for the <code>&lt;mmultiscripts&gt;</code> element</figcaption>
            </figure>
            <p>
              The min-content (respectively max-content) inline size of the
              content is
              calculated the same as the inline size of the content
              below, but replacing
              "inline size" with "min-content inline size"
              (respectively "max-content inline size") for the base's margin
              box and scripts's margin boxes.
            </p>
            <p>
              If there is an <a>inline stretch size constraint</a> or a
              <a>block stretch size constraint</a>
              the base is also laid out with the same stretch size constraint.
              Otherwise it is laid out without any stretch
              size constraint. The other elements are always laid out without
              any stretch size constraint.
            </p>
            <p>
              The inline size of the content
              is calculated with the following algorithm:
            </p>
            <ol>
              <li>Set <code>inline-offset</code> to 0.</li>
              <li>
                <p>
                  For each prescript pair, increment
                  <code>inline-offset</code> by <a>SpaceAfterScript</a> + the
                  maximum of
                </p>
                <ul>
                  <li>The inline size of the subscript's margin box.</li>
                  <li>The inline size of the superscript's margin box.</li>
                </ul>
              </li>
              <li>
                Increment <code>inline-offset</code> by the inline size of the
                base's margin box and
                set <code>inline-size</code> to <code>inline-offset</code>.
              </li>
              <li>
                <p>
                  For each postscript pair, modify
                  <code>inline-size</code> to be at least:
                </p>
                <ul>
                  <li>
                    x + the inline size of the subscript's margin box +
                    <code>LargeOpItalicCorrection</code>.
                  </li>
                  <li>
                    x + the inline size of the superscript's margin box −
                    <code>ItalicCorrection</code>.
                  </li>
                </ul>
                <p>Increment <code>inline-offset</code> to the maximum of:</p>
                <ul>
                  <li>
                    the inline size of the subscript's margin box.
                  </li>
                  <li>
                    the inline size of the superscript's margin box.
                  </li>
                </ul>
                <p>
                  Increment <code>inline-offset</code> by
                  <a>SpaceAfterScript</a>.
                </p>
              </li>
              <li>Return <code>inline-size</code></li>
            </ol>
            <p>
              <code>SubShift</code> (respectively <code>SuperShift</code>)
              is calculated by taking the maximum of all subshifts
              (respectively supershifts) of each
              subscript/superscript pair as described in
              <a href="#base-with-subscript-and-superscript"></a>.
            </p>
            <p>
              The (ink) line-ascent of the content is calculated
              by taking the maximum of all the (ink) line-ascent
              of each subscript/superscript pair as described in
              <a href="#base-with-subscript-and-superscript"></a>
              but using the <code>SubShift</code> and
              <code>SuperShift</code> values calculated above.
            </p>
            <p>
              The (ink) line-descent of the content is calculated
              by taking the maximum of all the (ink) line-descent
              of each subscript/superscript pair as described in
              <a href="#base-with-subscript-and-superscript"></a>
              but using the <code>SubShift</code> and
              <code>SuperShift</code> values calculated above.
            </p>
            <p>
              Finally, the placement of the children is performed using the
              following algorithm:
            </p>
            <ol>
              <li>Set <code>inline-offset</code> to 0.</li>
              <li>
                <p>For each prescript pair:</p>
                <ol>
                  <li>
                    Increment <code>inline-offset</code> by
                    <a>SpaceAfterScript</a>.
                  </li>
                  <li>
                    Set <code>pair-inline-size</code> to the maximum of
                    <ul>
                      <li>
                        the inline size of the subscript's margin box.
                      </li>
                      <li>
                        the inline size of the superscript's margin box.
                      </li>
                    </ul>
                  </li>
                  <li>
                    Place the subscript at inline-start position
                    <code>inline-offset</code> + <code>pair-inline-size</code>
                    − the inline size of the subscript's margin box.
                  </li>
                  <li>
                    Place the superscript at inline-start position
                    <code>inline-offset</code> + <code>pair-inline-size</code>
                    − the inline size of the superscript's margin box.
                  </li>
                  <li>
                    Place the subscript (respectively superscript) so its
                    baseline is
                    shifted away from the baseline by
                    <code>SubShift</code> (respectively <code>SuperShift</code>)
                    towards the line-under (respectively line-over).
                  </li>
                  <li>
                    Increment <code>inline-offset</code> by
                    <code>pair-inline-size</code>.
                  </li>
              </ol>
              <li>
                Place the base and <code>&lt;mprescript&gt;</code> boxes
                at inline offsets
                <code>inline-offset</code> and with their baselines
                aligned with the baseline.
              </li>
              <li>
                <p>
                  For each postscript pair:
                </p>
                <ol>
                  <li>
                    Set <code>pair-inline-size</code> to the maximum of
                    <ul>
                      <li>
                        the inline size of the subscript's margin box.
                      </li>
                      <li>
                        the inline size of the superscript's margin box.
                      </li>
                    </ul>
                  </li>
                  <li>
                    Place the subscript
                    at inline-start position <code>inline-offset</code>
                    − <code>LargeOpItalicCorrection</code>.
                  </li>
                  <li>
                    Place the superscript
                    at inline-start position <code>inline-offset</code>
                    + <code>ItalicCorrection</code>.
                  </li>
                  <li>
                    Place the subscript (superscript) so its baseline is
                    shifted away from the baseline by
                    <code>SubShift</code> (respectively <code>SuperShift</code>)
                    towards the line-under (respectively line-over).
                  </li>
                  <li>
                    Increment <code>inline-offset</code> by
                    <code>pair-inline-size</code>
                  </li>
                  <li>
                    Increment <code>inline-offset</code> by
                    <a>SpaceAfterScript</a>.
                  </li>
                </ol>
              </li>
            </ol>
            <div class="note">
              <p>
                An <code>&lt;mmultiscripts&gt;</code> with only one
                postscript pair is laid out the same as a
                <code>&lt;msubsup&gt;</code> with the same children.
                However, as
                <a href="#msubsup-with-empty-scripts">noticed for
                  <code>&lt;msubsup&gt;</code></a>,
                if additionally the subscript (respectively superscript) is an
                empty box then it is not necessarily laid out the same as an
                <code>&lt;msub&gt;</code>
                (respectively <code>&lt;msup&gt;</code>) element.
                In order to keep the algorithm simple, no attempt is made to
                handle empty or <code>&lt;none&gt;</code> scripts in a special
                way.
              </p>
            </div>
          </section>
        </section>
        <section>
          <h4>Displaystyle and scriptlevel in scripts</h4>
          <p>
            For all MathML elements used for scripts and limits schemata,
            the first child is the base while the other children
            are scripts. In these scripts, the rule of thumb is to set
            <a><code>displaystyle</code></a> to <code>false</code>
            and to increment <a><code>scriptlevel</code></a>.
            However, when an overscript (respectively underscript)
            has an <a href="#attribute-munderover-accent" class="internalDFN" data-link-type="dfn"><code>accent</code></a>
            (respecitvely <a href="#attribute-munderover-accentunder" class="internalDFN" data-link-type="dfn"><code>accentunder</code></a>)
            attribute that is case-insensitive match
            to <code>"true"</code> then
            the <a><code>scriptlevel</code></a> is not incremented.
          </p>
          <p>
            The
            <a href="#user-agent-stylesheet"></a> must contain the following
            style in order to implement this behavior:
          </p>
          <pre class="css" data-include="user-agent-stylesheet/scripts.css"></pre>
          <div class="issue" data-number="76">
            In [[MathML3]] specification, the scriptlevel shouldn't be
            incremented either if the underscript/overscript is an
            <a>embellished operator</a> with the
            <a><code>accent</code></a> property.
          </div>
        </section>
      </section>
      <section>
        <h3>Tabular Math</h3>
        <p>
          Matrices, arrays and other table-like mathematical notation are marked up
          using
          <a><code>&lt;mtable&gt;</code></a>
          <a><code>&lt;mtr&gt;</code></a>
          <a><code>&lt;mtd&gt;</code></a>
          elements.  These  elements are similar to the
          <a data-cite="HTML#the-table-element"><code>&lt;table&gt;</code></a>,
          <a data-cite="HTML#the-tr-element"><code>&lt;tr&gt;</code></a>
          and
          <a data-cite="HTML#the-td-element"><code>&lt;td&gt;</code></a>
          elements of [[HTML]].
        </p>
        <div class="issue" data-number="114">
          This describes a very partial support for [[MathML3]] tables.
          Do we want more? Should CSS be extended to cover math table's use cases?
        </div>
        <section>
          <h4>Table or Matrix <code>&lt;mtable&gt;</code></h4>
          <div data-tests="presentation-markup/tables/table-axis-height.html"></div>
          <p>The <dfn><code>&lt;mtable&gt;</code></dfn> is laid out as an
            <code>inline-table</code> and sets
            <code>displaystyle</code> to <code>false</code>. The
            <a href="#user-agent-stylesheet">user agent stylesheet</a> must contain
            the following rules in order to implement these properties:
          </p>
          <pre data-include="user-agent-stylesheet/mtable.css"></pre>
          <p>
            The <code>&lt;mtable&gt;</code> accepts the attributes described
            in <a href="#global-attributes"></a> as well as the following
            attribute:
            <ul>
              <li><a>frame</a></li>
            </ul>
          <p>
            The <dfn>frame</dfn> attribute, if present, must be a case-insensitive match
            to one of <code>none</code>, <code>solid</code> or
            <code>dashed</code>. The <a href="#user-agent-stylesheet">user agent
              stylesheet</a> must contain the following rules in order to implement
            that attribute:
          </p>
          <pre data-include="user-agent-stylesheet/mtable-frame.css"></pre>
          <div class="issue">Improve baseline description here.</div>
          <p>
            The <code>mtable</code> element is as a CSS
            <a data-cite="CSS-DISPLAY-3#valdef-display-table">table</a>
            and the min-content/max-content inline sizes,
            inline size, block size, first/last baseline sets are determined
            accordingly.
            The math axis is aligned with the center of the table.
          </p>
        </section>
        <section>
          <h4>Row in Table or Matrix <code>&lt;mtr&gt;</code></h4>
          <p>
            The <dfn><code>&lt;mtr&gt;</code></dfn> is laid out as
            <code>table-row</code>. The
            <a href="#user-agent-stylesheet">user agent stylesheet</a> must contain
            the following rules in order to implement that behavior:
          </p>
          <pre data-include="user-agent-stylesheet/mtr.css"></pre>
          <p>
            The <code>&lt;mtr&gt;</code> accepts the attributes described
            in <a href="#global-attributes"></a>.
          </p>
        </section>
        <section>
          <h4>Entry in Table or Matrix <code>&lt;mtd&gt;</code></h4>
          <p>
            The <dfn><code>&lt;mtd&gt;</code></dfn> is laid out as
            a <code>table-cell</code> with content centered in the cell and
            a default padding. The
            <a href="#user-agent-stylesheet">user agent stylesheet</a> must contain
            the following rules:
          </p>
          <pre data-include="user-agent-stylesheet/mtd.css"></pre>
          <p>
            The <code>&lt;mtr&gt;</code> accepts the attributes described
            in <a href="#global-attributes"></a> as well as the following attributes:
          </p>
          <ul>
            <li><a>columnspan</a></li>
            <li><a>rowspan</a></li>
          </ul>
          <p>
            The <dfn><code>columnspan</code></dfn> (respectively
            <dfn><code>rowspan</code></dfn>) attribute has the same
            syntax and semantic as the
            <a data-cite="HTML#attr-tdth-colspan"><code>&lt;colspan&gt;</code></a>
            (respectively
            <a data-cite="HTML#attr-tdth-rowspan"><code>&lt;rowspan&gt;</code></a>)
            attribute on the <code>&lt;td&gt;</code> element from [[HTML]].
          </p>
          <div class="note">
            The name for the column spanning attribute is
            <code>columnspan</code> as in [[MathML3]] and not
            <code>colspan</code> as in [[HTML]].
          </div>
        </section>
      </section>
      <section>
        <h3>Enlivening Expressions</h3>
        <p>
          Historically, the
          <dfn><code>&lt;maction&gt;</code></dfn>
          element provides a mechanism
          for binding actions to expressions.
        </p>
        <p>
          The <code>&lt;maction&gt;</code> element accepts the attributes described
          in <a href="#global-attributes"></a> as well as the following
          attributes:
        </p>
        <ul>
          <li><code>actiontype</code></li>
          <li><code>selection</code></li>
        </ul>
        <p>
          The <dfn>actiontype</dfn> and <dfn>selection</dfn> attributes are
          not taken into account in the present specification but may be used
          by authors to implement custom actions on the
          <code>&lt;maction&gt;</code> element.
        </p>
        <p>
          The layout algorithm of the <code>&lt;maction&gt;</code> element
          the same as the <code>&lt;mrow&gt;</code> element.
          The <a href="#user-agent-stylesheet">user agent stylesheet</a>
          must contain the following rules in order to hide all but
          its first child, which is the default behavior for the legacy actiontype
          values:
        </p>
        <pre class="css" data-include="user-agent-stylesheet/maction.css"></pre>
        <div class="note">
		  <code>&lt;maction&gt;</code> is implemented for compatibility with full MathML. Authors whose only target is MathML Core are encouraged to use CSS for styling.
        </div>
      </section>
      <section>
        <h3>Semantics and Presentation</h3>
        <p>
          The
          <dfn><code>&lt;semantics&gt;</code></dfn>
          element is the container element that associates
          annotations with a MathML expression. Typically, the
          <code>&lt;semantics&gt;</code> element has as its first child a
          MathML expression to be annotated while subsequent children represent
          text annotations within an <dfn><code>&lt;annotation&gt;</code></dfn>
          element, or more complex markup annotations within
          an <dfn><code>&lt;annotation-xml&gt;</code></dfn> element.
        </p>
        <p>
          The <code>&lt;semantics&gt;</code> element accepts the attributes
          described in <a href="#global-attributes"></a>. Its layout algorithm
          is the same as the <a><code>&lt;mrow&gt;</code></a> element.
          The <a href="#user-agent-stylesheet">user agent stylesheet</a>
          must contain the following rule in order to only render the annotated
          MathML expression:
        </p>
        <pre data-include="user-agent-stylesheet/semantics.css"></pre>
        <p>
          The <code>&lt;annotation-xml&gt;</code> and
          <code>&lt;annotation&gt;</code> element accepts the attributes
          described in <a href="#global-attributes"></a> as well as the
          following attribute:
        </p>
        <ul>
          <li><code>encoding</code></li>
        </ul>
        <p>
          The <dfn>encoding</dfn> attribute is not taken into account in the
          present specification but it is intended to distinguish annotations
          for <a data-cite="HTML#html-integration-point">HTML integration point</a>, clipboard copy, alternative rendering etc
        </p>
        <p>
          The layout algorithm of the <code>&lt;annotation-xml&gt;</code>
          and <code>&lt;annotation&gt;</code>
          element is the same as the <a><code>&lt;mtext&gt;</code></a> element.
        </p>
        <div class="note">
          CSS can be used to render alternative annotations e.g.
          <pre class="css">
            /* Hide the annotated child. */
            semantics > :first-child { display: none; }
             /* Show all text annotations. */
            semantics > annotation { display: block; }
            /* Show all HTML annotations. */
            semantics > annotation-xml[encoding="text/html" i],
            semantics > annotation-xml[encoding="application/xhtml+xml" i] {
              display: block;
            }
          </pre>
        </div>
      </section>
    </section>
    <section class="normative">
      <h2>CSS Extensions for Math Layout</h2>
      <section>
        <h3>New <code>text-transform</code> values</h3>
        <div data-tests="../css/css-text/text-transform/math/text-transform-math-auto-001.tentative.html,../css/css-text/text-transform/math/text-transform-math-bold-001.tentative.html,../css/css-text/text-transform/math/text-transform-math-bold-fraktur-001.tentative.html,../css/css-text/text-transform/math/text-transform-math-bold-italic-001.tentative.html,../css/css-text/text-transform/math/text-transform-math-bold-sans-serif-001.tentative.html,../css/css-text/text-transform/math/text-transform-math-bold-script-001.tentative.html,../css/css-text/text-transform/math/text-transform-math-double-struck-001.tentative.html,../css/css-text/text-transform/math/text-transform-math-fraktur-001.tentative.html,../css/css-text/text-transform/math/text-transform-math-initial-001.tentative.html,../css/css-text/text-transform/math/text-transform-math-italic-001.tentative.html,../css/css-text/text-transform/math/text-transform-math-looped-001.tentative.html,../css/css-text/text-transform/math/text-transform-math-monospace-001.tentative.html,../css/css-text/text-transform/math/text-transform-math-sans-serif-001.tentative.html,../css/css-text/text-transform/math/text-transform-math-sans-serif-bold-italic-001.tentative.html,../css/css-text/text-transform/math/text-transform-math-sans-serif-italic-001.tentative.html,../css/css-text/text-transform/math/text-transform-math-script-001.tentative.html,../css/css-text/text-transform/math/text-transform-math-stretched-001.tentative.html,../css/css-text/text-transform/math/text-transform-math-tailed-001.tentative.html,relations/css-styling/mathvariant-auto.html,relations/css-styling/mathvariant-bold-fraktur.html,relations/css-styling/mathvariant-bold-italic.html,relations/css-styling/mathvariant-bold-sans-serif.html,relations/css-styling/mathvariant-bold-script.html,relations/css-styling/mathvariant-bold.html,relations/css-styling/mathvariant-double-struck.html,relations/css-styling/mathvariant-fraktur.html,relations/css-styling/mathvariant-initial.html,relations/css-styling/mathvariant-italic.html,relations/css-styling/mathvariant-looped.html,relations/css-styling/mathvariant-monospace.html,relations/css-styling/mathvariant-sans-serif-bold-italic.html,relations/css-styling/mathvariant-sans-serif-italic.html,relations/css-styling/mathvariant-sans-serif.html,relations/css-styling/mathvariant-script.html,relations/css-styling/mathvariant-stretched.html,relations/css-styling/mathvariant-tailed.html"></div>
        <p>The <dfn><code>text-transform</code></dfn> property
          from
          is extended with new values:
        </p>
        <code><a data-cite="CSS-TEXT-3#text-transform-property">&lt;text-transform-old&gt;</a> <a data-cite="CSS-VALUES-3#comb-one">|</a> math-auto | math-bold | math-italic | math-bold-italic | math-double-struck | math-bold-fraktur | math-script | math-bold-script | math-fraktur | math-sans-serif | math-bold-sans-serif | math-sans-serif-italic | math-sans-serif-bold-italic | math-monospace | math-initial | math-tailed | math-looped | math-stretched</code>
        <p>
          On text nodes containing a unique character, <code>math-auto</code> has
          the same effect as <code>math-italic</code>, otherwise it has no effects.
        </p>
        <p>
          For the
          <code>math-bold</code>,
          <code>math-italic</code>,
          <code>math-bold-italic</code>,
          <code>math-double-struck</code>,
          <code>math-bold-fraktur</code>,
          <code>math-script</code>,
          <code>math-bold-script</code>,
          <code>math-fraktur</code>,
          <code>math-sans-serif</code>,
          <code>math-bold-sans-serif</code>,
          <code>math-sans-serif-italic</code>,
          <code>math-sans-serif-bold-italic</code>,
          <code>math-monospace</code>,
          <code>math-initial</code>,
          <code>math-tailed</code>,
          <code>math-looped</code> and
          <code>math-stretched</code>
          values, the transformed text is
          obtained by performing conversion of each character according to
          the corresponding
          <a href="#bold-mappings">bold</a>,
          <a href="#italic-mappings">italic</a>,
          <a href="#bold-italic-mappings">bold-italic</a>,
          <a href="#double-struck-mappings">double-struck</a>,
          <a href="#bold-fraktur-mappings">bold-fraktur</a>,
          <a href="#script-mappings">script</a>,
          <a href="#bold-script-mappings">bold-script</a>,
          <a href="#fraktur-mappings">fraktur</a>,
          <a href="#sans-serif-mappings">sans-serif</a>,
          <a href="#bold-sans-serif-mappings">bold-sans-serif</a>,
          <a href="#sans-serif-italic-mappings">sans-serif-italic</a>,
          <a href="#sans-serif-bold-italic-mappings">sans-serif-bold-italic</a>,
          <a href="#monospace-mappings">monospace</a>,
          <a href="#initial-mappings">initial</a>,
          <a href="#tailed-mappings">tailed</a>,
          <a href="#looped-mappings">looped</a>,
          <a href="#stretched-mappings">stretched</a> tables.
        </p>
        <p>
          User agents may decide to rely on italic, bold and bold-italic
          font-level properties when available fonts lack the proper glyphs to
          perform <code>math-auto</code>, <code>math-italic</code>,
          <code>math-bold</code>, <code>math-bold-italic</code> character-level
          transforms.
        </p>
      </section>
      <section>
        <h3>The <code>math-style</code> property</h3>
        <div data-tests="../css/css-fonts/math-script-level-and-math-style/math-script-level-auto-and-math-style-001.tentative.html,../css/css-fonts/math-script-level-and-math-style/math-script-level-auto-and-math-style-002.tentative.html,../css/css-fonts/math-script-level-and-math-style/math-script-level-auto-and-math-style-003.tentative.html,../css/css-fonts/math-script-level-and-math-style/math-script-level-auto-and-math-style-004.tentative.html,../css/css-fonts/math-script-level-and-math-style/math-script-level-auto-and-math-style-005.tentative.html,../css/css-fonts/math-script-level-and-math-style/math-style-001.tentative.html,relations/css-styling/displaystyle-1.html"></div>
        <table>
          <tbody>
            <tr>
              <th>Name:</th>
              <td>
                <dfn><code>math-style</code></dfn>
              </td>
            </tr>
            <tr><th>Value:</th><td><code>display | inline</code></td></tr>
            <tr><th>Initial:</th><td><code>inline</code></td></tr>
            <tr><th>Applies to:</th><td>All elements</td></tr>
            <tr><th>Inherited:</th><td>yes</td></tr>
            <tr><th>Percentages:</th><td>n/a</td></tr>
            <tr><th>Media:</th><td>visual</td></tr>
            <tr><th>Computed value:</th><td>specified keyword</td></tr>
            <tr><th>Canonical order:</th><td>n/a</td></tr>
            <tr><th>Animation type:</th><td>not animatable</td></tr>
          </tbody>
        </table>
        <p>
          If the value of <code>math-style</code> is <code>inline</code>, the math
          layout on descendants should try to minimize the
          <a data-cite="CSS-WRITING-MODES-3#extent">logical height</a>.
          This includes how
          <a data-cite="CSS-FONTS-3#font-size-prop"><code>font-size</code></a>
          is changed when <a><code>math-script-level</code></a> is
          <code>auto</code> as well
          miscelleanous layout rules described in details in
          <a href="#presentation-markup"></a>.
          If the value of <code>math-style</code> is <code>display</code>, the math
          layout should not take such constraints into consideration.
        </p>
      </section>
      <section>
        <h3>The <code>math-script-level</code> property</h3>
        <div data-tests="../css/css-fonts/math-script-level-and-math-style/math-script-level-001.tentative.html,../css/css-fonts/math-script-level-and-math-style/math-script-level-002.tentative.html,../css/css-fonts/math-script-level-and-math-style/math-script-level-003.tentative.html,../css/css-fonts/math-script-level-and-math-style/math-script-level-004.tentative.html,../css/css-fonts/math-script-level-and-math-style/math-script-level-005.tentative.html,../css/css-fonts/math-script-level-and-math-style/math-script-level-auto-and-math-style-001.tentative.html,../css/css-fonts/math-script-level-and-math-style/math-script-level-auto-and-math-style-002.tentative.html,../css/css-fonts/math-script-level-and-math-style/math-script-level-auto-and-math-style-003.tentative.html,../css/css-fonts/math-script-level-and-math-style/math-script-level-auto-and-math-style-004.tentative.html,../css/css-fonts/math-script-level-and-math-style/math-script-level-auto-and-math-style-005.tentative.html,../css/css-fonts/math-script-level-and-math-style/math-script-level-font-size-clamping-001.tentative.html"></div>
        <table>
          <tbody>
            <tr>
              <th>Name:</th>
              <td>
                <dfn><code>math-script-level</code></dfn>
              </td>
            </tr>
            <tr><th>Value:</th><td><code>auto | add(&lt;integer&gt;) | &lt;integer&gt;</code></td></tr>
            <tr><th>Initial:</th><td><code>0</code></td></tr>
            <tr><th>Applies to:</th><td>All elements</td></tr>
            <tr><th>Inherited:</th><td>yes</td></tr>
            <tr><th>Percentages:</th><td>n/a</td></tr>
            <tr><th>Media:</th><td>visual</td></tr>
            <tr><th>Computed value:</th><td>see individual properties</td></tr>
            <tr><th>Canonical order:</th><td>n/a</td></tr>
            <tr><th>Animation type:</th><td>not animatable</td></tr>
          </tbody>
        </table>
        <p>
          If the specified value of <code>math-script-level</code> is
          <code>auto</code> and the inherited value of <code>math-style</code> is
          <code>display</code> then the computed value of
          <code>math-script-level</code> is the inherited value.
        </p>
        <p>If the specified value of <code>math-script-level</code> is
          <code>auto</code> and the inherited value of <code>math-style</code> is
          <code>inline</code> then the computed value of
          <code>math-script-level</code> is the inherited value plus one.
        </p>
        <p>
          If the specified value of <code>math-script-level</code> is of the form
          <code>add(&lt;integer&gt;)</code> then the computed value of
          <code>math-script-level</code> is the inherited value plus the specified
          integer.
        </p>
        <p>
          If the specified value of <code>math-script-level</code> is of the form
          <code>&lt;integer&gt;</code> then the computed value of
          <code>math-script-level</code> is set to the specified integer.
        </p>
        <p>
          If
          <a data-cite="CSS-FONTS-3#font-size-prop"><code>font-size</code></a>
          is specified or if the specified value of
          <code>math-script-level</code> is <code>initial</code> then
          <code>math-script-level</code> does not affect the computed value of
          <code>font-size</code>. Otherwise, the computed value of
          <code>font-size</code> is obtained by multiplying the inherited value of
          <code>font-size</code> by a nonzero scale factor calculated by the
          following procedure:
        </p>
        <ol>
          <li>Let A be the inherited <code>math-script-level</code>, B the computed
            <code>math-script-level</code>, C be 0.71 and S be 1.0</li>
          <li>
            <ul>
              <li>If A = B then return S.</li>
              <li>If B &lt; A, swap A and B and set <code>InvertScaleFactor</code> to true.</li>
              <li>Otherwise B &gt; A and set <code>InvertScaleFactor</code> to false.</li>
            </ul>
          </li>
          <li>Let E be B - A &gt; 0.</li>
          <li>If the inherited font has an OpenType MATH table:
            <ul>
              <li>If A ≤ 0 and B ≥ 2 then multiply S by <a>scriptScriptPercentScaleDown</a> and
                decrement E by 2.</li>
              <li>Otherwise if A = 1 then multiply S by
                <a>scriptScriptPercentScaleDown</a> / <a>scriptPercentScaleDown</a> and
                decrement E by 1.</li>
              <li>Otherwise if B = 1 then multiply S by <a>scriptPercentScaleDown</a>
                and decrement E by 1.</li>
            </ul>
          </li>
          <li>Multiply S by C<sup>E</sup></li>
          <li>Return S if <code>InvertScaleFactor</code> is false and 1/S otherwise.</li>
        </ol>
      </section>
    </section>
    <section class="normative">
      <h2>OpenType <code>MATH</code> table</h2>
      <p>
        This chapter describes features provided by <code>MATH</code> table
        of an OpenType font [[OPEN-FONT-FORMAT]]. Throughout this chapter,
        a C-like notation
        <code>Table.Subtable1[index].Subtable2.Parameter</code> is used to
        denote OpenType parameters.
        Such parameters may not be available (e.g. if the font lack one of the
        subtable, has an invalid offset, etc) and so fallback options are
        provided.
      </p>
      <div class="note">
        It is strongly encouraged to render MathML with a math font with
        the proper OpenType features. There is no guarantee that the fallback
        options provided will provide good enough rendering.
      </div>
      <p>
        OpenType values expressed in design units (perhaps indirectly via a
        <code>MathValueRecord</code> entry) are scaled to appropriate values
        for layout purpose, taking into account
        <code>head.unitsPerEm</code>, CSS
        <a data-cite="CSS-FONTS-3#font-size-prop"><code>font-size</code></a>
        or zoom level.
      </p>
      <section>
        <h3>Layout constants (<code>MathConstants</code>)</h3>
        <div class="issue" data-number="69">Define fallback values</div>
        <p>These are global layout constants for a given mathematical font:</p>
        <dl>
          <dt><dfn>scriptPercentScaleDown</dfn></dt>
          <dd>
            <code>MATH.MathConstants.scriptPercentScaleDown / 100</code> or
            0.71 if <code>MATH.MathConstants.scriptPercentScaleDown</code> is
            null or not available.
          </dd>
          <dt><dfn>scriptScriptPercentScaleDown</dfn></dt>
          <dd>
            <code>MATH.MathConstants.scriptScriptPercentScaleDown / 100</code> or
            0.5041 if
            <code>MATH.MathConstants.scriptScriptPercentScaleDown</code> is
            null or not available.
          </dd>
          <dt><dfn>displayOperatorMinHeight</dfn></dt>
          <dd><code>MATH.MathConstants.displayOperatorMinHeight</code> or ?? if the constant is not available.</dd>
          <dt><dfn>axisHeight</dfn></dt>
          <dd><code>MATH.MathConstants.axisHeight</code> or ?? if the constant is not available.</dd>
          <dt><dfn>accentBaseHeight</dfn></dt>
          <dd><code>MATH.MathConstants.accentBaseHeight</code> or ?? if the constant is not available.</dd>
          <dt><dfn>subscriptShiftDown</dfn></dt>
          <dd><code>MATH.MathConstants.subscriptShiftDown</code> or ?? if the constant is not available.</dd>
          <dt><dfn>subscriptTopMax</dfn></dt>
          <dd><code>MATH.MathConstants.subscriptTopMax</code> or ?? if the constant is not available.</dd>
          <dt><dfn>subscriptBaselineDropMin</dfn></dt>
          <dd><code>MATH.MathConstants.subscriptBaselineDropMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>superscriptShiftUp</dfn></dt>
          <dd><code>MATH.MathConstants.superscriptShiftUp</code> or ?? if the constant is not available.</dd>
          <dt><dfn>superscriptShiftUpCramped</dfn></dt>
          <dd><code>MATH.MathConstants.superscriptShiftUpCramped</code> or ?? if the constant is not available.</dd>
          <dt><dfn>superscriptBottomMin</dfn></dt>
          <dd><code>MATH.MathConstants.superscriptBottomMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>superscriptBaselineDropMax</dfn></dt>
          <dd><code>MATH.MathConstants.superscriptBaselineDropMax</code> or ?? if the constant is not available.</dd>
          <dt><dfn>subSuperscriptGapMin</dfn></dt>
          <dd><code>MATH.MathConstants.subSuperscriptGapMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>superscriptBottomMaxWithSubscript</dfn></dt>
          <dd><code>MATH.MathConstants.superscriptBottomMaxWithSubscript</code> or ?? if the constant is not available.</dd>
          <dt><dfn>spaceAfterScript</dfn></dt>
          <dd><code>MATH.MathConstants.spaceAfterScript</code> or ?? if the constant is not available.</dd>
          <dt><dfn>upperLimitGapMin</dfn></dt>
          <dd><code>MATH.MathConstants.upperLimitGapMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>upperLimitBaselineRiseMin</dfn></dt>
          <dd><code>MATH.MathConstants.upperLimitBaselineRiseMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>lowerLimitGapMin</dfn></dt>
          <dd><code>MATH.MathConstants.lowerLimitGapMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>lowerLimitBaselineDropMin</dfn></dt>
          <dd><code>MATH.MathConstants.lowerLimitBaselineDropMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>stackTopShiftUp</dfn></dt>
          <dd><code>MATH.MathConstants.stackTopShiftUp</code> or ?? if the constant is not available.</dd>
          <dt><dfn>stackTopDisplayStyleShiftUp</dfn></dt>
          <dd><code>MATH.MathConstants.stackTopDisplayStyleShiftUp</code> or ?? if the constant is not available.</dd>
          <dt><dfn>stackBottomShiftDown</dfn></dt>
          <dd><code>MATH.MathConstants.stackBottomShiftDown</code> or ?? if the constant is not available.</dd>
          <dt><dfn>stackBottomDisplayStyleShiftDown</dfn></dt>
          <dd><code>MATH.MathConstants.stackBottomDisplayStyleShiftDown</code> or ?? if the constant is not available.</dd>
          <dt><dfn>stackGapMin</dfn></dt>
          <dd><code>MATH.MathConstants.stackGapMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>stackDisplayStyleGapMin</dfn></dt>
          <dd><code>MATH.MathConstants.stackDisplayStyleGapMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>stretchStackTopShiftUp</dfn></dt>
          <dd><code>MATH.MathConstants.stretchStackTopShiftUp</code> or ?? if the constant is not available.</dd>
          <dt><dfn>stretchStackBottomShiftDown</dfn></dt>
          <dd><code>MATH.MathConstants.stretchStackBottomShiftDown</code> or ?? if the constant is not available.</dd>
          <dt><dfn>stretchStackGapAboveMin</dfn></dt>
          <dd><code>MATH.MathConstants.stretchStackGapAboveMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>stretchStackGapBelowMin</dfn></dt>
          <dd><code>MATH.MathConstants.stretchStackGapBelowMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>fractionNumeratorShiftUp</dfn></dt>
          <dd><code>MATH.MathConstants.fractionNumeratorShiftUp</code> or ?? if the constant is not available.</dd>
          <dt><dfn>fractionNumeratorDisplayStyleShiftUp</dfn></dt>
          <dd><code>MATH.MathConstants.fractionNumeratorDisplayStyleShiftUp</code> or ?? if the constant is not available.</dd>
          <dt><dfn>fractionDenominatorShiftDown</dfn></dt>
          <dd><code>MATH.MathConstants.fractionDenominatorShiftDown</code> or ?? if the constant is not available.</dd>
          <dt><dfn>fractionDenominatorDisplayStyleShiftDown</dfn></dt>
          <dd><code>MATH.MathConstants.fractionDenominatorDisplayStyleShiftDown</code> or ?? if the constant is not available.</dd>
          <dt><dfn>fractionNumeratorGapMin</dfn></dt>
          <dd><code>MATH.MathConstants.fractionNumeratorGapMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>fractionNumDisplayStyleGapMin</dfn></dt>
          <dd><code>MATH.MathConstants.fractionNumDisplayStyleGapMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>fractionRuleThickness</dfn></dt>
          <dd><code>MATH.MathConstants.fractionRuleThickness</code> or ?? if the constant is not available.</dd>
          <dt><dfn>fractionDenominatorGapMin</dfn></dt>
          <dd><code>MATH.MathConstants.fractionDenominatorGapMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>fractionDenomDisplayStyleGapMin</dfn></dt>
          <dd><code>MATH.MathConstants.fractionDenomDisplayStyleGapMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>overbarVerticalGap</dfn></dt>
          <dd><code>MATH.MathConstants.overbarVerticalGap</code> or ?? if the constant is not available.</dd>
          <dt><dfn>overbarRuleThickness</dfn></dt>
          <dd><code>MATH.MathConstants.overbarRuleThickness</code> or ?? if the constant is not available.</dd>
          <dt><dfn>overbarExtraAscender</dfn></dt>
          <dd><code>MATH.MathConstants.overbarExtraAscender</code> or ?? if the constant is not available.</dd>
          <dt><dfn>underbarVerticalGap</dfn></dt>
          <dd><code>MATH.MathConstants.underbarVerticalGap</code> or ?? if the constant is not available.</dd>
          <dt><dfn>underbarRuleThickness</dfn></dt>
          <dd><code>MATH.MathConstants.underbarRuleThickness</code> or ?? if the constant is not available.</dd>
          <dt><dfn>underbarExtraDescender</dfn></dt>
          <dd><code>MATH.MathConstants.underbarExtraDescender</code> or ?? if the constant is not available.</dd>
          <dt><dfn>radicalVerticalGap</dfn></dt>
          <dd><code>MATH.MathConstants.radicalVerticalGap</code> or ?? if the constant is not available.</dd>
          <dt><dfn>radicalDisplayStyleVerticalGap</dfn></dt>
          <dd><code>MATH.MathConstants.radicalDisplayStyleVerticalGap</code> or ?? if the constant is not available.</dd>
          <dt><dfn>radicalRuleThickness</dfn></dt>
          <dd><code>MATH.MathConstants.radicalRuleThickness</code> or ?? if the constant is not available.</dd>
          <dt><dfn>radicalExtraAscender</dfn></dt>
          <dd><code>MATH.MathConstants.radicalExtraAscender</code> or ?? if the constant is not available.</dd>
          <dt><dfn>radicalKernBeforeDegree</dfn></dt>
          <dd><code>MATH.MathConstants.radicalKernBeforeDegree</code> or 5/18em if the constant is not available.</dd>
          <dt><dfn>radicalKernAfterDegree</dfn></dt>
          <dd><code>MATH.MathConstants.radicalKernAfterDegree</code> or −10/18em if the constant is not available.</dd>
          <dt><dfn>radicalDegreeBottomRaisePercent</dfn></dt>
          <dd><code>MATH.MathConstants.radicalDegreeBottomRaisePercent / 100.0</code> or 0.6 if the constant is not available.</dd>
        </dl>
      </section>
      <section>
        <h3>Glyph information (<code>MathGlyphInfo</code>)</h3>
        <p>
          These are per-glyph tables for a given mathematical font:
        </p>
        <dl>
          <dt><dfn>MathItalicsCorrectionInfo</dfn></dt>
          <dd>
            The subtable
            <code>MATH.MathGlyphInfo.MathItalicsCorrectionInfo</code>
            of italics correction values. Use the corresponding value in
            <code>MATH.MathGlyphInfo.MathItalicsCorrectionInfo.italicsCorrection</code>
            if there is one for the requested glyph or
            or <code>0</code> otherwise.
          </dd>
          <dt><dfn>MathTopAccentAttachment</dfn></dt>
          <dd>
            The subtable
            <code>MATH.MathGlyphInfo.MathTopAccentAttachment</code>
            of positioning top math accents along the <a>inline axis</a>.
            Use the corresponding value in
            <code>MATH.MathGlyphInfo.MathTopAccentAttachment.topAccentAttachment</code>
            if there is one for the requested glyph or
            or half the advance width of the glyph otherwise.
          </dd>
        </dl>
      </section>
      <section>
        <h3>Size variants for operators (<code>MathVariants</code>)</h3>
        <p>
          This section describes how to handle stretchy glyphs of arbitrary
          size using the <code>MATH.MathVariants</code> table.
        </p>
        <section>
          <h4>The <code>GlyphAssembly</code> table</h4>
          <p>
            This section is based on [[?OPEN-TYPE-MATH-IN-HARFBUZZ]].
            For convenience, the following definitions are used:
          </p>
          <ul>
            <li>
              o<sub>min</sub> is
              <code>MATH.MathVariant.minConnectorOverlap</code>.
            </li>
            <li>
              A <code>GlyphPartRecord</code> is an <em>extender</em>
              if and only if
              <code>GlyphPartRecord.partFlags</code> has the
              <code>fExtender</code> flag set.
            </li>
            <li>
              A <code>GlyphAssembly</code> is <em>horizontal</em>
              if it is obtained from
              <code>MathVariant.horizGlyphConstructionOffsets</code>.
              Otherwise it is <em>vertical</em> (and obtained from
              <code>MathVariant.vertGlyphConstructionOffsets</code>).
            <li>
              For a given <code>GlyphAssembly</code> table,
              N<sub>Ext</sub> (respectively
              N<sub>NonExt</sub>) is the number of extenders
              (respectively non-extenders) in
              <code>GlyphAssembly.partRecords</code>.
            </li>
            <li>
              For a given <code>GlyphAssembly</code> table,
              S<sub>Ext</sub> (respectively
              S<sub>NonExt</sub>) is the sum of
              <code>GlyphPartRecord.fullAdvance</code>
              for all extenders (respectively non-extenders) in
              <code>GlyphAssembly.partRecords</code>.
            </li>
          </ul>
          <p>
            User agents must treat the <code>GlyphAssembly</code> as invalid
            if the following conditions are not satisfied:
          </p>
          <ul>
            <li>
              S<sub>Ext</sub> − o<sub>min</sub> N<sub>Ext</sub> > 0.
              Otherwise, the overlap takes at least the full advance of each
              extender.
            </li>
            <li>
              For each <code>GlyphPartRecord</code>
              in <code>GlyphAssembly.partRecords</code>,
              the values of
              <code>GlyphPartRecord.startConnectorLength</code> and
              <code>GlyphPartRecord.endConnectorLength</code>
              must be at least o<sub>min</sub>.
              Otherwise, it is not possible to satisfy the condition of
              <code>MathVariant.minConnectorOverlap</code>.
            </li>
          </ul>
          <p>
            AssembySize(o, r) is the stretch size of a glyph assembly
            built by repeating each extender r times and using the same overlap
            value o between each glyph.
            It is equal to
            S<sub>NonExt</sub> − o (N<sub>NonExt</sub> − 1)
            + r (S<sub>Ext</sub> − o N<sub>Ext</sub>) or, equivalently,
            AssembySize(o, r) =
            S<sub>NonExt</sub> + r S<sub>Ext</sub>
            − o (N<sub>NonExt</sub> + r N<sub>Ext</sub> − 1).
          </p>
          <p>
            <dfn>r<sub>min</sub></dfn> is the minimal number of repetitions
            needed to obtain an assembly size of
            size at least T. It is the maximum between 0 and the ceiling of
            (T − S<sub>NonExt</sub> − o<sub>min</sub> (N<sub>NonExt</sub> − 1)) / (S<sub>Ext</sub> − o<sub>min</sub> N<sub>Ext</sub>).
          </p>
	  <p>
            <dfn>o<sub>max</sub></dfn> is the
            maximum overlap possible to build an assembly of size at least
            T by repeating each extender r<sub>min</sub> times.
            N = N<sub>NonExt</sub> + r<sub>min</sub> N<sub>Ext</sub> is
            the number of glyphs in such an assembly.
            If N ≤ 1, then the overlap is irrelevant, so
            o<sub>max</sub> is defined to be o<sub>min</sub>.
            Otherwise, o<sub>max</sub> is defined to be the minimum of:
          </p>
          <ul>
            <li>o<sub>max,theorical</sub> = (S<sub>NonExt</sub> + r<sub>min</sub> S<sub>Ext</sub> − T) / (N − 1)</li>
            <li>
              <code>GlyphPartRecord.startConnectorLength</code> for all
              the entries in
              <code>GlyphAssembly.partRecords</code>, excluding the
              last one if it is not an extender.
            </li>
            <li>
              <code>GlyphPartRecord.endConnectorLength</code> for all
              the entries in
              <code>GlyphAssembly.partRecords</code>, excluding the
              first one if it is not an extender.
            </li>
            </ul>
	  <p>
            The <dfn>glyph assembly stretch size</dfn>
            for a target size T is
            AssembySize(o<sub>max</sub>, r<sub>min</sub>).
          </p>
          <p>
            The
            <dfn>glyph assembly width</dfn>,
            <dfn>glyph assembly ascent</dfn>
            and <dfn>glyph assembly descent</dfn>
            are defined as follows:
          </p>
          <ul>
            <li>If <code>GlyphAssembly</code> is horizontal,
              the width is the maximum advance width of the glyphs of id
              <code>GlyphPartRecord.glyphID</code> for all the
              <code>GlyphPartRecord</code> in
              <code>GlyphAssembly.partRecords</code>,
              the ascent is the
              <a>glyph assembly stretch size</a>
              for a given target size <code>T</code>
              and the descent is 0.
            </li>
            <li>Otherwise, the <code>GlyphAssembly</code> is vertical,
              the width is <a>glyph assembly stretch size</a>
              for a given target size <code>T</code> while
              the ascent (respectively descent) is the
              the maximum ascent (respectively descent) of the glyphs of id
              <code>GlyphPartRecord.glyphID</code> for all the
              <code>GlyphPartRecord</code> in
              <code>GlyphAssembly.partRecords</code>.
            </li>
          </ul>
          <p>
            The <dfn>glyph assembly height</dfn> is the sum
            of the <a>glyph assembly ascent</a> and
            <a>glyph assembly descent</a>.
          </p>
          <div class="note">
            The horizontal (respectively vertical) metrics for a vertical
            (respectively horizontal) glyph assembly do not depend
            on the target size <code>T</code>.
          </div>
          <p>The <dfn>shaping of the glyph assembly</dfn>
            at position <code>P</code> is performed with the following
            algorithm:
          </p>
          <ol>
            <li>Calculate <a>r<sub>min</sub></a> and
              <a>o<sub>max</sub></a>.</li>
            <li>
              Set <code>(x, y)</code> to <code>P</code> if
              <code>RepetitionCounter</code> to 0 and
              <code>PartIndex</code> to -1.
            </li>
            <li>
              Repeat the following steps:
              <ol>
                <li>
                  If <code>RepetitionCounter</code> is 0, then
                  <ol>
                    <li>Increment <code>PartIndex</code>.</li>
                    <li>If <code>PartIndex</code> is
                      <code>GlyphAssembly.partCount</code>
                      then stop.</li>
                    <li>Otherwise, set
                      <code>Part</code> to
                      <code>GlyphAssembly.partRecords[PartIndex]</code>.
                      Set <code>RepetitionCounter</code> to
                      r<sub>min</sub> if
                      <code>Part</code> is an extender and to 1 otherwise.
                    </li>
                  </ol>
                </li>
                <li>
                  <ul>
                    <li>If the glyph assembly is horizontal then
                      draw the glyph of id
                      <code>Part.glyphID</code>
                      so that its (left, baseline) coordinates
                      are at position <code>(x, y)</code>.
                      Set <code>x</code> to
                      <code>x + Part.fullAdvance −
                        o<sub>max</sub></code>
                    </li>
                    <li>Otherwise (if the glyph assembly is vertical),
                      then
                      draw the glyph of id
                      <code>Part.glyphID</code>
                      so that its (left, bottom) coordinates
                      are at position <code>(x, y)</code>.
                      Set <code>y</code> to
                      <code>y − Part.fullAdvance +
                        o<sub>max</sub></code>
                    </li>
                  </ul>
                </li>
                <li>Decrement <code>RepetitionCounter</code>.</li>
              </ol>
            </li>
          </ol>
        </section>
        <section>
          <h4>Algorithms for glyph stretching</h4>
          <p>
            The <dfn>preferred inline size of a glyph stretched along the block
            axis</dfn>
            is calculated using the following algorithm:
          </p>
          <ol>
            <li>
              Set <code>S</code> to the glyph's advance width.
            </li>
            <li>
              If there is a <code>MathGlyphConstruction</code> table
              in the <code>MathVariants.vertGlyphConstructionOffsets</code>
              table for the given glyph:
              <ol>
                <li>
                  For each <code>MathGlyphVariantRecord</code> in
                  <code>MathGlyphConstruction.mathGlyphVariantRecord</code>,
                  ensure that <code>S</code> is at least
                  the advance width of the glyph of id
                  <code>MathGlyphVariantRecord.variantGlyph</code>.
                </li>
                <li>
                  If there is valid <code>GlyphAssembly</code> subtable,
                  then ensure
                  that <code>S</code> is at least the
                  <a>glyph assembly width</a>.
                </li>
              </ol>
            </li>
            <li>Return <code>S</code>.</li>
          </ol>
          <div class="note">
            The <a>preferred inline size of a glyph stretched along the block
            axis</a> will return the maximum width of all possible
            vertical constructions for that glyph.
            In practice, math fonts are designed so that
            vertical constructions almost constant width so possible
            over-estimation of the actual width is small.
          </div>
          <p>
            The algorithm to calculate the
            <dfn>box metrics of a stretchy glyph</dfn>
            stretched to inline (respectively block) dimension
            <code>T</code> is the following:
          </p>
          <ol>
            <li>
              Set <code>B</code> to glyph's advanced width, ascent and
              descent.
              If the glyph's advance width
              (respectively height) is at least <code>T</code>
              then return <code>B</code>.
            </li>
            <li>
              If there is a <code>MathGlyphConstruction</code> table
              in the <code>MathVariants.horizGlyphConstructionOffsets</code>
              table  (respectively
              <code>MathVariants.vertGlyphConstructionOffsets</code> table)
              for the given glyph:
              <ol>
                <li>
                  For each <code>MathGlyphVariantRecord</code> in
                  <code>MathGlyphConstruction.mathGlyphVariantRecord</code>:
                  <ol>
                    <li>
                      Set <code>B</code>
                      to the advanced width, ascent and
                      descent of the glyph of id
                      <code>MathGlyphVariantRecord.variantGlyph</code>.
                    </li>
                    <li>
                      If
                      <code>MathGlyphVariantRecord.advanceMeasurement</code>
                      is at least <code>T</code> then return
                      <code>B</code>.
                    </li>
                  </ol>
                <li>
                  If there is valid <code>GlyphAssembly</code> subtable
                  then set <code>B</code> to the
                  <a>glyph assembly width</a>,
                  <a>glyph assembly ascent</a>
                  and <a>glyph assembly descent</a>
                  for the target size <code>T</code>.
                </li>
              </ol>
            </li>
            <li>Return <code>B</code>.</li>
          </ol>
          <div class="issue">Apply a rotation matrix
            in vertical writing mode?</div>
          <p>The algorithm to
            <dfn>shape a stretchy glyph</dfn> to inline
            (respectively block) dimension <code>T</code> at a position
            <code>P</code> is the following:
          </p>
          <ol>
            <li>
              If the glyph's advance width (respectively height)
              is at least <code>T</code>
              then draw the glyph so that its (left, baseline) coordinates
              are at position <code>P</code> and exit.
            </li>
            <li>
              If there is a <code>MathGlyphConstruction</code> table
              in the <code>MathVariants.horizGlyphConstructionOffsets</code>
              table (respectively
              <code>MathVariants.vertGlyphConstructionOffsets</code> table)
              for the given glyph:
              <ol>
                <li>
                  For each <code>MathGlyphVariantRecord</code> in
                  <code>MathGlyphConstruction.mathGlyphVariantRecord</code>,
                  if
                  <code>MathGlyphVariantRecord.advanceMeasurement</code>
                  is at least <code>T</code> then draw the glyph
                  so that its (left, baseline) coordinates
                  are at position <code>P</code> and exit.
                </li>
                <li>
                  If there is valid <code>GlyphAssembly</code> subtable
                  then perform
                  <a>shaping of the glyph assembly</a>
                  at position <code>P</code> and exit.
                </li>
              </ol>
            </li>
            <li>Otherwise, exit with a failure.</li>
          </ol>
        </section>
      </section>
    </section>
    <section class="appendix informative">
      <h2>RelaxNG</h2>
      <p>
        This section displays a non-normative Relax NG Schema which
        details the elements and attributes defined by this specification.
        Note that MathML does not need to be expressed in XML syntax, in
        particular the syntax defined by HTML may be used. However this
        schema may be taken as an informal specification of the structure,
        whatever syntax is used.
      </p>
      <pre data-include="mathml-core.rnc"></pre>
    </section>
    <section class="appendix normative">
      <h2>User Agent Stylesheet</h2>
      <pre class="css">@namespace url(http://www.w3.org/1998/Math/MathML);

/* Links */
<span data-include-replace="true" data-include="user-agent-stylesheet/links.css"></span>
/* The &lt;math&gt; element */
<span data-include-replace="true" data-include="user-agent-stylesheet/math.css"></span>
/* &lt;mrow&gt;-like elements */
<span data-include-replace="true" data-include="user-agent-stylesheet/semantics.css"></span><span data-include-replace="true" data-include="user-agent-stylesheet/maction.css"></span><span data-include-replace="true" data-include="user-agent-stylesheet/merror.css"></span><span data-include-replace="true" data-include="user-agent-stylesheet/mphantom.css"></span>
/* Tables */
<span data-include-replace="true" data-include="user-agent-stylesheet/mtable.css"></span><span data-include-replace="true" data-include="user-agent-stylesheet/mtable-frame.css"></span><span data-include-replace="true" data-include="user-agent-stylesheet/mtr.css"></span><span data-include-replace="true" data-include="user-agent-stylesheet/mtd.css"></span>
/* Fractions */
<span data-include-replace="true" data-include="user-agent-stylesheet/mfrac.css"></span>
/* Other rules for scriptlevel and displastyle */
<span data-include-replace="true" data-include="user-agent-stylesheet/displaystyle.css"></span></span><span data-include-replace="true" data-include="user-agent-stylesheet/mroot.css"></span><span data-include-replace="true" data-include="user-agent-stylesheet/scripts.css"></span>
      </pre>
    </section>
    <section class="normative">
      <h2>Operator Tables</h2>
      <section>
        <h3>Operator Dictionary</h3>
        <p>
          Users agent must use a dictionary of rendering properties for MathML
          operators. The dictionary must include at least the entries of the
          <a href="#operator-dictionary-entries">table below</a>.
        </p>
        <p>
          The dictionary is indexed by 'Content' and 'Form' columns together.
          <a href="#operator-fence-separator-or-accent-mo"></a>
          describes how to determine these values for a given operator.
          The 'Rendering' and 'Unicode' columns are provided for convenience,
          but they are just alternative to the 'Content' column.
        </p>
        <p>
          The 'Priority' column is significant for the proper grouping of
          sub-expressions using <code>&lt;mrow&gt;</code>. This is especially
          relevant to the automatic generation of MathML by conversion from
          other formats for displayed mathematics, such as T<sub>E</sub>X,
          which do not always specify how sub-expressions nest.
          However, it does not affect the rendering described in this
          specification and so is not needed for implementing it in user agents.
        </p>
        <p>
          The length valued attributes <a><code>lspace</code></a> and
          <a><code>rspace</code></a> are given here as numeric values ranging
          from 0 to 7 in order to save space in the table. They must be
          interpreted as multiples of 1/18em i.e.
          <code>0</code>,
          <code>0.05555555555555555em</code>,
          <code>0.1111111111111111em</code>,
          <code>0.16666666666666666em</code>,
          <code>0.2222222222222222em</code>,
          <code>0.2777777777777778em</code>,
          <code>0.3333333333333333em</code>,
          <code>0.3888888888888889em</code> respectively.
        </p>
        <p>
          Boolean valued attributes
          <a><code>fence</code></a>,
          <a><code>separator</code></a>,
          <a><code>stretchy</code></a>,
          <a><code>symmetric</code></a>,
          <a><code>largeop</code></a>,
          <a><code>movablelimits</code></a>,
          <a><code>accent</code></a> are
          specified together in the final 'Properties' column by listing the
          attribute name if its value should be set to true by the dictionary.
        </p>
        <div id="operator-dictionary-entries"
             data-include="tables/operator-dictionary.html"></div>
      </section>
      <section>
        <h3>Stretchy Operator Axis</h3>
        <p>
          The default stretch axis for all characters is
          <em>block</em>. However, the
          stretch axis for the following characters is <em>inline</em>:
        </p>
        <code data-include="tables/block-axis-operators.txt"></code>
        <div class="note">
          The stretch axis can be included as a boolean property of the
          <a href="#operator-dictionary">operator dictionary</a>. But since it
          does not depend on the form and since very few operators can stretch
          along the <a>inline axis</a>, it might be better implemented as a separate
          sorted array.
        </div>
      </section>
      <section>
        <h3>Combining Character Equivalences</h3>
        <p>
          The following table gives mappings between spacing and non spacing
          characters when used in MathML accent constructs.
        </p>
        <div data-include="tables/combining-operators.html"></div>
      </section>
    </section>
    <section>
      <h2>Unicode-based Glyph Assemblies</h2>
      <p>
        The following table provide fallback that user agents must use for
        stretching a given <em>base character</em> when the font does not
        provide a <code>MATH.MathVariants</code> table.
        The algorithms of
        <a href="#size-variants-for-operators-mathvariants"></a>
        works the same except with some adjustments:
      </p>
      <ul>
        <li>
          Entries are indexed by the base character.
        </li>
        <li>
          All the glyph IDs and metrics have to be deduced from unicode
          code points.
        </li>
        <li>
          If the <em>glyph construction</em> is horizontal then
          the entry corresponds to
          a <code>MathVariants.horizGlyphConstructionOffsets[]</code> item ;
          if it is vertical it corresponds to
          a <code>MathVariants.vertGlyphConstructionOffsets[]</code> item.
        </li>
        <li>
          The <code>MathGlyphConstruction.mathGlyphVariantRecord</code> is
          always empty.
        </li>
        <li>
          The
          <code>MathVariants.minConnectorOverlap</code>,
          <code>GlyphPartRecord.startConnectorLength</code> and
          <code>GlyphPartRecord.endConnectorLength</code>
          are treated as 0.
        </li>
        <li>
          The array of
          <code>MathGlyphConstruction.GlyphAssembly.partRecords</code> is built
          from each table row as follows:
          <ol>
            <li>A (non-extender) <em>bottom/left</em> character</li>
            <li>Followed by an <em>extender</em> character.</li>
            <li>Optionally followed by this:
              <ul>
                <li>Optionally, an (non-extender) <em>middle</em> character
                  and the same extender character previously mentioned.</li>
                <li>A (non-extender) <em>top/right</em> character.
              </ul>
            </li>
          </ol>
        </li>
      </ul>
      <div data-include="tables/unicode-assembly.html"></div>
    </section>
    <section>
      <h3>New <code>text-transform</code> Mappings</h3>
      <section>
        <h4><code>bold-script</code> mappings</h4>
        <div data-include="tables/mathvariants-bold-script.html"></div>
      </section>
      <section>
        <h4><code>bold-italic</code> mappings</h4>
        <div data-include="tables/mathvariants-bold-italic.html"></div>
      </section>
(      <section>
        <h4><code>tailed</code> mappings</h4>
        <div data-include="tables/mathvariants-tailed.html"></div>
      </section>
      <section>
        <h4><code>bold</code> mappings</h4>
        <div data-include="tables/mathvariants-bold.html"></div>
      </section>
      <section>
        <h4><code>fraktur</code> mappings</h4>
        <div data-include="tables/mathvariants-fraktur.html"></div>
      </section>
      <section>
        <h4><code>script</code> mappings</h4>
        <div data-include="tables/mathvariants-script.html"></div>
      </section>
      <section>
        <h4><code>monospace</code> mappings</h4>
        <div data-include="tables/mathvariants-monospace.html"></div>
      </section>
      <section>
        <h4><code>initial</code> mappings</h4>
        <div data-include="tables/mathvariants-initial.html"></div>
      </section>
      <section>
        <h4><code>sans-serif</code> mappings</h4>
        <div data-include="tables/mathvariants-sans-serif.html"></div>
      </section>
      <section>
        <h4><code>double-struck</code> mappings</h4>
        <div data-include="tables/mathvariants-double-struck.html"></div>
      </section>
      <section>
        <h4><code>looped</code> mappings</h4>
        <div data-include="tables/mathvariants-looped.html"></div>
      </section>
      <section>
        <h4><code>stretched</code> mappings</h4>
        <div data-include="tables/mathvariants-stretched.html"></div>
      </section>
      <section>
        <h4><code>italic</code> mappings</h4>
        <div data-include="tables/mathvariants-italic.html"></div>
      </section>
      <section>
        <h4><code>bold-fraktur</code> mappings</h4>
        <div data-include="tables/mathvariants-bold-fraktur.html"></div>
      </section>
      <section>
        <h4><code>sans-serif-bold-italic</code> mappings</h4>
        <div data-include="tables/mathvariants-sans-serif-bold-italic.html"></div>
      </section>
      <section>
        <h4><code>sans-serif-italic</code> mappings</h4>
        <div data-include="tables/mathvariants-sans-serif-italic.html"></div>
      </section>
      <section>
        <h4><code>bold-sans-serif</code> mappings</h4>
        <div data-include="tables/mathvariants-bold-sans-serif.html"></div>
      </section>
    </section>
    <section class="appendix normative">
      <h2>Conformance</h2>
      <section>
        <h3>Document conventions</h3>
        <p>
          Conformance requirements are expressed with a combination of
          descriptive assertions and RFC 2119 terminology. The key words “MUST”,
          “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
          “RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this
          document are to be interpreted as described in RFC 2119.
          However, for readability, these words do not appear in all uppercase
          letters in this specification.
        </p>
        <p>
          All of the text of this specification is normative except sections
          explicitly marked as non-normative, examples, and notes.
          [[RFC2119]].
        </p>
        <p>
          Examples in this specification are introduced with the words
          “for example” or are set apart from the normative text with
          <code>class="example"</code>, like this:
        </p>
        <div class="example">
          <p>
            This is an example of an informative example.
          </p>
        </div>
        <p>
          Informative notes begin with the word “Note” and are set apart from
          the normative text with <code>class="note"</code>, like this:
        </p>
        <p class="note">
          Note, this is an informative note.
        </p>
        <p>
          Advisements are normative sections styled to evoke special attention
          and are set apart from other normative text with
          <code>&lt;strong class="advisement"&gt;</code>, like this:
          <strong class="advisement">UAs MUST provide an accessible alternative. </strong>
        </p>
      </section>
    </section>
  </body>
</html>
